<!DOCTYPE html>
<html lang="en">
<head>
    <!-- === HEAD SECTION (START) === -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>1x Mall Bet - Authentication</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    
    <!-- === GOOGLE FONTS FOR CRASH GAME === -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- === HEAD SECTION (END) === -->

    <!-- === STYLES (START) === -->
    <style>
        /* === ROOT VARIABLES (START) === */
        :root {
            --primary-green: #27AE60; --primary-green-darker: #229954; --light-bg: #f7f8fa; --red-color: #f54545; --orange-color: #f8992c;
            --gray-text: #969799; --dark-text: #323233; --body-bg: #f0f2f5;
            --gold-color: #ffd700;

            /* New dark theme variables from screenshots */
            --modal-bg: #2c2f3b;
            --modal-text: #e0e0e0;
            --modal-input-bg: #1e2129;
            --modal-purple-accent: #6c5ce7;
            --modal-orange-accent: #f39c12;
            --modal-light-gray: #a9a9a9;
            
            /* Mines Theme */
            --mines-bg-dark: #202A39;
            --mines-bg-light: #354657;
            --mines-accent-green: #34E795;
            
            /* Wingo Theme (from new file) */
            --wingo-primary-green: #21b871;
            --wingo-violet-color: #9c27b0;
            --wingo-orange-color: #d89842;
            --wingo-blue-color: #4393d8;
            --wingo-border-color: #e0e0e0;

            /* === PREMIUM AUTH UPDATE === */
            --auth-bg-dark: #1a1d24;
            --auth-bg-light: #2c2f3b;
            --auth-input-bg: rgba(255, 255, 255, 0.05);
            --auth-input-border: rgba(255, 255, 255, 0.1);
            --auth-text-light: #f0f2f5;
            --auth-text-muted: #a9a9a9;
        }
        /* === ROOT VARIABLES (END) === */

        /* === GENERAL & UTILITY STYLES (START) === */
        * {
            -webkit-tap-highlight-color: transparent !important;
            outline: none !important;
        }
        html, body { height: 100%; overflow: hidden; }
        body { background-color: var(--body-bg); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 0; }
                .container { 
            max-width: 100%; width: 100%; height: 100%; background: var(--body-bg); 
            position: relative; overflow: hidden; display: flex; flex-direction: column; 
            opacity: 0; /* Initially hidden until JS is ready */
            pointer-events: none;
            transition: opacity 0.3s ease-in-out;
        }
        .container.ready {
            opacity: 1;
            pointer-events: auto;
        }
        .hidden { display: none !important; }
        
        .auth-page {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 80px; /* space for nav bar */
        }
        .auth-page.no-scroll { overflow-y: hidden; }
        /* === GENERAL & UTILITY STYLES (END) === */

        /* === PREMIUM AUTH STYLES (NEW) START === */
        #splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--auth-bg-dark);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        #splash-screen.hidden {
            opacity: 0;
            transform: scale(1.1);
            pointer-events: none;
        }
        #splash-screen img {
            height: 50px;
            margin-bottom: 25px;
            animation: pulse-logo 2s infinite ease-in-out;
        }
        @keyframes pulse-logo {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        .splash-loader {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--primary-green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        #login-page, #register-page {
            background: linear-gradient(160deg, var(--auth-bg-dark) 0%, #1f222b 100%);
            height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            box-sizing: border-box;
        }
        .auth-container {
            width: 100%;
            max-width: 360px;
            margin: auto;
            opacity: 0;
            animation: fadeInUp 0.8s 0.2s ease-out forwards;
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-form-header { text-align: center; margin-bottom: 30px; }
        .auth-form-header img { height: 45px; margin-bottom: 10px; }
        .auth-form-header h2 {
            font-size: 1.8rem;
            color: var(--auth-text-light);
            font-weight: 700;
            margin: 0;
        }
        .auth-form-header p {
            color: var(--auth-text-muted);
            font-size: 1rem;
            margin: 5px 0 0;
        }
        #register-page .auth-form-header { margin-bottom: 20px; }
        
        .input-wrapper { 
            display: flex; 
            align-items: center; 
            background-color: var(--auth-input-bg);
            border-radius: 12px;
            border: 1px solid var(--auth-input-border);
            margin-bottom: 18px; 
            transition: all 0.3s ease;
            position: relative;
        }
        .input-wrapper:focus-within { 
            border-color: var(--primary-green);
            box-shadow: 0 0 15px rgba(39, 174, 96, 0.3);
        }
        .input-wrapper .input-icon {
            color: var(--auth-text-muted);
            padding: 0 15px;
            font-size: 1rem;
        }
        .input-wrapper input { 
            flex-grow: 1; 
            border: none; 
            outline: none; 
            padding: 16px 15px 16px 0;
            font-size: 1rem; 
            background: transparent; 
            color: var(--auth-text-light);
            /* NEW: Fix for invisible cursor on dark backgrounds */
            caret-color: var(--primary-green);
        }
        .input-wrapper input::placeholder {
            color: var(--auth-text-muted);
        }
        .input-wrapper .eye-icon { 
            color: var(--auth-text-muted); 
            cursor: pointer; 
            padding: 15px; 
        }
        /* MODIFIED: Registration phone number prefix display */
        .country-code-display { 
            padding-left: 15px;
            margin-right: 5px; 
            position: relative;
        }
        .country-code-display span {
            color: var(--auth-text-light);
            font-weight: 500;
        }
        .country-code-display::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 20px;
            background-color: var(--auth-input-border);
        }

        .btn { width: 100%; padding: 16px; border-radius: 12px; border: none; font-size: 1.05rem; font-weight: 600; cursor: pointer; position: relative; transition: all 0.3s ease; }
        .btn-primary { 
            background: linear-gradient(90deg, var(--primary-green), #2ecc71); 
            color: white; 
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(39, 174, 96, 0.3);
        }

        .auth-switch-link {
            text-align: center;
            margin-top: 25px;
            color: var(--auth-text-muted);
            font-size: 0.9rem;
        }
        .auth-switch-link a {
            color: var(--primary-green);
            text-decoration: none;
            font-weight: 600;
        }
        #register-page .back-btn { 
            position: absolute;
            top: 25px;
            left: 20px;
            color: var(--auth-text-light);
            background: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 5;
            font-size: 1.2rem;
            border: none;
        }
        .btn:disabled {
            background: #555 !important;
            color: #999 !important;
            cursor: not-allowed !important;
            opacity: 0.7;
            box-shadow: none !important;
            transform: none !important;
        }
        /* === PREMIUM AUTH STYLES (NEW) END === */

        /* === STICKY HEADER STYLES (MODIFIED) START === */
        .sticky-header {
            position: sticky; top: 0; z-index: 10;
            background: var(--auth-bg-dark); /* MODIFIED: Dark background */
            color: var(--auth-text-light); /* MODIFIED: Light text */
            padding: 10px 15px; 
            font-weight: 600; font-size: 1.1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            display: flex; align-items: center; justify-content: center;
            flex-shrink: 0;
            min-height: 40px; /* Ensure consistent height */
        }
        /* MODIFIED: Back button color */
        .sticky-header .back-btn {
            position: absolute;
            left: 15px;
            color: var(--auth-text-light);
            font-size: 1.1rem;
            cursor: pointer;
        }
        
        /* NEW: Premium Dashboard Header */
        .premium-sticky-header {
            position: sticky; top: 0; z-index: 10;
            background: var(--auth-bg-dark);
            color: var(--auth-text-light);
            padding: 8px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .premium-header-logo {
            height: 35px;
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .premium-header-icon {
            font-size: 1.4rem;
            color: var(--gold-color);
            cursor: pointer;
            text-decoration: none;
        }
        .premium-balance-display {
            background-color: var(--auth-bg-light);
            padding: 6px 8px 6px 12px;
            border-radius: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        .premium-header-avatar {
            background: black;
            color: #4a90e2;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem; /* Adjusted for new icon */
        }
        /* === STICKY HEADER STYLES (END) === */
        
        /* === SLIDER STYLES (START) === */
        .slider-container { 
            padding: 15px; 
            position: relative; 
        }
        .slider-wrapper {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 7;
            border-radius: 10px;
            overflow: hidden;
            background-color: #e0e0e0; /* Fallback background */
        }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.7s ease-in-out;
            pointer-events: none;
        }
        .slide.active {
            opacity: 1;
            pointer-events: auto;
        }
        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            cursor: pointer;
        }
        .slider-dots { 
            text-align: center; 
            position: absolute; 
            bottom: 25px; 
            left: 0; 
            right: 0; 
        }
        .dot { 
            height: 8px; 
            width: 8px; 
            margin: 0 4px; 
            background-color: rgba(255,255,255,0.5); 
            border-radius: 50%; 
            display: inline-block; 
            transition: background-color 0.3s ease; 
        }
        .dot.active { 
            background-color: white; 
        }
        /* === SLIDER STYLES (END) === */

        /* === GAME GRID & CATEGORY STYLES (START) === */
        .game-grid { 
            display: grid; 
            grid-template-columns: repeat(2, 1fr); 
            gap: 20px 15px;
            padding: 0 15px 15px; 
        }
        #game-list-page .game-grid { 
            grid-template-columns: repeat(2, 1fr); 
        }

        .game-item-wrapper { display: flex; flex-direction: column; align-items: center; text-align: center; }
        .game-image-link { display: block; width: 100%; aspect-ratio: 1 / 1; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: transform 0.2s ease-in-out; position: relative; background-color: #fff; }
        .game-image-link:hover { transform: translateY(-4px); box-shadow: 0 6px 15px rgba(0,0,0,0.15); }
        .game-image-link img { width: 100%; height: 100%; object-fit: cover; }
        .game-image-link[data-game-name="FootBall"], .game-image-link[data-game-name="Color Matrix"], .game-image-link[data-game-name="Lucky Jet"], .game-image-link[data-game-name="Mines Tower"], .game-image-link[data-game-name="Mines"] { cursor: pointer; }
        .game-item-name { margin-top: 10px; font-size: 0.95rem; font-weight: 600; color: var(--dark-text); }
        .game-image-link.coming-soon { filter: grayscale(80%); opacity: 0.7; pointer-events: none; cursor: not-allowed; }
        .game-image-link.coming-soon::after { content: 'COMING SOON'; position: absolute; bottom: 10px; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.7); color: white; padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; font-weight: bold; z-index: 1; }

        .category-section { padding: 0 0 15px 0; margin-top: 15px; }
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding: 0 15px; }
        .category-header h2 { font-size: 1.2rem; font-weight: 700; color: var(--dark-text); margin: 0; position: relative; padding-left: 12px; }
        .category-header h2::before { content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%); width: 4px; height: 18px;  background-color: var(--primary-green); border-radius: 2px; }
        .category-header .all-link { font-size: 0.85rem; color: #555; text-decoration: none; font-weight: 500; padding: 4px 8px; border: 1px solid #ddd; border-radius: 4px;  }
        .category-header .all-link i { margin-left: 2px; font-size: 0.7rem; }
        /* === GAME GRID & CATEGORY STYLES (END) === */
       
        /* === WINNING INFO & LEADERBOARD STYLES (START) === */
        .winning-information-section { padding: 0 15px 15px; margin-top: 15px; background-color: white; margin-left: 15px; margin-right: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .winning-information-section .category-header { padding: 15px 0; margin-bottom: 5px; }
        .winning-feed-container { display: flex; flex-direction: column; gap: 10px; height: 250px; overflow: hidden; position: relative; }
        .winning-item { display: flex; align-items: center; gap: 12px; padding: 8px 0; animation: slideInDownOld 0.5s ease-out forwards; }
        @keyframes slideInDownOld { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .winning-item.remove { animation: slideOutUpOld 0.5s ease-in forwards; }
        @keyframes slideOutUpOld { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-20px); } }
        .winner-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        .winner-details { flex-grow: 1; display: flex; align-items: center; justify-content: space-between; }
        .winner-info { display: flex; align-items: center; gap: 10px; }
        .winner-name { font-weight: 500; color: var(--dark-text); }
        .winner-game-icon { width: 40px; height: 40px; object-fit: contain; }
        .winner-amount { font-weight: 600; color: var(--primary-green); font-size: 0.95rem; }

        .earnings-chart-section { padding: 15px; background-color: white; margin: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .earnings-chart-section .category-header { padding: 0; margin-bottom: 55px; }
        .top-earners-podium { display: flex; justify-content: center; align-items: flex-end; gap: 10px; margin-bottom: 20px; min-height: 200px; }
        .podium-item { display: flex; flex-direction: column; align-items: center; text-align: center; position: relative; width: 33%; border-radius: 10px; padding-top: 40px; }
        .podium-item.rank-2 { background-color: #a4bdf6; height: 140px; }
        .podium-item.rank-1 { background-color: #ff8a8a; height: 160px; }
        .podium-item.rank-3 { background-color: #ffc977; height: 120px; }
        .podium-avatar-wrapper { position: absolute; top: 0; left: 50%; transform: translateX(-50%) translateY(-50%); width: 70px; height: 70px; }
        .podium-rank-icon { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 40px; height: auto; z-index: 2; }
        .podium-avatar { width: 70px; height: 70px; border-radius: 50%; border: 3px solid white; box-sizing: border-box; background-color:#ccc; }
        .podium-item.is-current-user .podium-avatar { box-shadow: 0 0 0 3px white, 0 0 0 6px var(--primary-green), 0 0 15px var(--primary-green); }
        .podium-details { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; color: white; width: 100%; height: 100%; }
        .podium-rank-banner { padding: 3px 20px; font-weight: bold; font-size: 0.9rem; border-radius: 4px; }
        .podium-item.rank-1 .podium-rank-banner { background-color: #d64545; }
        .podium-item.rank-2 .podium-rank-banner { background-color: #4a7fe7; }
        .podium-item.rank-3 .podium-rank-banner { background-color: #e59325; }
        .podium-name { font-size: 1rem; font-weight: 600; }
        .podium-earnings { font-size: 1rem; font-weight: 700; padding: 5px 15px; border-radius: 20px; background: rgba(255,255,255,0.25); display: inline-block; }
        .other-earners-list { display: flex; flex-direction: column; gap: 15px; }
        .earner-item { display: flex; align-items: center; gap: 15px; }
        .earner-rank { font-size: 1.1rem; font-weight: 700; color: var(--gray-text); width: 25px; text-align: center; }
        .earner-avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 3px solid transparent; box-sizing: border-box; background-color:#ccc; }
        .earner-item.is-current-user .earner-avatar { border-color: var(--primary-green); box-shadow: 0 0 10px var(--primary-green); }
        .earner-name { flex-grow: 1; font-weight: 500; color: var(--dark-text); }
        .earner-amount-badge { background-color: #eafaf1; color: var(--primary-green); padding: 8px 15px; border-radius: 20px; font-weight: 600; font-size: 0.95rem; }
        /* === WINNING INFO & LEADERBOARD STYLES (END) === */

        /* === ACCOUNT PAGE STYLES (START) === */
        #account-page { padding: 0; background-color: #f0f2f5; }
        .account-header-v2 { 
            background: var(--auth-bg-dark); /* MODIFIED */
            color: white; 
            padding: 20px 15px; 
            display: flex; 
            align-items: center; 
            gap: 15px;
        }
        .account-avatar { 
            width: 60px; 
            height: 60px; 
            border-radius: 50%; 
            border: 2px solid white; 
            object-fit: cover; 
            cursor: pointer; 
            flex-shrink: 0; 
            background-color: #ccc;
        }
        .account-info-details {
            display: flex;
            flex-direction: column;
            gap: 8px; 
        }
        #account-username {
            margin: 0;
            font-size: 1.4rem;
            font-weight: 700;
            text-transform: uppercase;
        }
        .uid-badge { 
            background: var(--orange-color); 
            padding: 4px 10px; 
            border-radius: 15px; 
            font-size: 0.8rem; 
            display: inline-flex; 
            align-items: center; 
            align-self: flex-start;
        }
        .uid-badge #uid-copy-icon { margin-left: 8px; cursor: pointer; }
        .last-login-text { 
            margin: 0; 
            font-size: 0.9rem; 
            font-weight: 500; 
        }
        .account-content-v2 {
            padding: 15px;
            margin-top: 0;
        }
        .balance-card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); text-align: center; }
        .balance-top { display: flex; justify-content: space-between; align-items: center; color: var(--gray-text); font-size: 0.9rem; }
        .balance-amount { font-size: 1.8rem; font-weight: 700; color: var(--dark-text); margin: 5px 0 10px; }
        .refresh-icon { cursor: pointer; }
        .refresh-icon.spinning { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        .account-actions-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .account-action-btn { background: #f7f8fa; border: 1px solid #ebedf0; border-radius: 8px; padding: 10px; font-size: 0.95rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .account-action-btn.deposit { color: var(--primary-green); }
        .account-action-btn.withdraw { color: var(--red-color); }
        
        .history-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
        .history-card { background: white; border-radius: 10px; padding: 15px; display: flex; align-items: center; text-decoration: none; color: var(--dark-text); box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .history-icon { font-size: 20px; color: white; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0; }
        .history-card .fa-gamepad { background-color: #3498db; }
        .history-card .fa-receipt { background-color: #9b59b6; }
        .history-card div h5 { margin: 0 0 4px; }
        .history-card div p { margin: 0; font-size: 0.8rem; color: var(--gray-text); }
        .logout-btn-container { margin-top: 20px; }
        
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1001; display: flex; justify-content: center; align-items: center; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .avatar-modal { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 340px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .avatar-modal h4 { margin: 0 0 20px; text-align: center; font-size: 1.2rem; }
        .avatar-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; }
        .avatar-grid img { width: 100%; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all 0.2s; }
        .avatar-grid img:hover { transform: scale(1.05); border-color: var(--primary-green); }
        /* === ACCOUNT PAGE STYLES (END) === */

        /* === BOTTOM NAVIGATION STYLES (START) === */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; height: 70px; background-color: white; display: flex; justify-content: space-around; align-items: flex-end; box-shadow: 0 -2px 10px rgba(0,0,0,0.08); z-index: 100; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 0 5px; box-sizing: border-box; }
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: var(--gray-text); text-decoration: none; flex: 1; height: 100%; position: relative; }
        .nav-item .nav-icon { font-size: 22px; margin-bottom: 4px; width: 24px; text-align: center; }
        .nav-item span { font-size: 0.75rem; font-weight: 500; }
        .nav-item.active { color: var(--primary-green); }
        .nav-item-center { position: relative; flex: 1.2; }
        .nav-item-center .nav-icon-bg { width: 60px; height: 60px; border-radius: 50%; background: var(--primary-green); display: flex; align-items: center; justify-content: center; position: absolute; top: -25px; left: 50%; transform: translateX(-50%); box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4); border: 4px solid var(--body-bg); }
        .nav-item-center .nav-icon { font-size: 24px; color: white; margin: 0; }
        .nav-item.nav-item-center span { color: var(--dark-text); position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); }
        .nav-item.nav-item-center.active span { color: var(--primary-green); }
        
        .nav-item-center .nav-icon-bg .nav-icon.fas.fa-gem {
            animation: gem-pulse-shine-animation 2.5s ease-in-out infinite;
        }
        @keyframes gem-pulse-shine-animation {
            0%, 100% {
                transform: scale(1);
                filter: drop-shadow(0 0 4px var(--gold-color));
            }
            50% {
                transform: scale(1.15);
                filter: drop-shadow(0 0 10px var(--gold-color)) drop-shadow(0 0 18px white);
            }
        }
        /* === BOTTOM NAVIGATION STYLES (END) === */

        /* === ACTIVITY PAGE STYLES (START) === */
        #activity-page { background-color: var(--body-bg); padding-bottom: 0; }
        .activity-header { background: var(--auth-bg-dark); color: white; padding: 20px 15px; } /* MODIFIED */
        .activity-header h2 { margin: 0 0 5px; font-size: 1.5rem; font-weight: 600; }
        .activity-header p { margin: 0; opacity: 0.9; font-size: 0.9rem; line-height: 1.4; }
        .activity-content { padding: 15px; display: flex; flex-direction: column; gap: 15px; }
        
        .activity-small-cards { background: transparent; padding: 0; box-shadow: none; }
        .activity-small-card { 
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 12px 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: background-color 0.2s ease;
            text-decoration: none;
            color: var(--dark-text);
        }
        .activity-small-card:active { background-color: #f8f8f8; }
        .activity-small-card img { width: 40px; height: 40px; margin: 0 15px 0 0; }
        .activity-small-card span { font-size: 1rem; font-weight: 600; margin-right: auto; }
        .activity-small-card .fa-chevron-right { color: var(--gray-text); font-size: 0.9rem; }

        .activity-content-cards { display: flex; flex-direction: column; gap: 15px; }
        .activity-promo-card { background-color: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); overflow: hidden; text-decoration: none; color: var(--dark-text); cursor: pointer; }
        .activity-promo-card img { width: 100%; display: block; }
        .activity-promo-card .activity-promo-title { padding: 12px 15px; font-weight: 600; font-size: 0.95rem; text-align: left; margin: 0; }
        /* === ACTIVITY PAGE STYLES (END) === */
        
        /* === POPUP MESSAGE & PROMO MODAL STYLES (START) === */
        .popup-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%); 
            background-color: rgba(30,30,30,0.95);
            color: white;
            padding: 18px 30px;
            border-radius: 12px;
            z-index: 2001;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            animation: fadeInCenter 0.4s ease-out;
            text-align: left;
            max-width: 90%;
            line-height: 1.6;
        }
        .popup-message.error { background-color: var(--red-color); text-align: center;}
        .popup-message.success { background-color: var(--primary-green); text-align: center; }
        .popup-message strong { color: var(--orange-color); }
        .popup-message .popup-message-premium-header { 
            font-size: 1.1rem; 
            font-weight: 700; 
            margin-bottom: 12px; 
            border-bottom: 1px solid rgba(255,255,255,0.2); 
            padding-bottom: 8px; 
            text-align: center;
        }
        .popup-message .popup-message-premium-header i { margin-right: 8px; }
        .popup-message .rules-table-popup {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        .popup-message .rules-table-popup th, .popup-message .rules-table-popup td {
            padding: 8px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .popup-message .rules-table-popup th {
            background-color: rgba(255,255,255,0.1);
        }

        @keyframes fadeInCenter {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .promo-modal-content {
            background-color: var(--modal-bg); color: var(--modal-text); border-radius: 16px;
            width: 100%; max-width: 340px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3); position: relative;
            animation: slideInUp 0.4s ease-out;
        }
        .promo-modal-header { text-align: center; margin-bottom: 20px; font-size: 1.2rem; font-weight: 600; }
        .promo-modal-header i { color: var(--gold-color); margin-right: 10px; }
        .promo-modal-close-btn {
            position: absolute; top: 10px; right: 10px; background: rgba(255, 255, 255, 0.1);
            color: white; border: none; border-radius: 50%; width: 30px; height: 30px;
            cursor: pointer; font-size: 1rem;
        }
        #promo-code-input {
            width: 100%; background-color: var(--modal-input-bg); border: 1px solid #444;
            border-radius: 8px; padding: 14px; color: var(--modal-text);
            font-size: 1rem; box-sizing: border-box; text-align: center; margin-bottom: 20px;
            caret-color: var(--primary-green);
        }
        #redeem-promo-code-btn { background: linear-gradient(90deg, #fd7e14, #ffc107); }
        /* === POPUP MESSAGE & PROMO MODAL STYLES (END) === */
        
        /* === GAME LOADER STYLES (START) === */
        .game-loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1002; /* Higher than pages, lower than other modals */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.3s ease-in-out;
            pointer-events: none;
            opacity: 0;
        }
        .game-loader-overlay:not(.hidden) {
            opacity: 1;
            pointer-events: auto;
        }

        .loader-card {
            background: var(--mines-bg-dark); /* Using a dark theme color */
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 280px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transform: scale(0.9);
            opacity: 0;
            animation: fadeInScaleUp 0.5s ease-out forwards;
        }

        #loader-game-image-container img {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .loader-progress-container {
            width: 100%;
            height: 8px;
            background-color: var(--modal-input-bg);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .loader-progress-bar-inner {
            height: 100%;
            width: 0%;
            background: var(--primary-green);
            border-radius: 4px;
        }
        
        .game-loader-overlay.loading .loader-progress-bar-inner {
            animation: fill-progress 2.5s linear forwards;
        }

        @keyframes fill-progress {
            from { width: 0%; }
            to { width: 100%; }
        }
        /* === GAME LOADER STYLES (END) === */
        
        /* === BAN & UPDATE OVERLAY STYLES (START) === */
        #ban-overlay, #update-overlay {
            z-index: 1003; /* Higher than regular modals */
        }
        .ban-content-card, .update-content-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 360px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            color: var(--dark-text);
        }
        .ban-icon, .update-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
        }
        .ban-icon { color: var(--red-color); }
        .update-icon { color: var(--primary-green); }

        .ban-content-card h2, .update-content-card h2 {
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }
        .ban-content-card p, .update-content-card p {
            margin: 5px 0 15px;
            color: var(--gray-text);
            line-height: 1.5;
        }
        .ban-reason-label {
            font-weight: 600;
            color: var(--dark-text);
            margin-bottom: 5px !important;
        }
        .ban-reason-text {
            font-weight: 700;
            color: var(--red-color);
            background-color: #fdeeee;
            padding: 10px;
            border-radius: 8px;
            margin-top: 0 !important;
        }
        .update-notes {
            text-align: left;
            background-color: var(--light-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            line-height: 1.6;
            max-height: 150px;
            overflow-y: auto;
        }
        .update-notes ul { padding-left: 20px; margin: 0; }
        .update-notes p:first-child { margin-top: 0; }
        .update-notes p:last-child { margin-bottom: 0; }

        #update-download-btn {
            text-decoration: none;
            display: inline-block;
            width: auto;
            padding: 14px 40px;
        }
        /* === BAN & UPDATE OVERLAY STYLES (END) === */
        
        
        /* === PAGE TRANSITION & STRUCTURE STYLES (START) === */
        @keyframes page-fade-in { from { opacity: 0; } to { opacity: 1; } }
        @keyframes page-fade-out { from { opacity: 1; } to { opacity: 0; } }
        .page-fade-in { animation: page-fade-in 0.4s ease-in-out forwards; }
        .page-fade-out { animation: page-fade-out 0.4s ease-in-out forwards; }

        #daily-tasks-page, #transaction-history-page, #game-history-page, #announcement-detail-page, #game-list-page, #football-game-page, #color-matrix-page, #mines-tower-page, #crash-game-page, #mines-game-page, #wingo-game-page, #withdraw-page, #withdraw-history-page, #payment-page { 
            padding-bottom: 0;
            display: flex;
            flex-direction: column;
            background-color: var(--body-bg);
        }
        .page-scroll-content {
            flex-grow: 1; 
            overflow-y: auto;
            background-color: var(--body-bg);
        }
        #deposit-page .page-scroll-content, #payment-page .page-scroll-content {
             background: linear-gradient(to bottom, #fdfdff, #e8eaf6);
        }
        /* === PAGE TRANSITION & STRUCTURE STYLES (END) === */

        /* === DAILY TASKS (MISSION) STYLES (START) === */
        .tasks-banner { background: var(--orange-color); padding: 20px 15px; color: white; display: flex; align-items: center; position: relative; overflow: hidden; min-height: 100px; }
        .tasks-banner-text { flex: 1; z-index: 1; }
        .tasks-banner h3 { margin: 0 0 10px; font-size: 1.4rem; font-weight: 700; }
        .tasks-banner p { margin: 0; font-size: 0.8rem; line-height: 1.5; max-width: 200px; }
        .tasks-list { padding: 15px; display: flex; flex-direction: column; gap: 15px; padding-bottom: 80px; }
        .mission-card {
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .mission-top-row, .mission-bottom-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .mission-rules-btn {
            background: none;
            border: none;
            color: var(--gray-text);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 5px;
        }
        .mission-title-group {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: var(--dark-text);
            font-size: 1rem;
            flex-grow: 1;
        }
        .mission-title-group .mission-icon {
            font-size: 1.5rem;
            color: #9b59b6;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .mission-status {
            color: var(--gray-text);
            font-size: 0.9rem;
            font-weight: 500;
            margin-left: 10px;
        }
        .mission-middle-row {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: var(--dark-text);
        }
        .mission-middle-row .progress-bar-container {
            flex-grow: 1;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        .mission-middle-row .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary-green);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        .mission-middle-row .progress-value {
            color: var(--red-color);
            font-weight: 600;
        }
        .mission-bottom-row .mission-award-label {
            font-size: 0.9rem;
            color: var(--gray-text);
        }
        .mission-bottom-row .award-value {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--orange-color);
        }
        .mission-button {
            background-color: #e9ecef;
            border: none;
            color: var(--gray-text);
            font-weight: 600;
            padding: 8px 25px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        .mission-button.claimable {
            background-color: var(--primary-green);
            color: white;
        }
        .mission-button.disabled {
            background-color: #e9ecef;
            color: var(--gray-text);
            cursor: not-allowed;
            opacity: 0.8;
        }
        .mission-type-badge {
            font-size: 0.75rem;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 10px;
            margin-left: 8px;
            color: white;
            vertical-align: middle;
        }
        .mission-type-badge.daily { background-color: var(--orange-color); }
        .mission-type-badge.weekly { background-color: #9b59b6; }
        /* === DAILY TASKS (MISSION) STYLES (END) === */

        /* === WALLET PAGE STYLES (START) === */
        #wallet-page { padding: 0; display: flex; flex-direction: column; background-color: var(--body-bg); }
        .wallet-header-green { background: var(--auth-bg-dark); color: white; text-align: center; padding: 20px 15px 30px; flex-shrink: 0; } /* MODIFIED */
        .wallet-header-green h2 { margin: 0; font-size: 1.2rem; font-weight: 600; }
        .wallet-header-green .wallet-icon { font-size: 2rem; margin: 10px 0; }
        .wallet-header-green .total-balance-amount { font-size: 2.2rem; font-weight: 700; margin: 0; }
        .wallet-header-green .total-balance-label { font-size: 0.9rem; opacity: 0.8; }
        .wallet-content-area { flex-grow: 1; overflow-y: auto; padding: 15px; margin-top: -30px; position: relative; z-index: 2; padding-bottom: 80px; }
        .wallet-main-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .wallet-progress-container { display: flex; justify-content: space-around; text-align: center; margin-bottom: 25px; }
        .progress-circle-wrapper { display: flex; flex-direction: column; align-items: center; gap: 10px; }
        .progress-circle { width: 110px; height: 110px; border-radius: 50%; display: grid; place-items: center; background: #f0f2f5; position: relative; }
        .progress-circle-inner { width: 90px; height: 90px; border-radius: 50%; background: white; display: grid; place-items: center; z-index: 1; font-weight: 700; font-size: 1.5rem; color: var(--dark-text); }
        #main-wallet-circle.animated { animation: pulse-glow 2s infinite ease-in-out; cursor: pointer; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 0 0 rgba(39, 174, 96, 0.7); } 50% { box-shadow: 0 0 10px 15px rgba(39, 174, 96, 0); } }
        .wallet-label-amount { font-weight: 600; font-size: 1.1rem; color: var(--dark-text); }
        .wallet-label-text { font-size: 0.9rem; color: var(--gray-text); }
        .wallet-transfer-btn { width: 100%; padding: 14px; border-radius: 25px; border: none; font-size: 1rem; font-weight: 600; cursor: pointer; background: var(--primary-green); color: white; margin-bottom: 25px; transition: background-color 0.2s; }
        .wallet-transfer-btn:hover { background: var(--primary-green-darker); }
        .wallet-actions-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; text-align: center; }
        .wallet-action-item { text-decoration: none; color: var(--dark-text); }
        .wallet-action-item .icon-bg { width: 50px; height: 50px; background-color: #f7f8fa; border-radius: 12px; display: grid; place-items: center; margin: 0 auto 8px; font-size: 22px; color: var(--primary-green); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .wallet-action-item span { font-size: 0.8rem; font-weight: 500; }
        /* === WALLET PAGE STYLES (END) === */

        /* === GLOBAL CHAT ICON STYLES (START) === */
        .global-chat-icon { position: fixed; bottom: 85px; right: 20px; width: 55px; height: 55px; background: var(--primary-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; text-decoration: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1004; /* Keep on top */ animation: float-animation 3s ease-in-out infinite; }
        @keyframes float-animation { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        /* === GLOBAL CHAT ICON STYLES (END) === */

        /* === CHAT PAGE STYLES (START) === */
        #chat-page { display: flex; flex-direction: column; height: 100%; width: 100%; position: fixed; top: 0; left: 0; z-index: 1000; background-color: #e5ddd5; }
        #chat-page .sticky-header .admin-status { font-size: 0.7rem; font-weight: 400; opacity: 0.8; position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); }
        #chat-messages { flex-grow: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background-image: url('https://user-images.githubusercontent.com/15075759/28719144-86dc0f70-73b1-11e7-911d-60d70fcded21.png'); }
        .message-bubble { max-width: 75%; padding: 10px 15px; border-radius: 18px; line-height: 1.4; word-wrap: break-word; font-size: 0.95rem; }
        .message-bubble.sent { background-color: #dcf8c6; color: var(--dark-text); border-bottom-right-radius: 4px; align-self: flex-end; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
        .message-container.received {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            align-self: flex-start;
            max-width: 85%;
        }
        .admin-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            flex-shrink: 0;
            border: 2px solid rgba(255, 255, 255, 0.5);
            background-color: #fff;
        }
       .message-bubble.received {
            background: linear-gradient(135deg, #f9d423,#f8992c); 
            color: var(--dark-text);
            font-weight: 500;
            border-bottom-left-radius: 4px;
            animation: colorful-glow 4s ease-in-out infinite;
        }
        @keyframes colorful-glow {
            0% { box-shadow: 0 2px 5px rgba(248, 153, 44, 0.4), 0 0 8px rgba(255, 100, 100, 0.5); }
            25% { box-shadow: 0 2px 5px rgba(39, 174, 96, 0.3), 0 0 10px rgba(100, 255, 100, 0.6); }
            50% { box-shadow: 0 2px 5px rgba(52, 152, 219, 0.3), 0 0 12px rgba(100, 100, 255, 0.5); }
            75% { box-shadow: 0 2px 5px rgba(155, 89, 182, 0.3), 0 0 10px rgba(255, 100, 255, 0.6); }
            100% { box-shadow: 0 2px 5px rgba(248, 153, 44, 0.4), 0 0 8px rgba(255, 100, 100, 0.5); }
        }
        .chat-input-area { display: flex; padding: 10px; background-color: #f0f0f0; border-top: 1px solid #e0e0e0; flex-shrink: 0; align-items: center; }
        #chat-message-input { flex-grow: 1; border: none; padding: 12px 18px; border-radius: 22px; background-color: #fff; outline: none; margin-right: 10px; font-size: 1rem; }
        .chat-file-btn { color: var(--gray-text); font-size: 20px; cursor: pointer; padding: 0 10px; }
        #chat-send-btn { background: var(--primary-green); color: white; border: none; border-radius: 50%; width: 44px; height: 44px; font-size: 18px; cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
        #chat-send-btn:active { box-shadow: none; transform: scale(0.95); }
        /* === CHAT PAGE STYLES (END) === */

        /* === PARTNER REWARDS PAGE STYLES (START) === */
        #partner-rewards-page { background-color: var(--body-bg); padding-bottom: 80px; }
        .partner-banner { background: linear-gradient(to right, #f9d423, #f8992c); color: white; padding: 20px 15px; text-align: center; position: relative; overflow: hidden; }
        .partner-banner-content { position: relative; z-index: 2; }
        .partner-banner-content h3 { margin: 0; font-size: 1rem; font-weight: 500; }
        .partner-banner-content .max-reward { font-size: 2rem; font-weight: 700; margin: 5px 0 10px; }
        .partner-stats { padding: 15px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: -30px; position: relative; z-index: 5; }
        .stat-card { background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); text-align: center; }
        .stat-card .stat-title { font-size: 0.85rem; color: var(--gray-text); margin-bottom: 8px; }
        .stat-card .stat-value { font-size: 1.2rem; font-weight: 700; color: var(--dark-text); }
        .stat-card .stat-value.red { color: var(--red-color); }
        .partner-content { padding: 0 15px 15px; display: flex; flex-direction: column; gap: 15px; }
        .partner-card { background: white; border-radius: 10px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .partner-card-header { display: flex; align-items: center; font-weight: 600; margin-bottom: 15px; font-size: 1rem; }
        .partner-card-header .title-icon { font-size: 1.2rem; margin-right: 8px; color: var(--primary-green); }
        .invitation-link-area { display: flex; align-items: center; background: var(--light-bg); border-radius: 8px; padding: 5px; }
        .invitation-link-area input { flex: 1; border: none; background: transparent; padding: 10px; color: var(--dark-text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .invitation-link-area .copy-btn { background: var(--primary-green); color: white; border: none; border-radius: 6px; padding: 10px 15px; font-size: 1rem; cursor: pointer; }
        .commission-status-card { text-align: center; }
        .commission-status-card.inactive .status-content { background: linear-gradient(135deg, #e0e0e0, #bdbdbd); color: #616161; padding: 15px; border-radius: 10px;}
        .commission-status-card.active .status-content { display: none; }
        .commission-status-card h4 { margin: 0 0 10px; font-weight: 700; }
        .commission-status-card p { margin: 0; font-size: 0.85rem; opacity: 0.9; }
        .commission-progress-bar { width: 100%; background: rgba(0,0,0,0.2); border-radius: 10px; height: 10px; margin: 15px 0; overflow: hidden; }
        .commission-progress-bar-inner { height: 100%; width: 0%; background: white; border-radius: 10px; transition: width 0.5s ease; }
        .commission-claim-area { margin-top: 15px; display: flex; justify-content: space-between; align-items: center; }
        .commission-balance .balance-title { font-size: 0.9rem; }
        .commission-balance .balance-amount { font-size: 1.5rem; font-weight: 700; }
        .claim-btn { background: var(--orange-color); color: white; padding: 10px 30px; border-radius: 20px; text-decoration: none; font-weight: 600; }
        .claim-btn.disabled { background: #ccc; color: #888; cursor: not-allowed; }
        .rules-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 0.8rem; }
        .rules-table th, .rules-table td { padding: 10px; text-align: center; border: 1px solid #eee; }
        .rules-table th { background-color: var(--primary-green); color: white; font-weight: 600; }
        .rules-table td:first-child { font-weight: 500; }
        /* === PARTNER REWARDS PAGE STYLES (END) === */
        
        /* === DEPOSIT PAGE STYLES (START) === */
        .deposit-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.07);
            margin-bottom: 20px;
            border: 1px solid #e8eaf6;
            transition: all 0.3s ease-in-out;
        }
        .deposit-card:hover {
             transform: translateY(-3px);
             box-shadow: 0 8px 25px rgba(39, 174, 96, 0.1);
        }
        .deposit-card-title {
            margin: 0 0 20px;
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--dark-text);
        }
        .amount-input-area {
            display: flex;
            align-items: center;
            border-bottom: 2px solid var(--primary-green);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .amount-input-area .currency-symbol {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark-text);
            margin-right: 15px;
        }
        #deposit-amount-input {
            flex-grow: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--dark-text);
            width: 100%;
            caret-color: var(--primary-green);
        }
        #deposit-amount-input::placeholder {
            color: #bdc3c7;
            font-weight: 500;
        }
        .quick-amount-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(65px, 1fr));
            gap: 12px;
        }
        .quick-amount-btn {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            background-color: #f7f8fa;
            color: var(--dark-text);
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }
        .quick-amount-btn:hover {
            border-color: var(--primary-green);
            background-color: #eafaf1;
            color: var(--primary-green);
        }
        .payment-channels-grid {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .payment-channel-card {
            display: flex;
            align-items: center;
            padding: 14px;
            border: 2px solid #e8eaf6;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            position: relative;
        }
        .payment-channel-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-color: #ccc;
        }
        .payment-channel-card.selected {
            border: 2px solid;
            border-image-slice: 1;
            border-image-source: linear-gradient(to right, var(--primary-green), #f8992c);
            box-shadow: 0 0 15px rgba(39, 174, 96, 0.2);
            background-color: #f8fffb;
        }
        .payment-channel-card img {
            height: 36px;
            width: 36px;
            margin-right: 15px;
            object-fit: contain;
            border-radius: 50%;
        }
        .payment-channel-card span {
            font-weight: 600;
            font-size: 1.05rem;
        }
        .deposit-submit-btn-container {
            margin-top: 20px;
            padding-bottom: 20px;
        }
        .deposit-submit-btn-container .btn {
            background: linear-gradient(to right, var(--primary-green), #2ecc71);
            transition: all 0.3s ease;
        }
        .deposit-submit-btn-container .btn:hover {
             box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        .payment-channel-card.coming-soon {
            filter: grayscale(100%);
            opacity: 0.6;
            pointer-events: none; 
            cursor: not-allowed;
        }
        .payment-channel-card.coming-soon::before {
            content: 'Coming Soon';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }
        /* === DEPOSIT PAGE STYLES (END) === */

        /* === NEW PAYMENT PAGE STYLES (START) === */
        .info-line-payment {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f2f5;
            font-size: 1rem;
        }
        .info-line-payment:last-of-type {
            border-bottom: none;
        }
        .info-line-payment .info-label {
            color: var(--gray-text);
        }
        .info-line-payment .info-value {
            font-weight: 600;
            color: var(--dark-text);
            display: flex;
            align-items: center;
        }
        .copy-btn-page {
            background: none;
            border: 1px solid var(--primary-green);
            color: var(--primary-green);
            border-radius: 5px;
            padding: 4px 10px;
            margin-left: 10px;
            cursor: pointer;
            font-size: 0.8rem;
        }
        #payment-page-submit-btn {
            background: var(--primary-green);
        }
        #payment-page-trxid-input {
            caret-color: var(--primary-green);
        }
        /* === NEW PAYMENT PAGE STYLES (END) === */
        
        /* === TRANSACTION & GAME HISTORY PAGE STYLES (START) === */
        .history-item-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .history-item-info .amount { font-size: 1.1rem; font-weight: 600; margin-bottom: 5px; }
        .history-item-info .amount.deposit { color: var(--primary-green); }
        .history-item-info .amount.withdrawal { color: var(--red-color); }
        .history-item-info .channel { font-size: 0.9rem; color: var(--dark-text); font-weight: 500; margin-bottom: 5px; }
        .history-item-info .channel .type { color: var(--gray-text); font-weight: 400; }
        .history-item-info .date, .history-item-info .invoice { font-size: 0.8rem; color: var(--gray-text); }
        .history-status { padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; font-weight: 600; text-transform: capitalize; }
        .history-status.pending { background: #fff0e1; color: var(--orange-color); }
        .history-status.successful, .history-status.won { background: #eafaf1; color: var(--primary-green); }
        .history-status.failed, .history-status.lost { background: #fdeeee; color: var(--red-color); }
        
        .game-history-card .game-info { flex: 2; }
        .game-history-card .bet-info { flex: 1; text-align: right; }
        .game-history-card .game-name { font-size: 1.1rem; font-weight: 600; margin-bottom: 5px; }
        .game-history-card .game-date { font-size: 0.8rem; color: var(--gray-text); }
        .game-history-card .bet-amount { font-size: 0.9rem; font-weight: 500; color: var(--dark-text); }
        .game-history-card .winnings { font-weight: 600; margin-top: 5px; }
        .game-history-card .winnings.won { color: var(--primary-green); }
        .game-history-card .winnings.lost { color: var(--red-color); }
        /* === TRANSACTION & GAME HISTORY PAGE STYLES (END) === */

        /* === ANNOUNCEMENT STYLES (START) === */
        .announcement-section {
            padding: 10px 15px;
            background-color: white;
            margin: 15px 15px 0;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .announcement-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f2f5;
            cursor: pointer;
        }
        .announcement-item:last-child {
            border-bottom: none;
        }
        .announcement-icon { 
            font-size: 20px;
            color: var(--primary-green);
            margin-right: 12px;
            flex-shrink: 0;
        }
        .announcement-text-content {
            flex-grow: 1;
            overflow: hidden; 
        }
        .announcement-text-content .announcement-title {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--dark-text);
            margin: 0 0 3px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .announcement-text-content .announcement-date {
            font-size: 0.75rem;
            color: var(--gray-text);
            margin: 0;
        }
        .announcement-detail-btn {
            background-color: var(--primary-green);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 6px 12px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }
        .announcement-detail-btn i {
            margin-left: 5px;
        }

        #announcement-detail-page .page-scroll-content { background-color: var(--body-bg); }
        .announcement-full-content { display: flex; flex-direction: column; gap: 15px; }
        .announcement-detail-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .announcement-detail-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 8px;
        }
        .announcement-detail-header .announcement-icon {
            margin-top: 3px; 
        }
        .announcement-detail-header h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--dark-text);
            margin: 0;
            line-height: 1.4;
        }
        .announcement-detail-date {
            font-size: 0.8rem;
            color: var(--gray-text);
            margin-bottom: 12px;
            padding-left: 32px; 
        }
        .announcement-detail-body {
            font-size: 0.9rem;
            color: var(--dark-text);
            line-height: 1.6;
            padding-left: 32px; 
        }
        .announcement-detail-body p {
            margin: 0 0 10px 0;
        }
        .announcement-detail-body p:last-child {
            margin-bottom: 0;
        }
        #announcement-detail-page .sticky-header .back-btn { color: white; } 
        /* === ANNOUNCEMENT STYLES (END) === */

        /* === FOOTBALL FANTASY GAME PAGE STYLES (NEW 1x2 SYSTEM) (START) === */
        #football-game-page .page-scroll-content {
            padding: 15px;
            padding-bottom: 80px; /* Space for fixed footer */
        }
        .football-game-header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 10px 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .football-game-timer { text-align: left; }
        .football-game-timer .timer-status { font-size: 0.85rem; font-weight: 600; color: var(--orange-color); }
        .football-game-timer .timer-countdown { font-size: 1.2rem; font-weight: 700; color: var(--dark-text); }
        .football-game-timer .timer-status.betting-open { color: var(--primary-green); }
        
        .football-actions-container { display: flex; gap: 10px; }
        .football-header-btn {
            background-color: var(--orange-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
        }
        
        #football-match-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }
        .match-item-1x2 {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            padding: 12px;
            transition: all 0.2s ease;
        }
        .match-item-1x2.finalized {
            opacity: 0.8;
        }
        .match-item-1x2.finalized.correct-pick {
            border: 2px solid var(--primary-green);
            opacity: 1;
        }
        .match-item-1x2.finalized.incorrect-pick {
            border: 2px solid var(--red-color);
            opacity: 1;
        }
        
        .match-teams-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .match-team-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 40%;
            font-weight: 600;
        }
        .match-team-display img {
            width: 30px; height: 30px;
            object-fit: contain; margin-bottom: 5px;
        }
        .match-score-display {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--dark-text);
        }

        .match-betting-options {
            display: flex;
            gap: 8px;
        }
        .bet-option {
            flex: 1;
            padding: 10px 5px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: var(--light-bg);
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .bet-option.selected {
            background-color: var(--primary-green);
            border-color: var(--primary-green-darker);
            color: white;
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        .bet-option.winner {
            background: var(--gold-color);
            color: var(--dark-text);
            border-color: var(--orange-color);
        }
        #football-betting-view.bet-placed .bet-option,
        #football-betting-view.round-closed .bet-option {
            pointer-events: none;
            opacity: 0.7;
        }
        #football-betting-view .bet-option.selected,
        #football-betting-view .bet-option.winner {
            opacity: 1;
        }
        
        #football-bet-controls-bottom {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .football-bet-amount-area {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        #football-bet-amount-input {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            caret-color: var(--primary-green);
        }
        #football-bet-amount-input::placeholder { font-weight: 400; }
        .football-bet-amount-area .currency-label { font-size: 1.1rem; font-weight: 600; }
        .football-payout-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .football-payout-table th, .football-payout-table td { padding: 8px; text-align: center; border: 1px solid #eee; }
        .football-payout-table th { background-color: #f7f8fa; font-weight: 600; }
        .football-payout-table td { font-weight: 700; color: var(--primary-green); }


        .football-game-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 101; /* Above nav bar */
        }
        .selection-counter { font-size: 1rem; color: var(--dark-text); font-weight: 600; }
        .selection-counter span { color: var(--primary-green); }
        #buy-team-btn { padding: 12px 30px; font-size: 1rem; }
        #buy-team-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        /* === FOOTBALL FANTASY GAME PAGE STYLES (END) === */
        
        /* === FOOTBALL HISTORY VIEW STYLES (PREMIUM) (START) === */
        #football-history-view { padding: 15px; }
        .history-section-title {
            font-size: 1.1rem; font-weight: 700; color: var(--dark-text);
            margin-bottom: 15px; padding-left: 10px;
            border-left: 4px solid var(--primary-green);
        }
        #football-history-content .history-bet-card-premium {
            background: white; padding: 15px; border-radius: 12px;
            margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.07);
        }
        .history-bet-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px;
        }
        .history-bet-header .round-id { font-weight: 600; font-size: 1.05rem; }
        .history-bet-header .bet-status { font-weight: 700; font-size: 1.1rem; text-transform: uppercase; }
        .history-bet-header .bet-status.won { color: var(--primary-green); }
        .history-bet-header .bet-status.lost { color: var(--red-color); }

        .history-bet-summary { 
            display: grid; grid-template-columns: repeat(2, 1fr); 
            gap: 10px; font-size: 0.95rem; padding-bottom: 10px; 
            border-bottom: 1px solid #eee; margin-bottom: 15px;
        }
        .history-bet-summary span { color: var(--gray-text); }
        .history-bet-summary strong { color: var(--dark-text); }
        .history-bet-summary .winnings-amount { color: var(--primary-green); font-weight: 700; }
        
        .history-match-list {
            display: flex; flex-direction: column; gap: 8px;
        }
        .history-match-item {
            display: flex; align-items: center; justify-content: space-between;
            background-color: var(--light-bg); padding: 8px 12px; border-radius: 8px;
        }
        .history-match-item .teams {
            font-size: 0.9rem; font-weight: 500;
        }
        .history-match-item .result-info {
            display: flex; align-items: center; gap: 10px;
        }
        .history-match-item .user-pick {
            font-size: 0.8rem; font-weight: 600; padding: 4px 10px;
            border-radius: 15px; border: 1px solid;
        }
        .history-match-item .user-pick.win {
            color: var(--primary-green); border-color: var(--primary-green); background: #eafaf1;
        }
        .history-match-item .user-pick.loss {
            color: var(--red-color); border-color: var(--red-color); background: #fdeeee;
        }
        .history-match-item .final-result {
            font-size: 0.9rem; font-weight: 700; color: var(--dark-text);
        }
        /* === FOOTBALL HISTORY VIEW STYLES (END) === */

        /* === SHARED GAME UI (START) === */
        .game-betting-balance {
            text-align: right;
            color: var(--modal-light-gray);
            font-size: 0.9rem;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .game-betting-balance span {
            color: white;
            font-weight: 600;
        }
        /* === SHARED GAME UI (END) === */

        /* === COLOR MATRIX GAME STYLES (START) === */
        #color-matrix-page .page-scroll-content {
            background: #1e2129;
            color: var(--modal-text);
            padding: 15px;
            padding-bottom: 80px;
            position: relative; /* For popup container */
        }
        .matrix-game-container {
            max-width: 400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .matrix-header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--modal-bg);
            padding: 10px 15px;
            border-radius: 12px;
        }
        .matrix-timer {
            flex-grow: 1;
            margin-right: 15px;
        }
        #matrix-round-id {
            font-size: 0.8rem;
            color: var(--modal-light-gray);
            margin: 0 0 5px;
        }
        #matrix-timer-countdown-text {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 8px;
        }
        #matrix-timer-bar-container {
            width: 100%;
            height: 6px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        #matrix-timer-bar {
            width: 100%;
            height: 100%;
            background: linear-gradient(to right, var(--modal-purple-accent), #a29bfe);
            border-radius: 3px;
            transition: width 1s linear;
        }
        #matrix-rules-btn {
            flex-shrink: 0;
        }
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 8px;
            aspect-ratio: 1 / 1;
            perspective: 1000px;
        }
        .matrix-cell {
            width: 100%;
            height: 100%;
            background-color: var(--modal-bg);
            border-radius: 8px;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
        }
        .matrix-cell.reveal {
            transform: rotateY(180deg);
        }
        .matrix-cell.winner-pop {
            animation: winner-pop-animation 0.5s ease-out forwards;
        }
        @keyframes winner-pop-animation {
            0% { transform: rotateY(180deg) translateY(0px) scale(1); }
            50% { transform: rotateY(180deg) translateY(-8px) scale(1.05); }
            100% { transform: rotateY(180deg) translateY(0px) scale(1); }
        }
        .matrix-cell.red { background-color: #e74c3c; box-shadow: 0 0 10px #e74c3c; }
        .matrix-cell.green { background-color: #2ecc71; box-shadow: 0 0 10px #2ecc71; }
        .matrix-cell.blue { background-color: #3498db; box-shadow: 0 0 10px #3498db; }
        .matrix-cell.gold { background: linear-gradient(45deg, #f1c40f, #f39c12); box-shadow: 0 0 15px #f1c40f; }

        .matrix-betting-controls {
            background-color: var(--modal-bg);
            padding: 20px;
            border-radius: 12px;
            transition: opacity 0.3s ease;
        }
        .bet-color-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        .bet-color-btn {
            padding: 12px 5px;
            border-radius: 8px;
            border: 2px solid transparent;
            background-color: var(--modal-input-bg);
            color: white;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        .bet-color-btn span { display: block; }
        .bet-color-btn small { font-size: 0.75rem; opacity: 0.7; font-weight: 400; }
        .bet-color-btn[data-color="red"]:hover, .bet-color-btn[data-color="red"].selected { border-color: #e74c3c; background-color: rgba(231, 76, 60, 0.2); }
        .bet-color-btn[data-color="green"]:hover, .bet-color-btn[data-color="green"].selected { border-color: #2ecc71; background-color: rgba(46, 204, 113, 0.2); }
        .bet-color-btn[data-color="blue"]:hover, .bet-color-btn[data-color="blue"].selected { border-color: #3498db; background-color: rgba(52, 152, 219, 0.2); }
        .bet-color-btn[data-color="gold"]:hover, .bet-color-btn[data-color="gold"].selected { border-color: #f1c40f; background-color: rgba(241, 196, 15, 0.2); }

        .bet-amount-area { display: flex; gap: 10px; margin-bottom: 20px; }
        #matrix-bet-amount {
            flex-grow: 1;
            background: var(--modal-input-bg);
            border: 1px solid #444;
            color: white;
            border-radius: 8px;
            padding: 0 15px;
            font-size: 1.1rem;
            font-weight: 600;
            width: 40%;
            caret-color: var(--primary-green);
        }
        .quick-bet-buttons { display: flex; gap: 5px; }
        .quick-bet-btn {
            background: none;
            border: 1px solid #555;
            color: var(--modal-light-gray);
            padding: 8px 10px;
            border-radius: 6px;
            cursor: pointer;
        }
        #matrix-place-bet-btn {
            background: linear-gradient(to right, var(--modal-purple-accent), #a29bfe);
        }
        #matrix-place-bet-btn:disabled {
            background: #555;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .matrix-history { 
            background-color: var(--modal-bg);
            padding: 15px;
            border-radius: 12px;
        }
        .matrix-history h4 {
            margin: 0 0 10px;
            font-size: 1rem;
            color: var(--modal-light-gray);
        }
        #matrix-history-list {
            display: flex;
            gap: 8px;
            padding-bottom: 5px;
            overflow-x: auto;
             /* Hide scrollbar */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none;  /* IE and Edge */
        }
        #matrix-history-list::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }

        .history-item {
            flex-shrink: 0;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: grid;
            place-items: center;
            font-weight: bold;
            color: white;
            font-size: 0.8rem;
            border: 2px solid rgba(255,255,255,0.2);
            background-color: #444; /* Default bg */
        }
        .history-item.red { background-color: #e74c3c; }
        .history-item.green { background-color: #2ecc71; }
        .history-item.blue { background-color: #3498db; }
        .history-item.gold { background: linear-gradient(45deg, #f1c40f, #f39c12); }
        /* === COLOR MATRIX GAME STYLES (END) === */
        
        /* === GAME RESULT POPUP STYLES (START) === */
        #matrix-result-popup-container, #lucky-jet-result-popup-container, #crash-result-popup-container {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            pointer-events: none;
            z-index: 50;
        }
        .game-result-popup {
            padding: 20px 40px;
            border-radius: 12px;
            color: white;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            animation: fadeInScaleUp 0.5s ease-out forwards;
            opacity: 0;
            pointer-events: auto;
            background: rgba(30, 30, 30, 0.9);
        }
        @keyframes fadeInScaleUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        .game-result-popup.win {
            background: #2ecc71;
            border: 2px solid #27ae60;
        }
        .game-result-popup.loss {
            background: #e74c3c;
            border: 2px solid #c0392b;
        }
        .game-result-popup .result-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 10px;
        }
        .game-result-popup .result-text {
            margin-bottom: 5px;
        }
        .game-result-popup .result-details {
            font-size: 0.9rem;
            font-weight: 500;
            opacity: 0.9;
        }
        /* === GAME RESULT POPUP STYLES (END) === */

        /* === MINES TOWER GAME STYLES (START) === */
        #mines-tower-page .page-scroll-content {
            background: #0d121c;
            color: var(--modal-text);
            padding: 15px;
            display: flex;
            flex-direction: column;
        }
        .tower-game-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            gap: 10px;
            max-width: 400px;
            margin: 0 auto;
            width: 100%;
            text-align: center;
        }
        .tower-game-container .jackpot-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: white;
            letter-spacing: 4px;
            text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            margin: 10px 0;
        }
        #tower-grid {
            display: flex;
            flex-direction: column-reverse; /* Build tower from bottom up */
            gap: 10px;
            position: relative;
        }
        .tower-level {
            display: flex;
            justify-content: space-around;
            gap: 10px;
            position: relative;
            opacity: 0.4;
            transition: opacity 0.3s;
        }
        .tower-level.active {
            opacity: 1;
        }
        .tower-tile {
            flex: 1;
            aspect-ratio: 4 / 3;
            background: var(--mines-bg-light);
            border-radius: 8px;
            transition: all 0.4s ease;
            position: relative;
            transform-style: preserve-3d;
            font-size: 2rem;
            display: grid;
            place-items: center;
        }
        .tower-tile.clickable {
            cursor: pointer;
        }
        .tower-tile.clickable:hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }
        .tower-tile.revealed {
            transform: rotateY(180deg);
        }
        .tower-tile.gem {
            background: linear-gradient(45deg, #1f4037, #99f2c8);
            box-shadow: 0 0 20px #99f2c8;
            color: white;
        }
        .tower-tile.trap {
            background: linear-gradient(45deg, #c02425, #f0cb35);
            box-shadow: 0 0 20px #f0cb35;
            color: white;
        }
        .tower-level-multiplier {
            position: absolute;
            left: -35px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--gold-color);
        }
        .tower-game-container .tower-label {
             font-size: 1.5rem;
             font-weight: 700;
             color: white;
             margin: 10px 0;
        }
        .tower-betting-controls {
            background-color: var(--mines-bg-dark);
            padding: 10px;
            border-radius: 12px;
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .tower-info-grid {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }
        .tower-info-box {
            background-color: var(--mines-bg-light);
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 0.8rem;
            text-align: left;
            flex: 1;
            color: var(--modal-light-gray);
        }
        .tower-info-box strong {
            display: block;
            color: white;
            font-size: 1rem;
            font-weight: 600;
        }
        .tower-info-box strong.next-payout {
            color: var(--gold-color);
            font-size: 1.1rem;
        }
        #tower-action-btn.cashout {
            background: var(--orange-color);
            color: white;
        }
        /* === MINES TOWER GAME STYLES (END) === */
        
        /* === NEW MINES GAME STYLES (START) === */
        #mines-game-page .page-scroll-content {
            background: #0d121c;
        }
        #mines-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            aspect-ratio: 1/1;
        }
        .mines-tile {
            width: 100%;
            aspect-ratio: 1/1;
            background: #354657; /* Same as tower-tile */
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            color: white;
        }
        .mines-tile:not(.revealed):hover {
            background: rgba(255,255,255,0.1);
            transform: translateY(-3px);
        }
        .mines-tile.revealed {
            transform: scale(0.95);
            pointer-events: none;
            cursor: default;
        }
        .mines-tile.gem {
            background: linear-gradient(45deg, #1f4037, #99f2c8);
            box-shadow: 0 0 15px #99f2c8;
        }
        .mines-tile.mine {
            background: linear-gradient(45deg, #c02425, #f0cb35);
            box-shadow: 0 0 15px #f0cb35;
            animation: shake 0.5s;
        }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); }
          20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
          40%, 60% { transform: translate3d(4px, 0, 0); }
        }
        .mines-tile.disabled {
            pointer-events: none;
            cursor: default;
            opacity: 0.6;
        }
        /* Premium Button and Controls Update */
        .mines-bet-area {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--mines-bg-light);
            border-radius: 8px;
            padding: 8px;
        }
        .mines-bet-adjust-btn {
            background: var(--mines-bg-dark);
            color: white;
            border: none;
            border-radius: 6px;
            width: 44px;
            height: 44px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }
        #mines-bet-amount-display {
            flex-grow: 1;
            color: white;
            font-size: 1.2rem;
            font-weight: 700;
            text-align: center;
        }
        #mines-action-btn {
            width: 100%;
            height: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--mines-accent-green);
            color: var(--mines-bg-dark);
        }
        #mines-action-btn:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
        }
        #mines-action-btn.cashout {
            background: var(--orange-color);
            color: white;
        }
        /* === NEW MINES GAME STYLES (END) === */

       /* === NOTUN CRASH GAME CSS (ADD KORUN) START === */
#crash-game-page {
    --bg-dark: #0d0d1f;
    --bg-medium: #1f2031;
    --bg-light: #2c2d42;
    --control-bg: #2c2d42;
    --text-light: #ffffff;
    --text-muted: #8a91a3;
    --red-crash: #f13d41;
    --green-cashout: #2ecc71;
    --yellow-placed: #f39c12;
    --blue-accent: #62a9f9;
    --gold-accent: #f5b042;
    background-color: var(--bg-dark);
    font-family: 'Poppins', sans-serif;
    /* === NOTUN PORIBORTON: Page ke scrollable kora holo === */
    /* display:flex r height:100vh shoriye deya holo */
    padding-bottom: 20px; /* Niche ektu space */
}

/* === NOTUN PORIBORTON: Game Wrapper er style bodlano holo === */
#crash-game-page .game-wrapper {
    /* Ekhon r flex container na */
    width: 100%; 
    max-width: 450px;
    background-color: var(--bg-medium);
    margin: 0 auto;
}
#crash-game-page .game-header, #crash-game-page .crash-top-info-bar, #crash-game-page .game-display { 
    /* Ekhon r flex-shrink dorkar nei */
}


/* === NOTUN HEDAR STYLE START === */
#crash-game-page .game-header { 
    padding: 10px 15px; 
    display: flex; 
    justify-content: space-between; 
    align-items: center; 
    /* === NOTUN COLOR: Dark background deya holo === */
    background-color: var(--bg-medium); 
    color: var(--text-light);
    /* Border-er color o change kora holo */
    border-bottom: 1px solid var(--bg-light); 
}
/* === NOTUN HEDAR STYLE END === */

#crash-game-page .game-header .back-btn { 
    position: static; 
    transform: none; 
    color: var(--text-light); 
    font-size: 1.2rem;
    z-index: 2;
    flex: 0;
    text-align: left;
    /* === NOTUN PORIBORTON: Bame ektu padding deya holo === */
    padding-left: 5px; 
}
#crash-game-page .game-header .logo {
    /* === NOTUN: Logo-ke center korar jonno === */
    flex: 10;
    text-align: center;
}
/* === NOTUN: Image logo-r height set kora holo === */
#crash-game-page .game-header .logo img {
    height: 30px; /* Apni chaile height kom-beshi korte paren */
    vertical-align: middle; /* Jate bhalo bhabe align thake */
}
/* Placeholder-er jonno style */
#crash-game-page .header-placeholder {
    flex: 1;
}
#crash-game-page .balance { 
    background-color: transparent; 
    padding: 5px 12px; 
    border-radius: 8px;
    display: flex; 
    align-items: center; 
    gap: 8px; 
    font-weight: 600; 
    font-size: 0.9rem;
    color: var(--text-light);
}
#crash-game-page .balance i { color: var(--text-muted); }

/* TOP INFO BAR */
#crash-game-page .crash-top-info-bar {
    display: flex; align-items: center; gap: 12px;
    padding: 5px 10px; background: var(--bg-medium);
    overflow: hidden; border-bottom: 1px solid var(--bg-light);
}
#crash-game-page .history-bar { 
    display: flex; align-items: center; gap: 10px;
    overflow-x: auto; scrollbar-width: none; flex-grow: 1;
}
#crash-game-page .history-bar::-webkit-scrollbar { display: none; }
#crash-game-page .history-bar .history-item { 
    padding: 2px 8px; border-radius: 5px; font-size: 0.8rem; 
    font-weight: 600; flex-shrink: 0; opacity: 0.9;
}
#crash-game-page .history-bar .history-item.low { color: var(--blue-accent); }
#crash-game-page .history-bar .history-item.medium { color: var(--gold-accent); }
#crash-game-page .history-bar .history-item.high { color: var(--red-crash); }

/* === NOTUN BACKGROUND STYLE START === */
#crash-game-page .game-display {
    height: 250px;
    position: relative;
    background-color: var(--bg-dark);
    background-image: url('https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/uploads%2Faviator.spribe.background%20copy.jpeg?alt=media&token=a43233ae-0b26-457f-8088-8b14b492d5b0');
    background-size: cover;
    background-position: center;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}
/* === NOTUN BACKGROUND STYLE END === */
#crash-game-page #crash-chart { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
#crash-animation-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
#crash-rocket {
    position: absolute;
    width: 60px;
    height: auto;
    transform-origin: center center;
    transition: transform 0.1s linear;
}

#crash-game-page .display-content { 
    z-index: 3; 
    text-align: center; 
    pointer-events: none;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
}
#crash-game-page .timer h1 { font-size: 2.5rem; margin: 0; font-weight: 700; color: var(--text-light); }
#crash-game-page .timer h2 { font-size: 0.9rem; color: var(--text-muted); margin: 0; font-weight: 400; }

/* Game cholar shomoy multiplier er style */
#crash-game-page .multiplier h1 { 
    font-size: 4.5rem; 
    font-weight: 700; 
    margin: 0; 
    color: var(--text-light);
    text-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
    line-height: 1.1;
}
#crash-game-page .multiplier h1::after { 
    content: 'x'; 
    font-weight: 700; 
}

/* NOTUN: Final result dekhanor jonno style */
#crash-game-page .crash-final-result {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}
#crash-game-page #crash-final-multiplier {
    font-size: 5.5rem; /* Aro boro font */
    font-weight: 700;
    color: var(--text-light); /* Shada color */
    margin: 0;
    line-height: 1;
    text-shadow: 0 0 15px rgba(255,255,255,0.4);
}
#crash-game-page #crash-final-text {
    font-size: 2.2rem; /* Choto kintu porishkar font */
    font-weight: 700;
    color: var(--red-crash); /* Lal color */
    margin-top: 10px;
    margin-bottom: 0;
}
#crash-game-page .crashed-message { display: none !important; }

#crash-game-page .chart-toggle-icon {
    position: absolute;
    bottom: 15px;
    left: 15px;
    z-index: 4;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 8px;
    background-color: rgba(0,0,0,0.3);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: color 0.3s;
}
#crash-game-page .chart-toggle-icon.hidden-state { color: var(--red-crash); }
#crash-game-page .chart-toggle-icon.shown-state { color: var(--green-cashout); }

/* CONTROLS AREA */
#crash-game-page .all-controls {
    /* === NOTUN PORIBORTON: Normal block element === */
    background-color: var(--bg-medium); 
    padding: 10px;
}
#crash-game-page .betting-area { display: flex; gap: 10px; margin-bottom: 10px; }
#crash-game-page .controls-panel { 
    flex: 1; display: flex; flex-direction: column; gap: 10px; 
    background: var(--bg-dark); padding: 15px; border-radius: 8px; color: var(--text-light);
}
#crash-game-page .bet-row { display: flex; gap: 10px; align-items: center; }
#crash-game-page .switch { position: relative; display: inline-block; width: 34px; height: 20px; }
#crash-game-page .switch input { opacity: 0; width: 0; height: 0; }
#crash-game-page .slider-toggle { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #4a4e5e; transition: .4s; border-radius: 20px; }
#crash-game-page .slider-toggle:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
#crash-game-page input:checked + .slider-toggle { background-color: var(--green-cashout); }
#crash-game-page input:checked + .slider-toggle:before { transform: translateX(14px); }
#crash-game-page .bet-row-label { flex-grow: 1; font-weight: 500; font-size: 0.9rem; }
#crash-game-page .auto-withdraw-input { background-color: var(--control-bg); border: none; color: white; padding: 8px; border-radius: 5px; width: 70px; text-align: center; font-weight: 600; font-size: 0.9rem; caret-color: var(--primary-green); }
#crash-game-page .bet-amount-wrapper { display: flex; flex-direction: column; gap: 8px; }
#crash-game-page .bet-amount-main-control { display: flex; background: var(--control-bg); border-radius: 5px; }
#crash-game-page .bet-amount-main-control .bet-amount-input { flex-grow: 1; border: none; background: transparent; color: white; text-align: center; font-size: 1.2rem; font-weight: 600; padding: 8px 0; -moz-appearance: textfield; caret-color: var(--primary-green); }
#crash-game-page .bet-amount-main-control .bet-amount-input::-webkit-outer-spin-button, #crash-game-page .bet-amount-main-control .bet-amount-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
#crash-game-page .bet-amount-main-control .bet-adjust-btn { background: transparent; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; padding: 0 15px; }
#crash-game-page .bet-amount-quick-adjust { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
#crash-game-page .bet-amount-quick-adjust .quick-bet-adjust-btn { background: var(--control-bg); border: none; color: white; padding: 10px 8px; border-radius: 5px; font-weight: 600; cursor: pointer; font-size: 1rem; }
#crash-game-page .bet-btn { width: 100%; padding: 15px 10px; border: none; border-radius: 8px; font-size: 1.2rem; font-weight: 700; cursor: pointer; transition: all 0.2s ease; }
#crash-game-page .bet-btn.waiting { background-color: var(--green-cashout); color: white; }
#crash-game-page .bet-btn.placed { background-color: var(--yellow-placed); color: white; }
#crash-game-page .bet-btn.cashing-out, #crash-game-page .bet-btn.cashed-out { background-color: var(--red-crash); color: white; font-size: 1rem !important; }
#crash-game-page .bet-btn.disabled { background-color: #4a4e5e; color: var(--text-muted); cursor: not-allowed; }

#crash-game-page .my-bets-section {
    margin-top: 10px;
    /* === NOTUN: Ekhon eta flex container hobe === */
    display: flex;
    flex-direction: column;
}

#crash-game-page .bets-body {
    /* === NOTUN: Default bhabe scroll hobe na, kintu jayga nibe === */
    /* Ekhon er height content onujayi barbe */
}

/* === NOTUN CLASS: JOKHON SCROLL LOCK HOYE JABE === */
#crash-game-page.scroll-locked .bets-body {
    /* 10-ta item-er jonno approx height */
    max-height: 350px; 
    overflow-y: auto; /* Shudhu history list scroll hobe */
}

/* Scrollbar er jonno style */
#crash-game-page.scroll-locked .bets-body::-webkit-scrollbar { 
    width: 4px; 
}
#crash-game-page.scroll-locked .bets-body::-webkit-scrollbar-track { 
    background: transparent; 
}
#crash-game-page.scroll-locked .bets-body::-webkit-scrollbar-thumb { 
    background-color: var(--control-bg); 
    border-radius: 20px; 
}
#crash-game-page .my-bets-title-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
#crash-game-page .my-bets-title-bar h3 { margin: 0; font-size: 1.1rem; color: var(--text-light); }
#crash-game-page .provably-fair { color: var(--text-muted); font-size: 0.75rem; }
#crash-game-page .bets-header { display: flex; padding: 8px 5px; font-size: 0.8rem; color: var(--text-muted); font-weight: 500; border-bottom: 1px solid var(--control-bg); }

#crash-game-page .bets-body {
    /* === NOTUN PORIBORTON: Ekhon r scroll hobe na === */
    /* overflow-y ebong max-height shoriye deya holo */
}
#crash-game-page .bet-history-row { display: flex; background-color: var(--bg-dark); border-radius: 5px; margin-bottom: 5px; color: var(--text-light); align-items: center; padding: 8px 5px; font-size: 0.9rem; }
#crash-game-page .bets-header > span, #crash-game-page .bet-history-row > span { text-align: center; }
#crash-game-page .bets-header-date, #crash-game-page .bet-history-date { width: 25%; text-align: left; }
#crash-game-page .bets-header-bet, #crash-game-page .bet-history-bet { width: 25%; }
#crash-game-page .bets-header-mult, #crash-game-page .bet-history-mult { width: 25%; }
#crash-game-page .bets-header-win, #crash-game-page .bet-history-win { width: 25%; text-align: right; }
#crash-game-page .bet-history-win.win { color: var(--green-cashout); }
#crash-game-page .bet-history-win.loss { color: var(--red-crash); }
#crash-game-page .placeholder-text { padding: 40px 20px; text-align: center; color: var(--text-muted); }
/* === NOTUN CRASH GAME CSS (ADD KORUN) END === */

        /* ======================================================= */
        /* START: WINGO GAME & WITHDRAWAL STYLES (NEWLY INTEGRATED)*/
        /* ======================================================= */
        #wingo-app-container {
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            background-color: var(--light-bg); /* Changed from green */
        }
        #wingo-app-container .wallet-section { background: white; border-radius: 10px; padding: 15px; margin: 10px; }
        #wingo-app-container .balance-info { display: flex; justify-content: center; align-items: center; text-align: center; flex-direction: column; }
        #wingo-app-container .balance-label { font-size: 0.9rem; margin-top: 5px; display: flex; align-items: center; gap: 8px; color: var(--gray-text);}
        #wingo-app-container .balance-label i { font-size: 1.2rem; color: var(--wingo-primary-green); }
        #wingo-app-container .balance-amount { font-size: 1.8rem; font-weight: 700; margin: 0; }
        #wingo-app-container .balance-refresh-wrapper { position: relative; display: inline-block; }
        #wingo-app-container #refresh-balance-btn { position: absolute; right: -25px; top: 50%; transform: translateY(-50%); font-size: 1rem; cursor: pointer; color: var(--gray-text); }
        #wingo-app-container .wallet-actions { display: flex; gap: 15px; margin-top: 20px; }
        #wingo-app-container .wallet-btn { flex: 1; padding: 12px; border: none; border-radius: 50px; font-size: 1rem; font-weight: 500; color: white; cursor: pointer; }
        #wingo-app-container .withdraw-btn { background-color: var(--red-color); }
        #wingo-app-container .deposit-btn { background-color: var(--wingo-primary-green); }
        
        #wingo-app-container .main-content { background-color: var(--light-bg); border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 10px; position: relative; }
        
        #wingo-app-container .game-modes { display: flex; justify-content: space-around; gap: 5px; padding: 10px; background-color: white; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        #wingo-app-container .mode-btn { background: var(--light-bg); border-radius: 8px; padding: 5px; text-align: center; flex: 1; color: var(--gray-text); cursor: pointer; border: 1px solid var(--wingo-border-color); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #wingo-app-container .mode-btn.active { background-color: var(--wingo-primary-green); color: white; border-color: var(--wingo-primary-green); }
        #wingo-app-container .mode-icon { font-size: 1.5rem; margin-bottom: 3px; color: var(--gray-text); }
        #wingo-app-container .mode-btn.active .mode-icon { color: white; }
        #wingo-app-container .mode-text { font-size: 0.75rem; font-weight: 500; }

        #wingo-app-container .game-container { background: var(--wingo-primary-green); color: white; border-radius: 10px; padding: 15px; margin-top: 10px; display: flex; position: relative; }
        #wingo-app-container .game-container::before, #wingo-app-container .game-container::after { content: ''; position: absolute; top: 50%; transform: translateY(-50%); width: 16px; height: 16px; background: var(--light-bg); border-radius: 50%; }
        #wingo-app-container .game-container::before { left: -8px; } #wingo-app-container .game-container::after { right: -8px; }
        #wingo-app-container .game-info { width: 50%; padding-right: 10px; box-sizing: border-box; }
        #wingo-app-container .how-to-play { display: inline-block; border: 1px solid white; border-radius: 20px; padding: 4px 10px; font-size: 0.8rem; margin-bottom: 12px; cursor:pointer; }
        #wingo-app-container .game-title { font-size: 1rem; font-weight: 500; }
        #wingo-app-container .recent-results { display: flex; gap: 5px; margin-top: 10px; }
        #wingo-app-container .result-circle { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 0.9rem; background-size: cover; box-shadow: inset 0 -2px 2px rgba(0,0,0,0.2); }
        #wingo-app-container .res-red { background-image: linear-gradient(to top, #d62e2e, #f54545); }
        #wingo-app-container .res-green { background-image: linear-gradient(to top, #1e9d64, #21b871); }
        #wingo-app-container .res-violet-red { background-image: linear-gradient(135deg, var(--wingo-violet-color) 49%, #f54545 51%); }
        #wingo-app-container .res-violet-green { background-image: linear-gradient(135deg, var(--wingo-violet-color) 49%, #21b871 51%); }
        #wingo-app-container .timer-section { width: 50%; text-align: center; border-left: 1px dashed rgba(255, 255, 255, 0.5); padding-left: 10px; box-sizing: border-box; }
        #wingo-app-container .timer-label { font-size: 0.8rem; margin-bottom: 5px; }
        #wingo-app-container .timer { display: flex; gap: 2px; font-size: 1.8rem; font-weight: bold; justify-content: center; }
        #wingo-app-container .timer span { background: white; color: var(--dark-text); padding: 5px; border-radius: 4px; min-width: 22px; text-align: center; }
        #wingo-app-container #current-game-id { font-size: 0.9rem; margin-top: 10px; letter-spacing: 1px; }

        #wingo-app-container .betting-area { background: white; border-radius: 10px; padding: 15px; margin-top: 10px; position: relative; }
        #wingo-app-container #bet-lockdown-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(4px); z-index: 10; display: none; justify-content: center; align-items: center; border-radius: 10px; }
        #wingo-app-container #bet-lockdown-timer { display: flex; gap: 10px; }
        #wingo-app-container .digit-card { width: 100px; height: 140px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 7rem; font-weight: 900; color: var(--wingo-primary-green); box-shadow: 0 4px 15px rgba(0,0,0,0.1); animation: popIn 0.5s ease; }
        @keyframes popIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        #wingo-app-container .color-options { display: flex; gap: 10px; margin-bottom: 15px; }
        #wingo-app-container .color-btn { flex: 1; padding: 10px; border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; font-size: 1rem; }
        #wingo-app-container .color-btn.green { background-color: var(--wingo-primary-green); }
        #wingo-app-container .color-btn.violet { background-color: var(--wingo-violet-color); }
        #wingo-app-container .color-btn.red { background-color: var(--red-color); }
        #wingo-app-container .numbers-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; }
        #wingo-app-container .number-btn-wrapper { background-color: #f0f0f0; border-radius: 50%; aspect-ratio: 1; display: flex; align-items: center; justify-content: center; }
        #wingo-app-container .number-btn { width: 100%; height: 100%; border-radius: 50%; border: none; background-color: transparent; cursor: pointer; font-size: 1.6rem; font-weight: 700; background-size: cover; color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); }
        #wingo-app-container .num-1, #wingo-app-container .num-3, #wingo-app-container .num-7, #wingo-app-container .num-9 { background-image: linear-gradient(to top, #1e9d64, #21b871); }
        #wingo-app-container .num-2, #wingo-app-container .num-4, #wingo-app-container .num-6, #wingo-app-container .num-8 { background-image: linear-gradient(to top, #d62e2e, #f54545); }
        #wingo-app-container .num-0 { background-image: linear-gradient(135deg, var(--wingo-violet-color) 49%, #f54545 51%); }
        #wingo-app-container .num-5 { background-image: linear-gradient(135deg, var(--wingo-violet-color) 49%, #21b871 51%); }
        #wingo-app-container .big-small { display: flex; border-radius: 8px; overflow: hidden; height: 44px; margin-top: 15px; }
        #wingo-app-container .big-btn, #wingo-app-container .small-btn { flex: 1; border: none; font-weight: bold; font-size: 1.1rem; cursor: pointer; color: white; }
        #wingo-app-container .big-btn { background-color: var(--wingo-orange-color); }
        #wingo-app-container .small-btn { background-color: var(--wingo-blue-color); }
        #wingo-app-container .spin { animation: spin-animation 0.7s ease-in-out; }
        @keyframes spin-animation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #wingo-app-container .history-tabs { display: flex; margin-top: 15px; background: white; border-radius: 8px; padding: 4px; border: 1px solid var(--wingo-border-color); }
        #wingo-app-container .history-tab { flex: 1; padding: 8px; text-align: center; cursor: pointer; font-weight: 500; color: var(--gray-text); border-radius: 6px; }
        #wingo-app-container .history-tab.active { background: var(--wingo-primary-green); color: white; }
        
        #wingo-app-container .history-content { padding-top: 10px; }

        /* === NEW Wingo Game History Style (to match the screenshot) START === */
        #wingo-app-container .history-list {
            background: white;
            border-radius: 8px;
            padding: 0; /* Padding will be on the items */
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        #wingo-app-container .history-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #f0f2f5;
        }
        #wingo-app-container .history-item:last-child {
            border-bottom: none;
        }
        #wingo-app-container .history-item .period {
            flex: 2;
            font-weight: 500;
            font-size: 0.9rem;
            color: var(--dark-text);
        }
        #wingo-app-container .history-item .number {
            flex: 1;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 700;
        }
        #wingo-app-container .history-item .size {
            flex: 1;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--dark-text);
        }
        #wingo-app-container .history-item .colors {
            flex: 1;
            display: flex;
            justify-content: flex-end;
            gap: 5px;
        }
        #wingo-app-container .color-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
        }
        #wingo-app-container .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            gap: 20px;
        }
        #wingo-app-container .page-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            font-size: 1.2rem;
        }
        /* === NEW Wingo Game History Style (to match the screenshot) END === */
        
        #wingo-app-container .my-history-summary { padding: 10px; }
        #wingo-app-container .rank-display {
            background: linear-gradient(45deg, #ffb822, #ff8c00);
            color: white;
            padding: 12px 18px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 15px rgba(255, 165, 0, 0.4);
        }
        #wingo-app-container .rank-display i { font-size: 2.5rem; margin-right: 15px; }
        #wingo-app-container .rank-text { display: flex; flex-direction: column; line-height: 1.2; }
        #wingo-app-container .rank-text span { font-size: 0.9rem; opacity: 0.9; }
        #wingo-app-container .rank-text strong { font-size: 1.2rem; }
        #wingo-app-container .income-stats { display: flex; gap: 10px; margin-top: 15px; }
        #wingo-app-container .income-stat-box {
            flex: 1;
            background: white;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        #wingo-app-container .stat-label { font-size: 0.8rem; color: var(--gray-text); margin: 0 0 5px 0; }
        #wingo-app-container .stat-amount { font-size: 1rem; font-weight: 700; margin: 0; }
        #wingo-app-container .stat-amount.positive-income { color: var(--wingo-primary-green); }
        #wingo-app-container .stat-amount.negative-income { color: var(--red-color); }

        #wingo-app-container .my-history-list { padding: 0; }
        #wingo-app-container .my-history-item { display: flex; background: white; border-radius: 10px; margin: 0 10px 10px 10px; padding: 15px; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        #wingo-app-container .bet-type-icon { width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; margin-right: 15px; text-transform: capitalize; flex-shrink: 0; }
        #wingo-app-container .bet-details { flex-grow: 1; }
        #wingo-app-container .bet-details p { margin: 0; }
        #wingo-app-container .bet-details .period { font-weight: 600; font-size: 0.9rem; }
        #wingo-app-container .bet-details .date { font-size: 0.8rem; color: var(--gray-text); }
        #wingo-app-container .bet-status { text-align: right; }
        #wingo-app-container .bet-status .status-text { display: block; border: 1px solid; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 500; margin-bottom: 4px; }
        #wingo-app-container .bet-status.succeed .status-text { color: var(--wingo-primary-green); border-color: var(--wingo-primary-green); }
        #wingo-app-container .bet-status.failed .status-text { color: var(--red-color); border-color: var(--red-color); }
        #wingo-app-container .bet-status .amount { font-weight: 600; }
        #wingo-app-container .bet-status.succeed .amount { color: var(--wingo-primary-green); }
        #wingo-app-container .bet-status.failed .amount { color: var(--red-color); display: flex; align-items: center; justify-content: flex-end; }
        #wingo-app-container .bet-status.failed .fail-icon { width: 16px; height: 16px; margin-right: 4px;}

        #wingo-app-container .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; }
        #wingo-app-container .modal-content { --modal-color: var(--wingo-primary-green); background: white; width: 90%; max-width: 500px; border-radius: 16px; animation: slideUp 0.3s ease-out; overflow: hidden; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        #wingo-app-container .modal-content.bottom-sheet { align-self: flex-end; border-top-left-radius: 16px; border-top-right-radius: 16px; border-bottom-left-radius: 0; border-bottom-right-radius: 0;}
        #wingo-app-container .modal-colored-header { background-color: var(--modal-color); padding: 15px 15px 40px 15px; border-bottom-left-radius: 50% 20px; border-bottom-right-radius: 50% 20px; color: white; text-align: center; }
        #wingo-app-container #modal-selection-display { background-color: white; color: var(--modal-color); border: 1px solid var(--modal-color); border-radius: 8px; padding: 10px; font-size: 1.1rem; font-weight: bold; margin: 0 auto; max-width: 200px; }
        #wingo-app-container .modal-body { padding: 15px; }
        #wingo-app-container .modal-body .balance-label { margin-bottom: 15px; color: var(--dark-text); font-weight: 500;}
        #wingo-app-container .preset-amounts { display: flex; gap: 10px; margin-bottom: 20px; }
        #wingo-app-container .preset-btn { flex: 1; padding: 8px; border: 1px solid #ebedf0; border-radius: 5px; background: white; cursor: pointer; }
        #wingo-app-container .preset-btn.active { background-color: var(--modal-color); color: white; border-color: var(--modal-color); }
        #wingo-app-container .amount-control { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        #wingo-app-container .amount-control label { font-weight: 500; }
        #wingo-app-container .quantity-selector { display: flex; align-items: center; border: 1px solid #ebedf0; border-radius: 5px; overflow: hidden; }
        #wingo-app-container .quantity-btn { width: 32px; height: 32px; border: none; background: #f0f0f0; font-size: 1.5rem; color: var(--dark-text); }
        #wingo-app-container .quantity-input { width: 60px; height: 32px; border: none; text-align: center; font-size: 1rem; -moz-appearance: textfield; caret-color: var(--primary-green); }
        #wingo-app-container .quantity-input::-webkit-outer-spin-button, #wingo-app-container .quantity-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        #wingo-app-container .modal-footer { display: flex; gap: 10px; padding: 0 15px 15px 15px; }
        #wingo-app-container .modal-footer-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: bold; }
        #wingo-app-container #cancel-bet { background: #ebedf0; color: var(--dark-text); }
        #wingo-app-container #confirm-bet { background: var(--modal-color); color: white; }

        /* === WINGO CHART: Styles updated for new layout === */
        #wingo-app-container #chart-content { background: white; border-radius: 8px; padding: 0 10px; }
        #wingo-app-container #chart-list-container { position: relative; }
        #wingo-app-container #chart-svg-overlay { position: absolute; top: 0; left: 0; pointer-events: none; }
        #wingo-app-container .chart-item { display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--wingo-border-color); }
        #wingo-app-container .chart-item:last-child { border-bottom: none; }
        #wingo-app-container .chart-period { flex-shrink: 0; font-size: 0.8rem; color: var(--gray-text); font-weight: 500; }
        #wingo-app-container .chart-size-indicator { flex-shrink: 0; margin-right: 10px; } /* Moved & added margin */
        #wingo-app-container .chart-numbers { flex-grow: 1; display: flex; justify-content: space-around; padding: 0 5px; }
        #wingo-app-container .chart-num-circle { width: 26px; height: 26px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 0.9rem; color: var(--gray-text); background-color: #f0f0f0; }
        #wingo-app-container .chart-num-circle.highlight { color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.2); background-size: cover; }
        #wingo-app-container .chart-num-circle.highlight.green { background-image: linear-gradient(to top, #1e9d64, #21b871); }
        #wingo-app-container .chart-num-circle.highlight.red { background-image: linear-gradient(to top, #d62e2e, #f54545); }
        #wingo-app-container .chart-num-circle.highlight.violet-green { background-image: linear-gradient(135deg, var(--wingo-violet-color) 49%, #21b871 51%); }
        #wingo-app-container .chart-num-circle.highlight.violet-red { background-image: linear-gradient(135deg, var(--wingo-violet-color) 49%, #f54545 51%); }
        #wingo-app-container .chart-size-icon { width: 22px; height: 22px; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.8rem; }
        #wingo-app-container .chart-size-icon.big { background-color: var(--wingo-orange-color); }
        #wingo-app-container .chart-size-icon.small { background-color: var(--wingo-blue-color); }
       
        #withdraw-page, #withdraw-history-page {
            max-width: 100%; margin: 0 auto; background-color: var(--light-bg);
            height: 100vh;
        }
        #withdraw-page .page-scroll-content, #withdraw-history-page .page-scroll-content {
            flex-grow: 1; overflow-y: auto; background-color: var(--light-bg);
        }
        #withdraw-page .withdraw-header { background: white; display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid var(--wingo-border-color); position: sticky; top: 0; z-index: 10; }
        #withdraw-page .withdraw-header .back-link { flex: 1; text-align: left; text-decoration: none; color: var(--dark-text); font-size: 1.1rem; cursor: pointer; }
        #withdraw-page .withdraw-header .title { flex: 2; font-size: 1.2rem; font-weight: 700; text-align: center; }
        #withdraw-page .withdraw-header .history-link { flex: 1; text-align: right; text-decoration: none; color: var(--gray-text); font-size: 0.9rem; font-weight: 500;}
        #withdraw-page .balance-card { background: linear-gradient(135deg, #28c76f, #21b871); color: white; padding: 20px; margin: 15px; border-radius: 12px; position: relative; overflow: hidden; }
        #withdraw-page .balance-card::before { content: ''; position: absolute; bottom: -50px; right: -50px; width: 150px; height: 150px; background: rgba(255,255,255,0.1); border-radius: 50%;}
        #withdraw-page .balance-card .balance-label { font-size: 0.9rem; opacity: 0.9; margin: 0 0 5px 0; }
        #withdraw-page .balance-card .balance-amount-wrapper { display: flex; align-items: center; gap: 10px; }
        #withdraw-page .balance-card .balance-amount { font-size: 2rem; font-weight: 700; margin: 0; }
        #withdraw-page .withdraw-content-wrapper { padding: 0 15px; }
        #withdraw-page .method-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        #withdraw-page .method-tab { flex-grow: 1; flex-basis: 30%; padding: 12px; border-radius: 8px; background: white; border: 1px solid var(--wingo-border-color); cursor: pointer; text-align: center; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 8px; }
        #withdraw-page .method-tab.active { background-color: var(--wingo-primary-green); color: white; border-color: var(--wingo-primary-green); box-shadow: 0 4px 10px rgba(33, 184, 113, 0.3); }
        #withdraw-page .method-tab i { font-size: 1.2rem; }
        #withdraw-page .account-selection { background: white; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid var(--wingo-border-color); cursor: pointer; }
        #withdraw-page #selected-account-display { display: flex; align-items: center; justify-content: space-between; }
        #withdraw-page #selected-account-display p { margin: 0; }
        #withdraw-page #selected-account-display .account-name { font-weight: 600; }
        #withdraw-page #selected-account-display .account-details { font-size: 0.9rem; color: var(--gray-text); word-break: break-all; }
        #withdraw-page .add-account-btn { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 100%; border: none; padding: 0; color: var(--gray-text); font-size: 0.9rem; }
        #withdraw-page .add-account-btn i { font-size: 1.5rem; margin-bottom: 8px; }
        #withdraw-page .withdraw-form { background: white; padding: 20px; border-radius: 12px; }
        #withdraw-page .amount-input-wrapper { display: flex; align-items: center; border-bottom: 1px solid var(--wingo-border-color); padding-bottom: 10px; }
        #withdraw-page .amount-input-wrapper .unit { font-size: 1.8rem; font-weight: 700; color: var(--dark-text); padding-right: 10px; }
        #withdraw-page #withdraw-amount-input { border: none; outline: none; font-size: 1.8rem; font-weight: 700; width: 100%; background: transparent; caret-color: var(--primary-green); }
        #withdraw-page .info-row { display: flex; justify-content: space-between; font-size: 0.9rem; margin-top: 15px; }
        #withdraw-page #all-btn { background: none; border: 1px solid var(--wingo-primary-green); color: var(--wingo-primary-green); padding: 2px 10px; border-radius: 15px; cursor: pointer; margin-left: 10px; }
        #withdraw-page .main-withdraw-btn { width: 100%; padding: 15px; background: var(--wingo-primary-green); color: white; border: none; border-radius: 50px; font-size: 1.1rem; font-weight: 600; margin-top: 25px; cursor: pointer; }
        #withdraw-page .rules-section { background: white; padding: 15px; border-radius: 12px; margin-top: 15px; margin-bottom: 20px; }
        #withdraw-page .rule-item { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; margin-bottom: 10px; }
        #withdraw-page .rule-item:last-child { margin-bottom: 0; }
        #withdraw-page .rule-item .icon { color: var(--wingo-primary-green); }
        #withdraw-page .rule-item .value { color: var(--red-color); font-weight: 500; }
       
        #withdraw-history-page .history-list-container { padding: 15px; }
        #withdraw-history-page .history-item-w {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        #withdraw-history-page .history-item-w .details p {
            margin: 0;
            line-height: 1.4;
        }
        #withdraw-history-page .history-item-w .details .amount {
            font-weight: 600;
            font-size: 1.1rem;
        }
        #withdraw-history-page .history-item-w .details .date {
            font-size: 0.8rem;
            color: var(--gray-text);
        }
        #withdraw-history-page .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
        }
        #withdraw-history-page .status-badge.pending { background-color: var(--orange-color); }
        #withdraw-history-page .status-badge.approved { background-color: var(--wingo-primary-green); }
        #withdraw-history-page .status-badge.failed { background-color: var(--red-color); }
        
        #wingo-app-container #how-to-play-modal .modal-content {
            padding: 0;
            animation: popIn 0.3s ease-out;
        }
        #wingo-app-container #how-to-play-modal .rules-header {
            background-color: var(--wingo-primary-green);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 1.1rem;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
        }
        #wingo-app-container #how-to-play-modal .rules-body {
            padding: 15px;
            font-size: 0.9rem;
            color: var(--dark-text);
            max-height: 60vh;
            overflow-y: auto;
        }
        #wingo-app-container #how-to-play-modal .rules-body p {
            line-height: 1.5;
        }
        #wingo-app-container #how-to-play-modal .rules-list {
            list-style: none;
            padding: 0;
            margin-top: 15px;
        }
        #wingo-app-container #how-to-play-modal .rules-list li {
            margin-bottom: 12px;
            line-height: 1.6;
        }
        #wingo-app-container #how-to-play-modal .rules-list strong {
            text-transform: capitalize;
        }
        #wingo-app-container #how-to-play-modal .rules-footer {
            padding: 15px;
        }
        #wingo-app-container #how-to-play-modal .close-rules-btn {
            width: 100%;
            background-color: var(--wingo-primary-green);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* NEW: Add Account Modal Styles (FIXED) */
        #add-account-modal { z-index: 1002; /* Ensure it's on top of the page */ }
        #add-account-modal .modal-content {
            background: white;
            border-radius: 16px;
            animation: popIn 0.3s ease-out;
            width: 90%;
            max-width: 400px;
        }
        #add-account-modal .modal-header {
            padding: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-align: center;
            position: relative;
        }
        #add-account-modal .close-btn {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--gray-text);
        }
        #add-account-modal .modal-body { padding: 20px; }
        #add-account-modal #account-modal-prompt {
            font-size: 0.9rem;
            color: var(--gray-text);
            text-align: center;
            margin-bottom: 15px;
        }
        #add-account-modal #account-modal-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--wingo-border-color);
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
            caret-color: var(--primary-green);
        }
        #add-account-modal .modal-footer {
            padding: 0 20px 20px 20px;
        }
        #add-account-modal #save-account-btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            font-size: 1rem;
            font-weight: 600;
            background: var(--wingo-primary-green);
            color: white;
        }
        /* ======================================================= */
        /* END: WINGO GAME & WITHDRAWAL STYLES                     */
        /* ======================================================= */

    </style>
    <!-- === STYLES (END) === -->
</head>
<body>

    <!-- === PREMIUM AUTH UPDATE: Splash Screen (START) === -->
    <div id="splash-screen">
        <img src="https://firebasestorage.googleapis.com/v0/b/ng-mods-x2.appspot.com/o/AddText_06-15-05.16.37.png?alt=media&token=4e15f320-e569-4069-bf5d-5b48e407026d" alt="Logo">
        <div class="splash-loader"></div>
    </div>
    <!-- === PREMIUM AUTH UPDATE: Splash Screen (END) === -->

    <!-- === BAN & UPDATE OVERLAYS (START) === -->
    <div id="update-overlay" class="modal-overlay hidden">
        <div class="update-content-card">
            <i class="fas fa-cloud-download-alt update-icon"></i>
            <h2>Update Available</h2>
            <p>A new version of 1x Mall Bet is available. Please update to continue.</p>
            <div id="update-notes-container" class="update-notes">
                <!-- Release notes will be injected here -->
            </div>
            <a href="#" id="update-download-btn" class="btn btn-primary" target="_blank" rel="noopener noreferrer">Download Update</a>
        </div>
    </div>
    <div id="ban-overlay" class="modal-overlay hidden">
        <div class="ban-content-card">
            <i class="fas fa-gavel ban-icon"></i>
            <h2>Account Suspended</h2>
            <p>Your account has been temporarily suspended.</p>
            <p class="ban-reason-label">Reason:</p>
            <p id="ban-reason-text" class="ban-reason-text">Loading reason...</p>
            <p class="ban-contact-info" style="font-weight: 600;">Please contact customer support for assistance.</p>
        </div>
    </div>
    <!-- === BAN & UPDATE OVERLAYS (END) === -->

    <!-- === GAME LOADER OVERLAY (START) === -->
    <div id="game-loader-overlay" class="game-loader-overlay hidden">
        <div class="loader-card">
            <div id="loader-game-image-container">
                <!-- Game image will be injected here by JS -->
            </div>
            <div class="loader-progress-container">
                <div class="loader-progress-bar-inner"></div>
            </div>
        </div>
    </div>
    <!-- === GAME LOADER OVERLAY (END) === -->

    <!-- === POPUP & MODAL CONTAINERS (START) === -->
    <div id="popup-container"></div>
    <div id="avatar-modal-overlay" class="modal-overlay hidden">
        <div class="avatar-modal">
            <h4>Choose Your Avatar</h4>
            <div id="avatar-selection-grid" class="avatar-grid"></div>
        </div>
    </div>
    <div id="promo-modal-overlay" class="modal-overlay hidden">
        <div class="promo-modal-content">
            <button class="promo-modal-close-btn"></button>
            <div class="promo-modal-header"><i class="fas fa-gift"></i>Redeem Gift Code</div>
            <input type="text" id="promo-code-input" placeholder="Enter your code">
            <button class="btn btn-primary" id="redeem-promo-code-btn">Redeem</button>
        </div>
    </div>
    <!-- === POPUP & MODAL CONTAINERS (END) === -->

    <div class="container">
        <!-- === LOGIN PAGE (REWORKED) (START) === -->
        <div id="login-page" class="auth-page no-scroll hidden">
            <div class="auth-container">
                <div class="auth-form-header">
                    <img src="https://firebasestorage.googleapis.com/v0/b/ng-mods-x2.appspot.com/o/AddText_06-15-05.16.37.png?alt=media&token=4e15f320-e569-4069-bf5d-5b48e407026d" alt="Logo">
                    <h2>Welcome Back</h2>
                    <p>Log in to your account</p>
                </div>
                <div class="input-wrapper">
                    <i class="fas fa-user input-icon"></i>
                    <input type="text" id="login-username" placeholder="Username">
                </div>
                <div class="input-wrapper">
                    <i class="fas fa-lock input-icon"></i>
                    <input type="password" id="login-password" placeholder="Password">
                    <i class="fas fa-eye-slash eye-icon" id="login-eye"></i>
                </div>
                <div class="button-container" style="margin-top:30px;">
                    <button class="btn btn-primary" id="login-btn">Log In</button>
                </div>
                <div class="auth-switch-link">
                    Don't have an account? <a href="#" id="register-link">Sign Up</a>
                </div>
            </div>
        </div>
        <!-- === LOGIN PAGE (REWORKED) (END) === -->
        
        <!-- === REGISTER PAGE (REWORKED) (START) === -->
        <div id="register-page" class="auth-page no-scroll hidden">
             <button class="back-btn" id="register-back"><i class="fas fa-arrow-left"></i></button>
            <div class="auth-container">
                <div class="auth-form-header">
                    <h2>Create Account</h2>
                    <p>Get started with 1x Mall Bet</p>
                </div>
                <form id="register-form">
                    <div class="input-wrapper">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="register-username" placeholder="Username (6-12 chars)" required>
                    </div>
                    <!-- MODIFIED: Phone number input with fixed country code -->
                    <div class="input-wrapper">
                        <i class="fas fa-phone input-icon"></i>
                        <div class="country-code-display">
                            <span>+880</span>
                        </div>
                        <input type="tel" id="register-phone" placeholder="Phone Number (11 digits)" required>
                    </div>
                    <div class="input-wrapper">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="register-password" placeholder="Password (min 6 chars)" required>
                        <i class="fas fa-eye-slash eye-icon" id="register-eye"></i>
                    </div>
                    <div class="input-wrapper">
                        <i class="fas fa-check-circle input-icon"></i>
                        <input type="password" id="register-confirm-password" placeholder="Confirm Password" required>
                        <i class="fas fa-eye-slash eye-icon" id="confirm-eye"></i>
                    </div>
                    <div class="input-wrapper">
                        <i class="fas fa-users input-icon"></i>
                        <input type="text" id="register-invite-code" placeholder="Invite Code (Optional)">
                    </div>
                    <div class="button-container" style="margin-top:25px;">
                        <button type="submit" class="btn btn-primary" id="register-btn">Register</button>
                    </div>
                </form>
                <div class="auth-switch-link">
                    Already have an account? <a href="#" id="login-link">Log In</a>
                </div>
            </div>
        </div>
        <!-- === REGISTER PAGE (REWORKED) (END) === -->
        
        <!-- === DASHBOARD PAGE (START) === -->
        <div id="dashboard-page" class="auth-page hidden">
            <!-- NEW PREMIUM HEADER -->
            <div class="premium-sticky-header">
                <div class="header-left">
                    <img src="https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/uploads%2FAddText_06-28-01.54.40.png?alt=media&token=0b669439-e5a9-4fb6-8cac-e492d5564169" alt="Logo" class="premium-header-logo">
                </div>
                <div class="header-right">
                    <a href="#" id="promo-code-btn-premium" class="premium-header-icon"><i class="fas fa-gift"></i></a>
                    <div class="premium-balance-display">
                        <span id="premium-header-balance">0.00</span>
                        <i class="fas fa-user-circle premium-header-avatar"></i>
                    </div>
                </div>
            </div>
            
            <div class="slider-container"><div class="slider-wrapper"></div><div class="slider-dots"></div></div>
            
            <div class="announcement-section">
                <div class="announcement-item" data-announcement-id="1">
                    <i class="fas fa-bullhorn announcement-icon"></i>
                    <div class="announcement-text-content">
                        <p class="announcement-title">Welcome to 1x Mall Bet!</p>
                        <p class="announcement-date">2024-03-05 13:13:52</p>
                    </div>
                    <button class="announcement-detail-btn">Detail <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <div id="dashboard-games-container">
                <!-- Game categories will be dynamically injected here -->
            </div>
            
            <!-- Yesterday's Earnings Chart -->
            <div class="earnings-chart-section">
                <div class="category-header">
                    <h2>Yesterday's Earnings Chart</h2>
                </div>
                <div class="earnings-chart-content">
                    <div id="top-earners-podium" class="top-earners-podium">
                    
                        <!-- Top 3 podium will be injected here by JS -->
                    </div>
                    <div id="other-earners-list" class="other-earners-list">
                        <!-- Ranks 4-10 list will be injected here by JS -->
                    </div>
                </div>
            </div>

            <!-- Winning Information Section -->
            <div class="winning-information-section">
                <div class="category-header">
                    <h2>Winning Information</h2>
                </div>
                <div id="winning-feed-container" class="winning-feed-container">
                    <!-- Dynamic winner items will be injected here by JS -->
                </div>
            </div>

        </div>
        <!-- === DASHBOARD PAGE (END) === -->

        <!-- === GAME LIST PAGE (START) === -->
        <div id="game-list-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" id="game-list-back-btn"><i class="fas fa-arrow-left"></i></div>
                <h2 id="game-list-title">Games</h2>
            </div>
            <div class="page-scroll-content" style="padding: 15px;">
                <div id="game-list-grid" class="game-grid">
                    <!-- Full list of games will be injected here -->
                </div>
            </div>
        </div>
        <!-- === GAME LIST PAGE (END) === -->

    <!-- === NOTUN CRASH GAME HTML (REPLACE KORUN) START === -->
<div id="crash-game-page" class="auth-page hidden">
    <div class="game-wrapper">
    <header class="game-header"> <!-- blue-header class remove kora holo -->
    <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
    <!-- Text logo-r bodole ekhon image logo -->
    <div class="logo">
        <img src="https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/uploads%2F275e5653fc98dbd4d97afc75a6809c93.png?alt=media&token=d15f982a-cb63-4658-824b-895ec0824f8b" alt="1xMall Logo">
    </div>
    <div class="header-placeholder"></div> <!-- Placeholder to balance flexbox -->
</header>
    <div class="crash-top-info-bar">
        <div class="history-bar" id="crash-history-bar">
            <!-- History items populated here -->
        </div>
    </div>
    <main class="game-display">
        <canvas id="crash-chart"></canvas>
        <div id="crash-animation-container">
            <img id="crash-rocket" src="https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/uploads%2Fpngimg.com%20-%20rockets_PNG101054.png?alt=media&token=55a51973-bb41-4410-832e-9e20fe1d297a" alt="rocket" class="hidden">
        </div>
        <div id="crash-result-popup-container"></div>
        <div class="display-content">
    <!-- Round shuru howar ager jonno -->
    <div class="timer" id="crash-timer">
        <h1 id="crash-countdown">Waiting...</h1>
        <h2>FOR NEW ROUND</h2>
    </div>
    
    <!-- Game cholar shomoy er jonno -->
    <div class="multiplier" id="crash-multiplier-el" style="display: none;">
        <h1 id="crash-multiplier-display">1.00</h1>
    </div>

    <!-- NOTUN: Shudhu crash howar por result dekhanor jonno -->
    <div class="crash-final-result" id="crash-final-result-el" style="display: none;">
        <h1 id="crash-final-multiplier">9.71x</h1>
        <h2 id="crash-final-text">Crashed @ 9.71x</h2>
    </div>
</div>
        <div id="crash-chart-toggle" class="chart-toggle-icon shown-state">
            <i class="fas fa-chart-line"></i>
        </div>
    </main>
    <footer class="all-controls">
        <div class="betting-area">
            <!-- Balance display is now part of the controls panel -->
            <div class="controls-panel" data-panel-id="1">
                <div class="crash-balance-display-area">
                    <span>Balance</span>
                    <span id="crash-balance-amount">0.00</span>
                </div>
                <div class="bet-amount-wrapper">
                    <div class="bet-amount-main-control">
                        <button class="bet-adjust-btn" data-action="minus">-</button>
                        <input type="number" class="bet-amount-input" value="30" step="1" min="30">
                        <button class="bet-adjust-btn" data-action="plus">+</button>
                    </div>
                    <div class="bet-amount-quick-adjust">
                        <button class="quick-bet-adjust-btn" data-action="half">/2</button>
                        <button class="quick-bet-adjust-btn" data-action="double">x2</button>
                    </div>
                </div>
                <div class="bet-row">
                    <span class="bet-row-label">Auto Bet</span>
                    <label class="switch"><input type="checkbox" class="autobet-toggle"><span class="slider-toggle"></span></label>
                </div>
                <div class="bet-row">
                    <span class="bet-row-label">Auto Cashout</span>
                    <input type="number" class="auto-withdraw-input" value="2.00" step="0.01" min="1.01">
                    <label class="switch"><input type="checkbox" class="autowithdraw-toggle"><span class="slider-toggle"></span></label>
                </div>
                <button class="bet-btn waiting">Bet</button>
            </div>
        </div>
        <section class="my-bets-section">
            <div class="my-bets-title-bar">
                <h3>My Bets</h3>
                <div class="provably-fair">Crash ID: <span id="crash-id-display">...</span></div>
            </div>
            <div class="bets-header">
                <span class="bets-header-date">Date</span>
                <span class="bets-header-bet">Bet</span>
                <span class="bets-header-mult">Multiplier</span>
                <span class="bets-header-win">Win</span>
            </div>
            <div class="bets-body" id="crash-my-bets-body">
                <!-- Bet history populated here -->
            </div>
        </section>
    </footer>
    </div>
</div>
<!-- === NOTUN CRASH GAME HTML (REPLACE KORUN) END === -->
        
        <!-- === FOOTBALL FANTASY GAME PAGE (REWORKED) (START) === -->
        <div id="football-game-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Football Fantasy
            </div>
            <div class="page-scroll-content">
                <div class="football-game-header-info">
                    <div class="football-game-timer">
                        <div class="timer-status" id="football-timer-status">Initializing...</div>
                        <div class="timer-countdown" id="football-timer-countdown">00:00:00</div>
                    </div>
                    <div class="football-actions-container">
                        <button class="football-header-btn" id="football-history-btn"><i class="fas fa-history"></i> History</button>
                    </div>
                </div>
                
                <div id="football-betting-view">
                    <p id="football-selection-prompt" style="text-align:center; color: var(--gray-text); font-size: 0.9rem; margin-bottom: 15px;">Select an outcome for every match.</p>

                    <div id="football-match-list">
                        <!-- 1x2 Match items will be dynamically injected here -->
                    </div>
                    
                    <!-- New Bet Controls at the bottom -->
                    <div id="football-bet-controls-bottom">
                        <div class="football-bet-amount-area">
                            <span class="currency-label">Bet Amount:</span>
                            <input type="number" id="football-bet-amount-input" value="30" min="30" placeholder="Min 30">
                        </div>
                        <table class="football-payout-table" id="football-dynamic-payout-table">
                            <thead>
                                <tr><th>Correct Picks</th><th>Winnings</th></tr>
                            </thead>
                            <tbody>
                                <tr><td>7-9</td><td data-tier="low">90</td></tr>
                                <tr><td>10-12</td><td data-tier="mid">300</td></tr>
                                <tr><td>13-18</td><td data-tier="high">30,000</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="football-history-view" class="hidden">
                    <div id="football-history-content">
                        <!-- Premium History content will be injected here -->
                    </div>
                </div>
            </div>
            <div class="football-game-footer hidden" id="football-game-footer">
                <div class="selection-counter">Selected: <span id="selected-teams-count">0</span>/18</div>
                <button class="btn btn-primary" id="buy-team-btn" disabled>Make All Selections</button>
            </div>
        </div>
        <!-- === FOOTBALL FANTASY GAME PAGE (REWORKED) (END) === -->

        <!-- === COLOR MATRIX GAME PAGE (START) === -->
        <div id="color-matrix-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Color Matrix
            </div>
            <div class="page-scroll-content" id="color-matrix-content">
                <div id="matrix-result-popup-container"></div>
                <div class="matrix-game-container">
                    <div class="matrix-header-info">
                        <div class="matrix-timer">
                            <p id="matrix-round-id">Round: #... </p>
                            <div id="matrix-timer-countdown-text">Next round in...</div>
                            <div id="matrix-timer-bar-container">
                                <div id="matrix-timer-bar"></div>
                            </div>
                        </div>
                        <button id="matrix-rules-btn" class="football-header-btn"><i class="fas fa-info-circle"></i> How to Play</button>
                    </div>
                    <div id="matrix-grid" class="matrix-grid"></div>
                    <div class="matrix-betting-controls">
                        <p class="game-betting-balance">Balance: <span id="matrix-bet-balance-display">0.00</span></p>
                        <div class="bet-color-options">
                            <button class="bet-color-btn" data-color="red"><span>Red</span><small>up to 2.75x</small></button>
                            <button class="bet-color-btn" data-color="green"><span>Green</span><small>up to 2.75x</small></button>
                            <button class="bet-color-btn" data-color="blue"><span>Blue</span><small>up to 2.75x</small></button>
                            <button class="bet-color-btn gold" data-color="gold"><span>Gold</span><small>20x JACKPOT</small></button>
                        </div>
                        <div class="bet-amount-area">
                            <input type="number" id="matrix-bet-amount" placeholder="Bet Amount" value="10">
                            <div class="quick-bet-buttons">
                                <button class="quick-bet-btn">10</button>
                                <button class="quick-bet-btn">50</button>
                                <button class="quick-bet-btn">100</button>
                                <button class="quick-bet-btn">500</button>
                            </div>
                        </div>
                        <button id="matrix-place-bet-btn" class="btn btn-primary" disabled>Select a Color</button>
                    </div>
                    <div class="matrix-history">
                        <h4>Recent Results</h4>
                        <div id="matrix-history-list"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- === COLOR MATRIX GAME PAGE (END) === -->

        <!-- === MINES TOWER GAME PAGE (START) === -->
        <div id="mines-tower-page" class="auth-page hidden">
             <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Mines Tower
            </div>
            <div class="page-scroll-content">
                <div class="tower-game-container">
                    <h1 class="jackpot-title">JACKPOT</h1>
                    <div id="tower-grid">
                        <!-- Tower levels will be injected by JS -->
                    </div>
                    <h2 class="tower-label">TOWER</h2>
                    <div class="tower-betting-controls">
                        <div class="tower-info-grid">
                            <div class="tower-info-box">
                                Balance
                                <strong id="tower-bet-balance-display">0.00</strong>
                            </div>
                             <div class="tower-info-box">
                                Tower ID
                                <strong id="tower-id-display">#...</strong>
                            </div>
                        </div>
                        <div class="tower-info-grid">
                            <div class="tower-info-box">
                                Next Payout
                                <strong class="next-payout" id="tower-next-payout">0.00x</strong>
                            </div>
                            <div class="tower-info-box">
                                Current Winnings
                                <strong id="tower-current-winnings">0.00</strong>
                            </div>
                        </div>
                        <div class="tower-bet-area">
                            <button class="mines-bet-adjust-btn" id="tower-bet-minus">-</button>
                            <div id="tower-bet-amount-display">30</div>
                            <button class="mines-bet-adjust-btn" id="tower-bet-plus">+</button>
                        </div>
                        <button id="tower-action-btn" class="btn btn-primary">PLAY</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- === MINES TOWER GAME PAGE (END) === -->
        
        <!-- === MINES GAME PAGE (START) === -->
        <div id="mines-game-page" class="auth-page hidden">
             <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Mines
            </div>
            <div class="page-scroll-content">
                <div id="mines-game-container" style="flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; gap: 10px; max-width: 400px; margin: 0 auto; width: 100%; text-align: center;">
                    
                    <!-- Info Bar -->
                    <div class="tower-info-grid" style="background-color: var(--mines-bg-dark); padding: 10px; border-radius: 12px;">
                        <div class="tower-info-box">
                           Mines ID
                           <strong id="mines-round-id">#...</strong>
                        </div>
                        <div class="tower-info-box">
                            Multiplier
                            <strong class="next-payout" id="mines-current-multiplier">1.00x</strong>
                        </div>
                        <div class="tower-info-box">
                            Next Payout
                            <strong class="next-payout" id="mines-next-payout">1.20x</strong>
                        </div>
                        <div class="tower-info-box">
                            Winnings
                            <strong id="mines-current-winnings">0.00</strong>
                        </div>
                    </div>

                    <!-- 5x5 Grid -->
                    <div id="mines-grid">
                        <!-- Tiles will be injected by JS -->
                    </div>

                    <!-- Controls -->
                    <div id="mines-controls-container" style="background-color: var(--mines-bg-dark); padding: 10px; border-radius: 12px; flex-shrink: 0; display: flex; flex-direction: column; gap: 10px;">
                        <!-- Status/Timer Display -->
                        <div id="mines-status-display" style="font-size: 1.2rem; font-weight: 700; color: var(--orange-color); min-height: 25px;">
                            Place your bet
                        </div>

                        <!-- Bet Area -->
                        <div class="mines-bet-area">
                            <button class="mines-bet-adjust-btn" id="mines-bet-minus">-</button>
                            <div id="mines-bet-amount-display">30</div>
                            <button class="mines-bet-adjust-btn" id="mines-bet-plus">+</button>
                        </div>
                        
                        <!-- Action Button -->
                        <button id="mines-action-btn">PLAY</button>

                        <!-- Balance Display -->
                        <p class="game-betting-balance" style="border: none; margin: 0; text-align: center;">Balance: <span id="mines-bet-balance-display">0.00</span></p>
                    </div>
                </div>
            </div>
        </div>
        <!-- === MINES GAME PAGE (END) === -->

        <!-- === PARTNER REWARDS PAGE (START) === -->
        <div id="partner-rewards-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Partner Rewards
            </div>
            <div class="partner-banner">
                <div class="partner-banner-content">
                    <h3>Invite friends to get max rewards</h3>
                    <div class="max-reward">2,000.00</div>
                </div>
            </div>
            <div class="partner-stats">
                <div class="stat-card"><div class="stat-title">Invitation count</div><div class="stat-value" id="partner-invitation-count">0</div></div>
                <div class="stat-card"><div class="stat-title">Effective Invitation</div><div class="stat-value" id="partner-effective-invitation-count">0</div></div>
                <div class="stat-card"><div class="stat-title">Invitation total bonus</div><div class="stat-value red" id="partner-total-bonus">0.00</div></div>
                 <div class="stat-card"><div class="stat-title">Total Commission</div><div class="stat-value red" id="partner-commission-bonus">0.00</div></div>
            </div>
            <div class="partner-content">
                <div class="partner-card">
                    <div class="partner-card-header"><i class="fas fa-link title-icon"></i><span>Invitation Link</span></div>
                    <div class="invitation-link-area">
                        <input type="text" id="invitation-link-input" value="Please log in" readonly>
                        <button class="copy-btn" id="invitation-link-copy-btn"><i class="far fa-copy"></i></button>
                    </div>
                </div>
                
                <div class="partner-card commission-status-card inactive" id="commission-status-card">
                    <div class="status-content">
                         <h4><i class="fas fa-hourglass-start"></i> Commission System Inactive</h4>
                        <p>Invite 5 effective players to activate the commission system and earn 0.2% on their bets!</p>
                        <div class="commission-progress-bar">
                            <div class="commission-progress-bar-inner" id="commission-progress-bar-inner"></div>
                        </div>
                        <p id="commission-progress-text">0/5 Effective Invitations</p>
                    </div>
                </div>

                <div class="partner-card hidden" id="commission-claim-card">
                     <div class="partner-card-header"><i class="fas fa-coins title-icon"></i><span>Claim Commission</span></div>
                     <p style="font-size:0.9rem; color: var(--gray-text);">You are earning 0.2% commission from all your referrals' bets.</p>
                     <div class="commission-claim-area">
                         <div class="commission-balance">
                             <div class="balance-title">Available to Claim</div>
                             <div class="balance-amount" id="claimable-commission-amount">0.00</div>
                         </div>
                         <a href="#" class="claim-btn disabled" id="commission-claim-btn">Claim</a>
                     </div>
                </div>

                <div class="partner-card">
                    <div class="partner-card-header"><i class="fas fa-book-open title-icon"></i><span>Invitation Rules</span></div>
                     <p style="font-size: 0.9rem; color: var(--gray-text); margin-bottom: 10px;">If you invites player A, and within <strong>7 Days</strong> they make their 1st deposit:</p>
                     <table class="rules-table">
                         <thead><tr><th>When Player A Deposits</th><th>You Get Bonus</th></tr></thead>
                         <tbody>
                             <tr><td>300  Amount < 1,000</td><td>5</td></tr>
                             <tr><td>1,000  Amount < 5,000</td><td>20</td></tr>
                             <tr><td>5,000  Amount < 10,000</td><td>30</td></tr>
                             <tr><td>10,000  Amount < 50,000</td><td>150</td></tr>
                         </tbody>
                     </table>
                </div>
            </div>
        </div>
        <!-- === PARTNER REWARDS PAGE (END) === -->
        
        <!-- === ACTIVITY PAGE (START) === -->
        <div id="activity-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Activity
            </div>
            <div class="activity-content">
                <div class="activity-small-cards">
                     <a href="#" class="activity-small-card" id="go-to-daily-tasks">
                        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSSkwX_4rE5xAKTiapTMYadBKlMv9i9Gz932mQ5--QYyjzp3NXlb65TzFo&s=10" alt="Activity Award Icon">
                        <span>Activity Award</span>
                        <i class="fas fa-chevron-right"></i>
                     </a>
                </div>
                <div id="dynamic-activity-cards-container" class="activity-content-cards">
                    <!-- Dynamic promo cards will be injected here -->
                </div>
            </div>
        </div>
        <!-- === ACTIVITY PAGE (END) === -->
        
        <!-- === WALLET PAGE (START) === -->
        <div id="wallet-page" class="auth-page hidden" style="padding-bottom: 0;">
             <div class="wallet-header-green">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                <h2>Wallet</h2>
                <div class="wallet-icon"><i class="fas fa-wallet"></i></div>
                <p class="total-balance-amount" id="wallet-total-balance">0.00</p>
                <p class="total-balance-label">Total balance</p>
            </div>
            <div class="wallet-content-area">
                <div class="wallet-main-card">
                    <div class="wallet-progress-container">
                        <div class="progress-circle-wrapper">
                            <div class="progress-circle" id="main-wallet-circle">
                                <div class="progress-circle-inner" id="main-wallet-percentage">0%</div>
                            </div>
                            <span class="wallet-label-amount" id="main-wallet-amount">0.00</span>
                            <span class="wallet-label-text">Main wallet</span>
                        </div>
                        <div class="progress-circle-wrapper">
                             <div class="progress-circle" id="third-party-wallet-circle">
                                <div class="progress-circle-inner" id="third-party-wallet-percentage">0%</div>
                            </div>
                            <span class="wallet-label-amount" id="third-party-wallet-amount">0.00</span>
                            <span class="wallet-label-text">3rd party wallet</span>
                        </div>
                    </div>
                    <button class="wallet-transfer-btn" id="commission-to-main-transfer-btn">Main wallet transfer</button>
                    <div class="wallet-actions-grid">
                        <a href="#" class="wallet-action-item" id="wallet-deposit-btn">
                            <div class="icon-bg" style="color: #ff9f43;"><i class="fas fa-plus-circle"></i></div>
                            <span>Deposit</span>
                        </a>
                        <a href="#" class="wallet-action-item" id="wallet-withdraw-btn">
                             <div class="icon-bg" style="color: #1e90ff;"><i class="fas fa-minus-circle"></i></div>
                            <span>Withdraw</span>
                        </a>
                         <a href="#" class="wallet-action-item" id="wallet-deposit-history-btn">
                             <div class="icon-bg" style="color: #ee5253;"><i class="fas fa-history"></i></div>
                            <span>Deposit history</span>
                        </a>
                         <a href="#" class="wallet-action-item" id="wallet-withdrawal-history-btn">
                             <div class="icon-bg" style="color: #f368e0;"><i class="fas fa-receipt"></i></div>
                            <span>Withdrawal history</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- === WALLET PAGE STYLES (END) === -->

        <!-- === ACCOUNT PAGE (START) === -->
        <div id="account-page" class="auth-page hidden">
            <div class="account-header-v2">
                <img id="account-avatar" class="account-avatar" src="" alt="Avatar">
                <div class="account-info-details">
                    <h3 id="account-username"></h3>
                    <span class="uid-badge">UID: <span id="account-uid"></span><i class="far fa-copy" id="uid-copy-icon"></i></span>
                    <p class="last-login-text">Last Login: <span id="last-login"></span></p>
                </div>
            </div>
            <div class="account-content-v2">
                <div class="balance-card">
                    <div class="balance-top">
                        <span>Account Balance</span>
                        <i class="fas fa-sync-alt refresh-icon"></i>
                    </div>
                    <p class="balance-amount" id="account-balance"></p>
                    <!-- NEW: Account Page Actions -->
                    <div class="account-actions-grid">
                        <button class="account-action-btn deposit" id="account-deposit-btn"><i class="fas fa-plus-circle"></i> Deposit</button>
                        <button class="account-action-btn withdraw" id="account-withdraw-btn"><i class="fas fa-minus-circle"></i> Withdraw</button>
                    </div>
                </div>
                <div class="history-grid">
                    <a href="#" id="game-history-btn" class="history-card"><i class="fas fa-gamepad history-icon"></i><div><h5>Game History</h5><p>My game history</p></div></a>
                    <a href="#" id="transaction-history-btn" class="history-card"><i class="fas fa-receipt history-icon"></i><div><h5>Transaction</h5><p>My transaction history</p></div></a>
                </div>
                <div class="logout-btn-container"><button class="btn" id="logout-btn" style="background-color: #fdeeee; color: var(--red-color);"><i class="fas fa-sign-out-alt"></i> Log Out</button></div>
            </div>
        </div>
        <!-- === ACCOUNT PAGE (END) === -->

        <!-- === DAILY TASKS / ACTIVITY AWARD PAGE (START) === -->
        <div id="daily-tasks-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="activity"><i class="fas fa-arrow-left"></i></div>
                Activity Award
            </div>
            <div class="page-scroll-content">
                <div class="tasks-banner">
                    <div class="tasks-banner-text">
                        <h3>Activity Award</h3>
                        <p>Complete weekly/daily tasks to receive rich rewards. Rewards must be claimed on the same day/week.</p>
                    </div>
                </div>
                <div id="tasks-list-container" class="tasks-list">
                    <!-- Missions will be injected here by JS to make them dynamic -->
                </div>
            </div>
        </div>
        <!-- === DAILY TASKS / ACTIVITY AWARD PAGE (END) === -->

        <!-- === DEPOSIT PAGE (START) === -->
        <div id="deposit-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="wallet"><i class="fas fa-arrow-left"></i></div>
                Deposit
            </div>
            <div class="page-scroll-content" style="padding: 15px;">
                <div class="deposit-card">
                    <h4 class="deposit-card-title">Deposit Amount</h4>
                    <div class="amount-input-area">
                        <span id="deposit-currency-symbol" class="currency-symbol"></span>
                        <input type="number" id="deposit-amount-input" placeholder="400 - 50000">
                    </div>
                    <div class="quick-amount-buttons">
                        <button class="quick-amount-btn" data-amount="500">500</button>
                        <button class="quick-amount-btn" data-amount="1000">1000</button>
                        <button class="quick-amount-btn" data-amount="5000">5000</button>
                        <button class="quick-amount-btn" data-amount="10000">10000</button>
                    </div>
                </div>

                <div class="deposit-card">
                    <h4 class="deposit-card-title">Select Payment Channel</h4>
                    <div class="payment-channels-grid" id="payment-channels-grid">
                        <div class="payment-channel-card selected" data-channel="Nagad">
                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAABLFBMVEX////rHCTyZCL2kx7qAADrAA/1n6DrGSHyjI7rAxP5wsXrFh///v/95ufvP0TwZSL4x8j97e7rDhr2jADvXWH+9fXuOj/4sLLwWwDrAAf86envSU/wZ2zrChf84eL2iQD72NnuLjX2pqjxYBftJi73q1j/+/X5vb/zgIP97OXxXQv2m57wVFj0k5X73N30iYz6z9DtLiP2nnz0i2H98uf838P4vKX6y6D0f076zbzwWmD3oETzdD3yd3r96df3qYz5wYv72sz0jmr0fCHwWiL3mC/1gTH5un7zhVn4smz84cb72LTwbS794dX2r5P4pIL4pVL6yJf4wq/5tqryaF70lm7zgWr0dFPxYkf1jVnzbx7ycAD1iCXwRCP1hx/vTCPvQhDxWDj1hzX2nWJlUjL3AAAUB0lEQVR4nO2dCXvaSJrHS1BCliUMCAuQQdxBmMPQduLYjmnHPcnEadvpxDvZme2edGZnv/932CoJHXUIRIwRnkf/Tp52MIj66a2q91CpBECiRIkSJUqUKFGiRIkSJUqUKFGiRP9ZUiO9yn/XM1Cv14u7CU+q3od0I/2a/zv98Pr06vj45Obm5Opws81an27TxXQ63WARe+dXZ3eDyqDjaDB4pogfMR8W2VH1h7NKpdNJBdQ5i6mJj9LL9y5g8W3g5fMThJfLpUgNnuFo/TXtAiLEl+6rp5cYjwFMdV4uOtZW6tbnQ4QfnRfP7yo0mmvDZzcQXzfSQTV+Rq/dX1ZSuRRjvudJ+LpIAKaLL1AHtYcfHzA1uI+7yavplgJEiK/AYbgFU6nKddxtXkm/MoDp9BsAjjthfKnc8yBU539fcgDTjVtw2AkDRDY8j7v10VSYZFG88oYDiATAp8FzJxzCDDLiR54J0Uh8DXqol4Z01GdBaAmwCnizjIvYQ9Mp6+sdDU7jbv5SFWpQgfWQQegQvgXgLtRbbD2h1ZUFcQJAWB/FhI2X4LwSQti5QhG5rseNEa4+VARJKCzqo8UPOK4548+nuc5voCl3u61Rv9ycH3Obkn59ZAiCIA7RPPo+hC/91k4erm9C5lJEWICKpCimAWHN2jJjZksmApQEnY3WXPs5fOdnnLxpbsOviFASbEkalGu7WwSZFTTcLBmNwh7fgC9w/7T5QiyIbPgVAJfQgSwNHcb4O2tW0uxGwYMQExbtIsY95guN2lKdE0Qo+IiCoIhafwvsqIJC1wE0L9A/eXxvcG7bO+Ynvj7hGQBKEBAbUhSH8TPqVQdQgLvcidTJfc9zg/DEySG8AaBLEqJ/SUbLipuwJroDB42Xzwxg4wt6T++rl9ljTtuSnc6gQugSgJIiMFJQIBirhnDeEnMGwM9sVniL3nOPDOgRov8GlUHu7ub49OH8+v7+8OX9/f31+cMp8vgjDqEgwWacgE3D7Vi4k36hCVHaC8CDPQLdzljpnB0/3PPLThcah1CQ+5tlIqTuuWddklA8Q2dNNuDVPE5DkJ3K4OtDsB6j14+azWl+2mw26wUV9E0eoVaLCw9paLjzu3bBxtwN3EW/VpwJBnfOX869ouiRNaztdQVNFkUIDdGQNaFbakk8Qtz/49KB76LlMeMM8Rjs3QwcH9Gp3H2aT/z6dHiBqUxFkSTJ6QDoDwrYBC4hjHE2rXm9SjLydFaBcyX1ZA5YuXxwzKfvzrpQ1Bww79Pe/ziI2ig+wP8S/TZqWQBIE75A77ixvSCaSh+cTzT7XWhyDRUqCYdKMek8MLlLXTQMyRowstlxBfN1KleO/Xb3oCzxe2K44DA2QP2XQAiCu9IrooyPYu1PFdxFB2dOrdcqQbtzrkaoVWMDBFd/872XZPbJiQYH29cV7CEqV/a7p1WUIjMjb6kksRkb4OFlVfLbKbbRRBMw4WeA62o5t4SmzwwNY+FPoElT0zRZlkVZ1jQ62KZk7MQGCL7+txZonGERQSm+mHaCcqXOpe3fd2XZniclxRSh1i1Va7Mx1qR2sdfVIPIbIYBKKT7Aw8Hfgs2CyFn49YviFxyrpXKDGzzFqH3sNiVFhmZ1lpkekfmQWp+2ayUociHhNB46rKu7kkQ1xSd8j/rlHQI8we/MVkVJ0gxY3ckXyHTd/5d+lKlCkcmdxBgj0t7d34koGWYDBQwczFwNbEAVNE1TM4xamVeR6L158fH1q3kUnh1LkByVSjfG9Peh8g+iMcgt+4SfcSfO4ZQWDUEIlX2/ckbVXK4bxWKxkf7wynGY5aoRcLGSsbtBIlonnb0goRQkxBnF8aBziVtdhtX2opjkkx0lFIvv3zqWLJcMP9SNMeIGh5W7VqgN36DuV3GuWrcv8kuO9D9zJ1pMf7AZ1THUHG8pmXGWaB4qd9SkV/AIG6/wVTT7gqd65H5Ar9X40+Lh757p8QwM8MxkOIeMtUBz03lHhiWw7hGiiRTcVT45b3TH3RCacJ9jExWc/uHPUG+crjrGo9GMM+8FoJJ6xzqu94F47SbwZkS5iydJuZThVXcv/wxECrf2SxYKdZTsZlD4uq7kvlM23HVrGMUeLlwESxUqyNqZstHizjnXlWDA/tZ+rS7BdqzF7tMBIiSEozY7AbbLo3enZOsmyOcLRnnGb/LJ70HED/Zrei3eav5JhybEkffb4txVHF5S7++LQkvcK6jDSX82m5Wp315X/skixqzLFE2Isye74P0eddJz5pJ8YRdOdpvlPgqyTRMeUb89S6Wpjhr3xZhDlNdS4xBnwHgRjd1JqZUxdnPz1X4zP7VGCvJz9Cx5Wvl3ELFxuxmMBbofpHLkXCopXeTmG3Yn5Z1/1WpZ9SMFtlp2FlUgf3vYuUsTVvx5IxgLhKbSHOUPBVyJeh9cZelLBUNzt1CyauLYuZJKlelVcNYhjJh+E/da01NkwxRFaCCH+KFou3tGut6uZaBVg1mnRs5EK58GlBHfPj3EQn3CRVByprGv4d8WuROhBVvN1kEtO1Om7SMocPLa60rqnyRizP30GF9p+YkkxBcXXhaL5CThDMnJzOyP4ThfODqAKq5laHS4ggL1vxKEOAGLU8edVC73jSSUWijq/Nzgnvv60S7IdyEUp3Ba0yTIZu6o25OEjV+fnGKRfunY7oIUnj7eNhZMEW0J5mF7AjmAeJEN1U1fPFnro8gmTFGE8g6+Quq9R9V1kLHL1Xp+Wi6XrYOMutvs5g+mOvqVJ++Iqb+QRox3JCLCFDPVKLg4PT/zer5fEmFmv3RkWdPycGcnk8mAHeEI/WJf1UdQdAXnR/zaSd1RhLEGb1/xUl96IOIUETijR9/B1wRhde9ip2a2CuP92axWbbWH+o5wkZ9OrJ2aq33viKkUSWiHf7Hp2LYhlSHa/sJT1mqX1fYETMsH5eywbr+mZ4dTq2qIcMwcEfeKP0nCWOea3+yVWznq6oMkoNFHhGzWFAzxCwU7m5gaEM2nmsa7LI+X89ED8e0mUEJke3zaX0h23ZvQ3gUY6s3mkW4TzrrQMC66e7sX7BHxYqnfSUJc0IpND/ZVM6abmvvU+8q7oK1PJkPQxr7fmurlid7c5SwB6lU4hMUYB+K1TZjK/URdN5LrzFszTWi0VFyR2IOwO7aq8KLJPyDt89PFGAfi/cBeHsM4fc4Im85GI5QZArAvIyNDOMu3S2x6hbo9mrpowhjTRH2+Qo2OTSWFKTU1rXamPLYLhCIclQ+sEhPSqDjJx0vBaMIvG8Lh6dK+94UdiWwdvt3U4CTfbEK5lcF9uKtxLpgddlK8XvpxEygh+tqZr3KijCgwJZhMvdme1q1Za+wEaBlYUqeZcpMoDuP7TFjCdJyh6en81hfGiLhcQ/jEsmU1+3p5v2s4xRkd9i0oGlAZzfpIbfxa78452DYR3lfmC7mQTyS9PqRKhW0whshnVDX3evW41TJRTAdbo9q+AW3sh8r2EYKKt1iUMqJCVZkyw9F0b2daVbS5n1dLpVrGcjpz2ylnOOsWmZkmXsIbd0X6Urc/anVbE1DVxDGnCLeHCa/mi09pjx8voTsQ2VxfIJf0HowuLkY1sM+bQgHYads93iH8Cz2Xxpo/HQZWNf9ERuASweJku2BmQvYgKigf2UF3CGHITgwbkn9vD+MyFKbQBMAEhl0NPB64C9z/pAnjLX2fDrx1zbkUFZ5qJSa0GYctRz/1b/SihyG/qrUxHQZuDmEmVLNKX+3NhBA++IDMVFrkfmJzOun4NmQRWxRimU/4ENh+gB6G8U6lSNR9hFQipXXJ8I1P6AHiHs8Mw3gnGoBvBg0ol6KCG0UJ5rkZSeTMNJ98CyJEppPGvk/GaXCDC7ZCHKhst7vQLDGLtXsngVuC2Qw/7ro+1iCVC8ynKJWyvUZgyWl3vmhLt6gCDg5urnPBG9eZStsWdFIVGzFHNJI2owJHTd4H0d/834ktTjipUzr2Tuqsrwwg2qUbKoTTjAvO7a714T+oO0lzWxayuXqoUDZkGSXNEGZWIN1Q8+O9fwX79/zDjLvfAhMCHLqxNxSiKWcexdlLuvECPAjN0Ww4zIwnFwKE/6I/hGkZE76Nm83RPWe/ILuQ+t0PVec3/OCF66L807d37G2kOY6riPWihS8V/MZu5JFzlPr+bZ5zuJPrT9++23iM2XkmfBU3m6c79t5zm2GO+e779+/fvv3v93fvHFPZeGwnZapsWzHNOMIraxbd3OvMPgvfwfGFW9JHHX0K2+ZiBTEXLGJfMEToZMG2QRFFXziMf9EXKc5QXEFsUrEtjsLXYW7JUFxCSM2jsdbyQ3T/iH7K5BQxrzIJ0XXYRoFL8ZiIu7gFORNP54PQ/a1WBNzCLurouvMjPRUBkrNMY4s8PSEV7wuxOiIDGH/Su0j65bLohsFjUqbtCUb5Ol5tvqFn0eLn7cgIF+l8pcGYI/1grBftI+vwLLoZySFYfL9doWi4HnJsgYLtnjnKgMWw/b63TbiI1rvqDBa7RpwkEiPQ2egs7ltIVtDhVSV8B09nAP5J8H3Y/hmGVu9TDm9b5mT5dqed/8F8d/9+T/B92aZkdwWdn+ScvdmcQTkfmrm7vxK3cBU/b1smuIoOb//vjz9875HL/U7RFV+8xt3zGY0/Vr3bD+lGo/EnEjmzFBvvP9w+v9HHV+/V649vHCws9NPnD69/faZjb4F6L3929NJle9adM6D/FI5EiRIlSpToh/UMnGE7E11l9m4ZAArWkk9ZBc6n6uWdfuTvbT8GUG0ZYmQZcI/e7aJeg3Dpp/bplcNWFRqyGflrW4/pKSpv2+JwKXBEWCQjcveTJSVpBnEvol6DmiBE33NQ4dxh9GSEgmAG9x7rw2itlOAkANiSV/vKDRMKpr9NZRlG28VTIjZYqEYwe6yEAnQHfkGL2s/Qiei6rczA5e8ntXFCpTTvp2MxKiHen3c+R+mtH/jCDRMK801L/D2wo8jdJzi/sgljIBSdtc7ZFUw43wkcabziNCOsgVCKKO8bZWc/1SZjDcnezNqVRJ6AueUD25VH/eJHEq7U1QjCXZ9QEg0TQrzBbrfqqStDGDDYfCDWVp1JkQ33NhQbeueCIZRkflylNsfeRp6S6LxnR/bavZlmRz476gJCeRLyEQCGnhU5hCt8+UYUTrhgJ+cjkeql0WwYT8oSSrho88OsN99AZ01/xF4aC+JCG4a1KKv8GOETSD1qT2azSWYaumHqD/XSH7GhPs30Z7N+u7lWQ2ZKhiibpinC7sy+M0RlDv/khM5X5vFTFVBLZNEore/ZM9mW4TpoSTLhHncj2Y3YMF+CptcSxWjxqgo/oCMtmCVIKM/lbdyxgDC8HasRNi8g8XwPSdPozQ1+SHqJebQNvik7OqEyqu3bmo3z1DBeiXAssg0prWMj5bFBHxdnO1X6JthwQgE/JAALDWNhQjRpBcKDqsEJ5Q32VK8snV+K0Oh9DxcQBs6MJBKfi05oQe5DkgT4eCOWeacON5bayyoSIU7ng88biUw4Din5eKnzI1TzpxlqU3+jFnQZ0QjtU9P2IoCIhGqNOs2BR9s8fj9s/ykrmkgOdUmsBmqHkQmD27tEIyxUyWw62BD8bJvHKesdS9uv50fkrGN2fUewAqHmtT4S4VGXTBqNUb6+7zfrsVt+N93TJ9lnfkhWCDVh6va4FQgF73kHUQinAtlz7HF85D3L89HPoJl6VtPsLmlBIuvXTHdqXIXQGzwRCC2TAFScubjgvWg89gkmfvFr/lCpZovoM952OyyhRinwfFF3A5vlhGVyEjVbzhj2i7HMFniPJgQFcjC6XoMmnI72SV0ovjHcZi0lpLyEMcLuTw3a8AkImesRRp9HyCpb9ZrlbiC5jLAfPJlS4Pb+J7UhwKV3YjAaF2oUQnDkVWXc0s1iQvWCAFSgX9F6akKQl4jhL6M0JgKh/x6zH4GwTnoJTQrMKU9OCLIlojityFY1AqH7HkleTli1yEdciXtBx7dGwrb7lFiSEF/HJLZNEj03OSdkqwBA955xuJxQEog4RoI1IsR+AkL2EYQ7QcTAj+E2nHjNl8fLCMljSnCHLLA9iQ1NeklBOdiNmOsWAG/+HFQ7MG+4KdQiwgCgYtIZxJPYUGMWTTS7vKsM3pUZg1QwbBezywl9mV2mHvkkhPTTwbDfrXLyfy+mCb+65j2xMRKhUWUXpDwJIb3tk60ZyxEl8nYdWwRCCeLdQul5a52ErpUwIacGmzHo62/LCf2HxS0nVAxuVXSt/nB+KAUTchDzdAUsQgbszRtLCTWRD7A2QhXk3foBv5fiVrZkor6xhBA5On/fyMWEEgqWQvLbNdqw6Xv8sMKuvm+sQCiII/9ULSE0eM8wWzdhVvMeuh36dY7zp2Iah5CISwQ7P5gFDrPY48Pw+G+NhIFKlNmala28rV2L3PqpHHjw5JzQgsH1C/bPkmJCgSizLiBEqcSCQuE6CfeDD/w15m4cQqrPTn3nPycstBRJM13ZyzCk1gxzBKarBYQacvObIWxznDo2KDUqC17R3YtLdf2g7krX9UKB7eWhhGSl8mkJD/i1a5oQqDNIEUZQKCEMeQCdq3USBrvpIkKn0rgeQmnpk8bXSsgubgohBHlZWQuhIi9t9VoJwYRzbYZHq/URdPJpS4LpqsOn16yVW99nJhk9oO/+QBUIcMYT0XHxmyeEIBOgyn81tJd_GqXwlA5x7CoFjNROyGkh7IVXEEqcB3U4qi-c5SkxBKCQbXFBwVwzIVDz_VEXb4XvaS3LIOr-8VZ78G_B_8A1fao2dtq-1rNfR_3h4625Ic_h7p4UaJEiRIlSpQoUaJEiRIlSpQoUaJYiPX_nd8L5rNttmAAAAAElFTkSuQmCC" alt="Nagad">
                            <span>Nagad</span>
                        </div>
                    </div>
                </div>

                <div class="deposit-submit-btn-container">
                    <button class="btn" id="deposit-submit-btn">Deposit Now</button>
                </div>
            </div>
        </div>
        <!-- === DEPOSIT PAGE (END) === -->
        
        <!-- === PAYMENT PAGE (NEW) (START) === -->
        <div id="payment-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="deposit"><i class="fas fa-arrow-left"></i></div>
                Payment
            </div>
            <div class="page-scroll-content" style="padding: 15px;">
                <div class="deposit-card" style="text-align: center;">
                    <div id="payment-page-timer-display" style="font-size: 2.5rem; font-weight: 700; color: var(--red-color); margin-bottom: 20px;">05:00</div>
                    <div class="info-line-payment">
                        <span class="info-label">Invoice ID:</span>
                        <span id="payment-page-invoice-id" class="info-value">...</span>
                    </div>
                    <div class="info-line-payment">
                        <span class="info-label">Amount:</span>
                        <span id="payment-page-amount" class="info-value">...</span>
                    </div>
                    <div class="info-line-payment">
                        <span class="info-label" id="payment-page-number-label">Recipient Number:</span>
                        <div class="info-value">
                            <span id="payment-page-number">...</span>
                            <button class="copy-btn-page"><i class="far fa-copy"></i></button>
                        </div>
                    </div>
                </div>
                <div class="deposit-card">
                     <h4 class="deposit-card-title">Submit Transaction</h4>
                     <div class="input-wrapper">
                        <input type="text" id="payment-page-trxid-input" placeholder="Enter Transaction ID">
                     </div>
                </div>
                <div class="deposit-submit-btn-container">
                    <button class="btn btn-primary" id="payment-page-submit-btn">Submit</button>
                </div>
            </div>
        </div>
        <!-- === PAYMENT PAGE (NEW) (END) === -->

        <!-- === TRANSACTION HISTORY PAGE (START) === -->
        <div id="transaction-history-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="account"><i class="fas fa-arrow-left"></i></div>
                Transaction History
            </div>
            <div id="transaction-history-list" class="page-scroll-content" style="padding: 15px;">
                <!-- History items will be injected here -->
            </div>
        </div>
        <!-- === TRANSACTION HISTORY PAGE (END) === -->
        
        <!-- === GAME HISTORY PAGE (START) === -->
        <div id="game-history-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="account"><i class="fas fa-arrow-left"></i></div>
                Game History
            </div>
            <div id="game-history-list" class="page-scroll-content" style="padding: 15px;">
                <!-- Game History items will be injected here -->
            </div>
        </div>
        <!-- === GAME HISTORY PAGE (END) === -->

        <!-- === ANNOUNCEMENT DETAIL PAGE (START) === -->
        <div id="announcement-detail-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Announcement
            </div>
            <div class="page-scroll-content" style="padding: 15px;">
                <div class="announcement-full-content">
                    <div class="announcement-detail-card">
                        <div class="announcement-detail-header">
                            <i class="fas fa-bullhorn announcement-icon"></i>
                            <h3>Welcome to 1x Mall Bet! Wish all of customershave good experience playing game</h3>
                        </div>
                        <p class="announcement-detail-date">2024-03-05 13:13:52</p>
                        <div class="announcement-detail-body">
                            <p>Welcome to 1x Mall Bet! Wish all of customershave good experience playing game</p>
                        </div>
                    </div>
                    <p style="text-align: center; color: var(--gray-text); margin-top: 20px;">No more</p>
                </div>
            </div>
        </div>
        <!-- === ANNOUNCEMENT DETAIL PAGE (END) === -->
        
        <!-- ======================================================= -->
        <!-- START: WINGO MALL GAME PAGE (NEWLY INTEGRATED)        -->
        <!-- ======================================================= -->
        <div id="wingo-game-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="dashboard"><i class="fas fa-arrow-left"></i></div>
                Wingo Mall
                 <div class="icons" style="position: absolute; right: 15px; top: 50%; transform: translateY(-50%); display: flex; gap: 20px; color: white;">
                    <i class="fas fa-headphones" style="cursor: pointer;"></i>
                    <i id="wingo-refresh-page-btn" class="fas fa-redo" style="cursor: pointer;"></i>
                </div>
            </div>
            <div id="wingo-app-container" class="page-scroll-content">
                <div class="wallet-section"> 
                    <div class="balance-info"> <div> <div class="balance-refresh-wrapper"><p class="balance-amount" id="balance">0.00</p><i id="refresh-balance-btn" class="fas fa-sync-alt"></i></div> <p class="balance-label"><i class="fas fa-wallet"></i> Wallet balance</p> </div> </div> 
                    <div class="wallet-actions"> <button class="wallet-btn withdraw-btn">Withdraw</button> <button class="wallet-btn deposit-btn">Deposit</button> </div> 
                </div>

                <div class="main-content">
                    <div class="game-modes">
                        <div class="mode-btn active" onclick="switchGameMode(30, '30Sec', this)"><i class="far fa-clock mode-icon"></i><div class="mode-text">WinGo 30Sec</div></div>
                        <div class="mode-btn" onclick="switchGameMode(60, '1Min', this)"><i class="far fa-clock mode-icon"></i><div class="mode-text">WinGo 1Min</div></div>
                        <div class="mode-btn" onclick="switchGameMode(180, '3Min', this)"><i class="far fa-clock mode-icon"></i><div class="mode-text">WinGo 3Min</div></div>
                        <div class="mode-btn" onclick="switchGameMode(300, '5Min', this)"><i class="far fa-clock mode-icon"></i><div class="mode-text">WinGo 5Min</div></div>
                    </div>
                    <div class="game-container">
                        <div class="game-info"> <div class="how-to-play" onclick="openHowToPlayModal()"><i class="fas fa-list-alt" style="margin-right: 5px;"></i>How to play</div><div class="game-title" id="game-mode-title"></div> <div class="recent-results" id="recent-results-display"></div> </div>
                        <div class="timer-section"> <div class="timer-label">Time remaining</div> <div class="timer" id="time-remaining"></div> <div id="current-game-id"></div> </div>
                    </div>
                    
                    <div class="betting-area">
                        <div id="bet-lockdown-overlay"><div id="bet-lockdown-timer"><div class="digit-card" id="lockdown-digit-1">0</div><div class="digit-card" id="lockdown-digit-2">3</div></div></div>
                        <div class="color-options"> <button class="color-btn green" onclick="openBetModal('color', 'Green')">Green</button> <button class="color-btn violet" onclick="openBetModal('color', 'Violet')">Violet</button> <button class="color-btn red" onclick="openBetModal('color', 'Red')">Red</button> </div>
                        <div class="numbers-grid">
                            <div class="number-btn-wrapper"><button class="number-btn num-0" onclick="openBetModal('number', 0)">0</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-1" onclick="openBetModal('number', 1)">1</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-2" onclick="openBetModal('number', 2)">2</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-3" onclick="openBetModal('number', 3)">3</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-4" onclick="openBetModal('number', 4)">4</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-5" onclick="openBetModal('number', 5)">5</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-6" onclick="openBetModal('number', 6)">6</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-7" onclick="openBetModal('number', 7)">7</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-8" onclick="openBetModal('number', 8)">8</button></div>
                            <div class="number-btn-wrapper"><button class="number-btn num-9" onclick="openBetModal('number', 9)">9</button></div>
                        </div>
                        <div class="big-small"> <button class="big-btn" onclick="openBetModal('size', 'Big')">Big</button> <button class="small-btn" onclick="openBetModal('size', 'Small')">Small</button> </div>
                    </div>
                    <div class="history-tabs"> <div class="history-tab active" onclick="showTab('game-history', this)">Game history</div> <div class="history-tab" onclick="showTab('chart', this)">Chart</div> <div class="history-tab" onclick="showTab('my-history', this)">My history</div> </div>
                    <div class="history-content"> 
                        <div id="game-history-content"></div> 
                        <div id="my-history-content" style="display: none;">
                            <div class="my-history-summary">
                                <div class="rank-display">
                                    <i class="fas fa-trophy"></i>
                                    <div class="rank-text">
                                        <span>Your Rank</span>
                                        <strong>Top 5%</strong>
                                    </div>
                                </div>
                                <div class="income-stats">
                                    <div class="income-stat-box">
                                        <p class="stat-label">Last 3 Days</p>
                                        <p class="stat-amount" id="income-3d">0.00</p>
                                    </div>
                                    <div class="income-stat-box">
                                        <p class="stat-label">Last 7 Days</p>
                                        <p class="stat-amount" id="income-7d">0.00</p>
                                    </div>
                                    <div class="income-stat-box">
                                        <p class="stat-label">Last 30 Days</p>
                                        <p class="stat-amount" id="income-30d">0.00</p>
                                    </div>
                                </div>
                            </div>
                            <div class="my-history-list"></div>
                        </div>
                        <div id="chart-content" style="display: none;">
                             <div id="chart-list-container">
                                <svg id="chart-svg-overlay"></svg>
                                <div id="chart-list"></div>
                            </div>
                            <div id="chart-pagination-container"></div>
                        </div> 
                    </div>
                </div>
                
                 <div class="modal-overlay" id="bet-modal">
                    <div class="modal-content bottom-sheet">
                        <div class="modal-colored-header"><div id="bet-modal-game-mode" class="modal-title"></div><div id="modal-selection-display"></div></div>
                        <div class="modal-body">
                            <p class="balance-label">Balance: <span id="modal-balance"></span></p>
                            <div class="preset-amounts"> 
                                <button class="preset-btn" data-amount="10">10</button> 
                                <button class="preset-btn" data-amount="100">100</button> 
                                <button class="preset-btn" data-amount="1000">1000</button> 
                                <button class="preset-btn" data-amount="10000">10000</button> 
                            </div>
                            <div class="amount-control">
                                <label>Amount</label>
                                <div class="quantity-selector"> 
                                    <button class="quantity-btn" id="decrease-qty">-</button> 
                                    <input type="number" class="quantity-input" id="bet-amount-input" value="10"> 
                                    <button class="quantity-btn" id="increase-qty">+</button> 
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer"> 
                            <button class="modal-footer-btn" id="cancel-bet" onclick="closeBetModal()">Cancel</button> 
                            <button class="modal-footer-btn" id="confirm-bet">Confirm</button> 
                        </div>
                    </div>
                </div>

                <div class="modal-overlay" id="how-to-play-modal">
                    <div class="modal-content">
                        <div class="rules-header" id="rules-modal-title">WinGo Rules</div>
                        <div class="rules-body" id="rules-modal-content"></div>
                        <div class="rules-footer">
                            <button class="close-rules-btn" onclick="closeHowToPlayModal()">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ======================================================= -->
        <!-- END: WINGO MALL GAME PAGE                             -->
        <!-- ======================================================= -->
        <!-- START: WITHDRAWAL PAGE (NEWLY INTEGRATED)             -->
        <!-- ======================================================= -->
        <div id="withdraw-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="wallet"><i class="fas fa-arrow-left"></i></div>
                Withdraw
                <a href="#" class="history-link" style="position: absolute; right: 15px; color: white; text-decoration: none; font-size: 0.9rem;">History</a>
            </div>
            <div class="page-scroll-content">
                <div class="balance-card">
                    <p class="balance-label">Available balance</p>
                    <div class="balance-amount-wrapper">
                        <p class="balance-amount" id="withdraw-balance-display">0.00</p>
                    </div>
                </div>
                <div class="withdraw-content-wrapper">
                    <div class="method-tabs">
                        <div class="method-tab active" onclick="switchWithdrawMethod('Bkash')"><i class="fas fa-wallet"></i> Bkash</div>
                        <div class="method-tab" onclick="switchWithdrawMethod('Nagad')"><i class="fas fa-wallet"></i> Nagad</div>
                    </div>
                    <div class="account-selection" onclick="openAddAccountModal()">
                        <div id="selected-account-display"> <!-- Populated by JS --> </div>
                    </div>
                    <div class="withdraw-form">
                        <div class="amount-input-wrapper">
                            <span class="unit" id="withdraw-currency-unit"></span>
                            <input type="number" id="withdraw-amount-input" placeholder="Enter amount" oninput="updateWithdrawCalculation()">
                          </div>
                        <div class="info-row">
                            <span class="label">Withdrawable balance <button id="all-btn">All</button></span>
                            <span class="value" id="withdrawable-balance"></span>
                        </div>
                         <div class="info-row">
                            <span class="label">Fee (<span id="fee-rate-display">3%</span>)</span>
                            <span class="value" id="fee-amount"></span>
                        </div>
                        <div class="info-row">
                            <span class="label">Amount received</span>
                            <span class="value" id="received-amount"></span>
                        </div>
                        <button class="main-withdraw-btn" onclick="handleWithdrawRequest()">Withdraw</button>
                    </div>
                    <div class="rules-section">
                        <div id="withdraw-rules-container"></div>
                    </div>
                </div>
                 <div class="modal-overlay hidden" id="add-account-modal" style="align-items: center;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <span id="account-modal-title">Add Account</span>
                            <i class="fas fa-times close-btn" onclick="closeAddAccountModal()"></i>
                        </div>
                        <div class="modal-body">
                            <p id="account-modal-prompt">Please enter your account details:</p>
                            <input type="text" id="account-modal-input" placeholder="Account Number / Address">
                        </div>
                        <div class="modal-footer">
                            <button id="save-account-btn" onclick="saveAccountDetails()">Save</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="withdraw-history-page" class="auth-page hidden">
            <div class="sticky-header">
                <div class="back-btn" data-target="withdraw"><i class="fas fa-arrow-left"></i></div>
                Withdrawal History
            </div>
            <div id="withdraw-history-list" class="history-list-container page-scroll-content">
                <div class="no-history-found" style="text-align: center; padding: 50px; color: var(--gray-text);">
                    <i class="fas fa-file-invoice-dollar" style="font-size: 3rem; margin-bottom: 15px;"></i>
                    <p>No withdrawal records found.</p>
                </div>
            </div>
        </div>
        <!-- ======================================================= -->
        <!-- END: WITHDRAWAL PAGE                                  -->
        <!-- ======================================================= -->
    </div>
    
        <!-- === CHAT PAGE (START) === -->
        <div id="chat-page" class="hidden">
            <div class="sticky-header">
                <div class="back-btn" id="chat-page-back-btn"><i class="fas fa-arrow-left"></i></div>
                Customer Support
                <div class="admin-status">Online</div>
            </div>
            <div id="chat-messages"></div>
            <form id="chat-form" class="chat-input-area">
                <label for="chat-image-input" class="chat-file-btn"><i class="fas fa-paperclip"></i></label>
                <input type="file" id="chat-image-input" accept="image/*" class="hidden">
                <input type="text" id="chat-message-input" placeholder="Type a message...">
                <button type="submit" id="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
            </form>
        </div>
        <!-- === CHAT PAGE (END) === -->

    </div>
    <!-- === GLOBAL CHAT ICON & BOTTOM NAV (START) === -->
    <a href="#" id="global-chat-btn" class="global-chat-icon hidden">
        <i class="fab fa-rocketchat"></i>
    </a>
    
    <nav class="bottom-nav hidden" id="bottom-navigation">
        <a href="#" class="nav-item active" data-page="dashboard"><i class="nav-icon fas fa-home"></i><span>Home</span></a>
        <a href="#" class="nav-item" data-page="activity"><i class="nav-icon far fa-calendar-check"></i><span>Activity</span></a>
        <a href="#" class="nav-item nav-item-center" data-page="partner-rewards"><div class="nav-icon-bg"><i class="nav-icon fas fa-gem"></i></div><span>Promotion</span></a>
        <a href="#" class="nav-item" data-page="wallet"><i class="nav-icon fas fa-wallet"></i><span>Wallet</span></a>
        <a href="#" class="nav-item" data-page="account"><i class="nav-icon far fa-user-circle"></i><span>Account</span></a>
    </nav>
    <!-- === GLOBAL CHAT ICON & BOTTOM NAV (END) === -->

// === JAVASCRIPT LOGIC (START) ===
    <script>
        // --- DEVELOPER'S NOTE: FOOTBALL GAME REWRITE V2 ---
        // The Football game logic is overhauled again based on new 1x2 and premium history requirements.
        // - Betting System: Changed from picking 1 team to a 1x2 system (Team 1 Win, Draw, Team 2 Win).
        // - UI: Match cards are redesigned. Betting controls are moved to the bottom.
        // - History: The history view is now highly detailed, showing each match's pick and result within a bet.
        // - State Management: Selection data is now an object mapping match IDs to outcomes (e.g., { match_0: 'teamA', match_1: 'draw' }).
        // - All related JS functions (initialize, updateUI, handleSelection, handleBuy, history display) are rewritten.
        // ------------------------------------------------

        // --- GLOBAL CONFIG & INITIALIZATION (START) ===
        const firebaseConfig = { apiKey: "AIzaSyAQ1ePbaT_V7erqRWqi_GZiX9GQ0PpW_rk", authDomain: "ng-mod-mini-server.firebaseapp.com", databaseURL: "https://ng-mod-mini-server-default-rtdb.firebaseio.com", projectId: "ng-mod-mini-server" };
        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.database();
        const currentAppVersion = "4.0"; // Current version of this app
        const avatarUrls = ['https://basantclub.net/assets/png/16-cf8e1441.png', 'https://basantclub.net/assets/png/11-925c456e.png', 'https://basantclub.net/assets/png/10-29a6603e.png', 'https://basantclub.net/assets/png/7-00479cfa.png', 'https://basantclub.net/assets/png/8-ea087ede.png', 'https://basantclub.net/assets/png/5-ab77b716.png', 'https://basantclub.net/assets/png/1-a6662edb.png'];
       
        let activeSliderData = [];
        
        const pages = { 
            login: document.getElementById('login-page'), 
            register: document.getElementById('register-page'), 
            dashboard: document.getElementById('dashboard-page'), 
            account: document.getElementById('account-page'), 
            wallet: document.getElementById('wallet-page'),
            'partner-rewards': document.getElementById('partner-rewards-page'), 
            activity: document.getElementById('activity-page'), 
            dailyTasks: document.getElementById('daily-tasks-page'), 
            deposit: document.getElementById('deposit-page'), 
            payment: document.getElementById('payment-page'),
            transactionHistory: document.getElementById('transaction-history-page'),
            gameHistory: document.getElementById('game-history-page'),
            announcementDetail: document.getElementById('announcement-detail-page'), 
            gameList: document.getElementById('game-list-page'),
            footballGame: document.getElementById('football-game-page'),
            'color-matrix': document.getElementById('color-matrix-page'),
            minesTower: document.getElementById('mines-tower-page'),
            'crash-game': document.getElementById('crash-game-page'),
            'mines-game': document.getElementById('mines-game-page'),
            // --- NEW PAGES FOR WINGO INTEGRATION ---
            wingoGame: document.getElementById('wingo-game-page'),
            withdraw: document.getElementById('withdraw-page'),
            withdrawHistory: document.getElementById('withdraw-history-page'),
        };
        const chatPage = document.getElementById('chat-page');
        const promoModalOverlay = document.getElementById('promo-modal-overlay');
        const updateOverlay = document.getElementById('update-overlay');
        const banOverlay = document.getElementById('ban-overlay');
        const splashScreen = document.getElementById('splash-screen'); // PREMIUM AUTH UPDATE

        const bottomNav = document.getElementById('bottom-navigation');
        const globalChatBtn = document.getElementById('global-chat-btn');
        const avatarModal = document.getElementById('avatar-modal-overlay');
        let sliderInterval, currentSlide = 0;
        let isPageTransitioning = false;
        let currentChatListener = null;
        let userStatusListener = null; 
        let lastPageId = 'dashboard';
        let currentUserData = null; 
        let currentDepositState = { amount: 0, invoiceId: '', channel: '' };
        let paymentTimerInterval = null; // New timer for payment page

        const gamesData = {
            lottery: [
                { name: 'Crash', imageUrl: 'https://imgproxy.v1.bundlecdn.com/unsafe/casino_home_2x/plain/https://v1.bundlecdn.com/casino-images/100hp/6a61a18f-9551-4f10-8505-bda9799c8ea8_horizontal.png@avif', comingSoon: false },
                { name: 'Wingo Mall', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRzsrCE05x8N1gvKUKjKQ_mm8o-gH1xBHpqlQFbqWztxya6C0Yks28wvhV_&s=10', comingSoon: false },
                { name: 'Mines Tower', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSusqqRka2tUPXKkeJElZQ9e5hbL7zWOkl8CJlf9cvXCA&s', comingSoon: false },
                { name: 'Mines', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSLKaOrSrvfizwwSQip_t0k9RxKwdYYs2Cur7RBcf8T-lMEy7BZAcyhp3w&s=10', comingSoon: false },
                { name: 'Color Matrix', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSC-u178yqFMneDs4_7RmU4trAMJ85VY0uUQ&s', comingSoon: false }
            ],
            sports: [
                { name: 'Cricket', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQalK9Tyv594MDAUKGEanSbdDrQcr9lFIZZzJyEBhqIZqqBpENUWgQCioc&s=10', comingSoon: true },
                { name: 'FootBall', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRE5yO8fqRB_ha42xOpSb2YVt7WXIL-VRi0QQ&s', comingSoon: false }
            ]
        };
        
        const sampleNames = ["Arjun", "Rahul", "Vikram", "Lamia", "Ravi", "Aslam", "Reza", "Sana", "Sita", "Waqas", "Mamun", "Sabina", "Raj", "Parvez", "Bilal", "Fahim", "Deepa", "Sidra", "Shafiq", "Farah", "Munna", "Ahmed", "Anjali", "Lakshmi", "Neha", "Zain", "Nazia", "Iqra", "Tania", "Karim", "Sumaiya", "Shamim", "Anik", "Nusrat", "Noman", "Rubel", "Barkat", "Mehedi", "Nasir", "Rahim", "Saima", "Hasina", "Tariq", "Sumon", "Aisha", "Khan", "Rafi", "Ishrat", "Hassan", "Ali", "Fatima", "Shuvo", "Gupta", "Kumar", "Sharmin"];
        const lotteryGameIcons = gamesData.lottery.map(g => g.imageUrl);
        const rankCrowns = {1: 'https://basantclub.net/assets/png/crown1-3912fd85.png', 2: 'https://basantclub.net/assets/png/crown2-c8aced52.png', 3: 'https://basantclub.net/assets/png/crown3-2ca02146.png'};
        let winningFeedInterval;
        let pendingMatrixBets = {};
        const gamePageMappings = {
            'crash-game': { name: 'Crash', imageUrl: 'https://imgproxy.v1.bundlecdn.com/unsafe/casino_home_2x/plain/https://v1.bundlecdn.com/casino-images/100hp/6a61a18f-9551-4f10-8505-bda9799c8ea8_horizontal.png@avif' },
            'color-matrix': { name: 'Color Matrix', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQSC-u178yqFMneDs4_7RmU4trAMJ85VY0uUQ&s' },
            'minesTower': { name: 'Mines Tower', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSusqqRka2tUPXKkeJElZQ9e5hbL7zWOkl8CJlf9cvXCA&s' },
            'footballGame': { name: 'FootBall', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRE5yO8fqRB_ha42xOpSb2YVt7WXIL-VRi0QQ&s' },
            'mines-game': { name: 'Mines', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSLKaOrSrvfizwwSQip_t0k9RxKwdYYs2Cur7RBcf8T-lMEy7BZAcyhp3w&s=10' },
            'wingoGame': { name: 'Wingo Mall', imageUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRzsrCE05x8N1gvKUKjKQ_mm8o-gH1xBHpqlQFbqWztxya6C0Yks28wvhV_&s=10' },
        };

        document.addEventListener('DOMContentLoaded', () => { 
            checkForUpdates();
            setupEventListeners(); 
            populateAvatarModal(); 
            loadAndSetupSlider();
            loadAndSetupActivityPromos(); 
            populateDashboardGames();
            startWinningFeed(); 
            populateMissionCards();
            initializeWithdrawalSystem();
        });
        
        // --- FOOTBALL GAME VARIABLES (REWRITTEN V2) ---
        const footballTeamNames = ["Dhaka Abahani", "Bashundhara Kings", "Sheikh Jamal DC", "Chittagong Abahani", "Mohammedan SC", "Saif SC", "Sheikh Russel KC", "Rahmatganj MFS", "Muktijoddha Sangsad", "Brothers Union", "Arambagh KS", "Uttar Baridhara", "Police FC", "Swadhinata KS", "Fortis FC", "Azampur FC", "Real Madrid", "FC Barcelona", "Man United", "Liverpool FC", "Bayern Munich", "Paris SG", "Juventus FC", "AC Milan", "Inter Milan", "Arsenal FC", "Chelsea FC", "Man City", "Atletico Madrid", "Borussia Dortmund", "AFC Ajax", "FC Porto", "SL Benfica", "Celtic FC", "Rangers FC", "Napoli", "Lazio", "Feyenoord", "PSV Eindhoven", "Sporting CP"];
        const footballTeamLogos = { "Man United": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(4).jpeg?alt=media&token=cbb6dc03-d973-46d4-be93-b8105458057b", "Napoli": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(13).jpeg?alt=media&token=079fa3b3-3d93-41f3-a210-f53bb0005bd9", "Real Madrid": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(2).png?alt=media&token=2ac9003f-0e0a-4403-90a6-60c0c070e522", "Bayern Munich": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(5).jpeg?alt=media&token=9d5a64e5-33f0-405e-975d-f0d47f56a675", "AFC Ajax": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(14).png?alt=media&token=9f4b1714-b844-4f90-8138-790346545321", "Uttar Baridhara": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fimages%20(2).png?alt=media&token=043c55bf-1e06-4c06-a5fe-10cc2545f77e", "Dhaka Abahani": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(22).png?alt=media&token=f8caff43-1b48-4a55-9682-9c7d2f310660", "Muktijoddha Sangsad": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(7).png?alt=media&token=55102bee-3ac6-4879-9e13-6dcd0e52635a", "Liverpool FC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(1).png?alt=media&token=d2c6c203-cb41-440d-8e8e-c2896f6bd21b", "FC Barcelona": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(3).png?alt=media&token=d0f7aadd-325f-4cc9-b58e-bf15074d60f3", "Paris SG": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(10).png?alt=media&token=95af057d-315f-407e-a22c-a5b652c441e9", "Juventus FC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(10).jpeg?alt=media&token=48668821-805d-418d-b979-36d5ce8a19ae", "Inter Milan": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(11).jpeg?alt=media&token=3625d6c0-9cc0-4ab0-95bd-8b7316a8dc07", "AC Milan": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fimages%20(26).jpeg?alt=media&token=921deccc-554a-4814-8585-e5f0f0112a87", "Arsenal FC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(17).png?alt=media&token=b5f6c95b-f9d3-4c7a-8bb0-64cfdc65eebe", "Chelsea FC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(18).png?alt=media&token=330f192b-8d9f-4563-b653-be39bdf", "Man City": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(19).png?alt=media&token=9fdacc5e-5ba5-485e-be36-27bc680b6711", "Atletico Madrid": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(20).png?alt=media&token=fc8d5d78-3d7a-401c-a4a8-d0eef3759dc6", "Borussia Dortmund": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(16).png?alt=media&token=760646ca-14eb-4fc7-bf80-d803e0ca2990", "FC Porto": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(11).png?alt=media&token=3fe96f77-d56e-4d18-a56a-230f46e0ae07", "SL Benfica": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(12).jpeg?alt=media&token=b9fb5a03-444c-46ec-98a7-715005714e4d", "Celtic FC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(12).png?alt=media&token=4cf2ce08-0cfe-4761-ba19-252aba96dcb9", "Rangers FC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(13).png?alt=media&token=428826cf-61a5-4718-8054-ce0ebbb72f2a", "Feyenoord": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(15).jpeg?alt=media&token=1004389f-49ac-4d6e-b0ca-1f40db52d495", "PSV Eindhoven": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(16).jpeg?alt=media&token=17394468-ee87-49e3-95d3-952feff3835e", "Sporting CP": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(15).png?alt=media&token=cc2e1594-1dc3-4a63-87b2-7e7670fb0703", "Lazio": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(14).jpeg?alt=media&token=26a4f748-24eb-4d38-9a06-b76d2faba0c7", "Bashundhara Kings": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(21).png?alt=media&token=74bdb7c3-1e32-48d8-af07-de315958c247", "Sheikh Jamal DC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(23).png?alt=media&token=e2b057a8-2a58-4113-830b-c88aa61b4e6a", "Chittagong Abahani": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(24).png?alt=media&token=6cb275cd-65fa-42e1-b1fd-8794c12aecf0", "Mohammedan SC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(25).png?alt=media&token=118d0135-247e-4436-8f88-2f9a650d0c0a", "Saif SC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(4).png?alt=media&token=9a232395-d0dd-44f4-b3f8-ec11e4843f11", "Sheikh Russel KC": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(5).png?alt=media&token=7b3b3607-f25b-4fc0-a631-d5940ff564b7", "Rahmatganj MFS": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(6).png?alt=media&token=ab16b699-2c41-4d06-b0a2-5e1a821a84f9", "Brothers Union": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(8).png?alt=media&token=051c8c6c-28a8-4cd1-8fd0-3f5fcf1ba747", "Arambagh KS": "https://firebasestorage.googleapis.com/v0/b/viptask-5c1fc.appspot.com/o/Football%20logo%2Fdownload%20(9).png?alt=media&token=583066bc-27b1-4406-9126-1b88a3cb60e0" };
        let footballGameTimerInterval = null;
        let currentFootballRoundData = null;
        let currentUserFootballBet = null;
        let footballGameState = 'INITIALIZING'; // INITIALIZING, BETTING, PROCESSING_RESULTS, ROUND_OVER
        let footballSelections = {};
        let totalFootballMatches = 0;
        const footballPayoutMultipliers = { low: 3, mid: 10, high: 1000 };
        // --- END FOOTBALL GAME VARIABLES ---

        // --- MINES TOWER VARIABLES (START) ---
        let minesTowerState = {phase: 'BETTING', betAmount: 30, currentLevel: 0, currentMultiplier: 1, winnings: 0, towerLogic: []};
        const TOWER_LEVELS = 5; const TILES_PER_LEVEL = 3; const TOWER_MULTIPLIERS = [1.00, 1.25, 1.60, 2.10, 2.80, 5.00]; const MINES_BET_STEPS = [30, 50, 100, 200, 500, 1000, 2000, 5000];
        // --- MINES TOWER VARIABLES (END) ---

        // --- NEW MINES GAME VARIABLES (START) ---
        let minesGameState = { phase: 'BETTING', betAmount: 30, minesLocations: [], revealedTiles: [], currentMultiplier: 1.0, gemsFound: 0, roundId: null };
        let minesGameCountdownInterval = null;
        const MINES_IN_GRID = 5;
        const MINES_GRID_SIZE = 5;
        // --- NEW MINES GAME VARIABLES (END) ---

        // --- MISSION VARIABLES (START) ===
        const missionDefinitions = { dailyLogin: { name: "Daily Login", type: "daily", icon: "fa-sign-in-alt", goal: 1, reward: 10, rule: "Log in to the app once every day to complete this mission." }, dailyDeposit: { name: "First Daily Deposit", type: "daily", icon: "fa-money-bill-wave", goal: 500, reward: 20, rule: "Make a single deposit of at least 500 to complete. Multiple smaller deposits do not count." }, dailyBet1: { name: "Daily Bet Mission 1", type: "daily", icon: "fa-dice", goal: 1500, reward: 50, rule: "Place a total of 1,500 in bets across any games within a single day." }, dailyBet2: { name: "Daily Bet Mission 2", type: "daily", icon: "fa-dice", goal: 3000, reward: 120, rule: "Place a total of 3,000 in bets across any games within a single day." }, weeklyBet: { name: "Weekly Bet Champion", type: "weekly", icon: "fa-trophy", goal: 50000, reward: 1000, rule: "Place a total of 50,000 in bets within one week (Mon-Sun) to claim this huge reward." }, weeklyDeposit: { name: "Weekly Deposit Guru", type: "weekly", icon: "fa-hand-holding-usd", goal: 20000, reward: 500, rule: "Deposit a total of 20,000 within one week (Mon-Sun)." }, weeklyInvites: { name: "Weekly Invitation", type: "weekly", icon: "fa-user-plus", goal: 5, reward: 250, rule: "Successfully invite 5 new users who make their first deposit within one week (Mon-Sun)." }, };
        // --- MISSION VARIABLES (END) ---
        
        // --- CRASH GAME VARIABLES (START) ---
        let crashGameAnimationId = null; let isCrashGameRunning = false; let crashGameInitialized = false;
        // --- CRASH GAME VARIABLES (END) ---
        
        // --- UPDATE & BAN SYSTEM (START) ---
        async function checkForUpdates() { 
            try { 
                const snapshot = await db.ref('config/versionInfo').once('value'); 
                if (snapshot.exists()) { 
                    const versionInfo = snapshot.val(); 
                    if (versionInfo.latestVersion > currentAppVersion && versionInfo.isForced) { 
                        document.getElementById('update-notes-container').innerHTML = versionInfo.updateNotes || '<p>A new update is required to improve your experience.</p>'; 
                        document.getElementById('update-download-btn').href = versionInfo.updateUrl || '#'; 
                        updateOverlay.classList.remove('hidden'); 
                        splashScreen.classList.add('hidden'); // Hide splash if update is forced
                        return; 
                    } 
                } 
            } catch (error) { 
                console.error("Could not check for updates:", error); 
            } 
            checkSession(); 
        }

        function setupUserStatusListener(username) { 
            if (userStatusListener) { userStatusListener.off(); } 
            userStatusListener = db.ref('users/' + username); 
            userStatusListener.on('value', (snapshot) => { 
                if (!snapshot.exists()) { handleLogout("Account not found."); return; } 
                
                const userData = snapshot.val(); 
                currentUserData = userData; 

                // === PREMIUM AUTH UPDATE: Session validation ===
                const localSessionId = localStorage.getItem('activeSessionId');
                if (userData.sessionId && localSessionId !== userData.sessionId) {
                    handleLogout("Logged out. Your account was accessed from another device.");
                    return;
                }
                
                if (userData.isBanned) { 
                    document.getElementById('ban-reason-text').textContent = userData.banReason || 'No reason specified.'; 
                    banOverlay.classList.remove('hidden'); 
                    globalChatBtn.classList.remove('hidden'); 
                } else { 
                    banOverlay.classList.add('hidden'); 
                    const pagesWithoutNav = ['login', 'register']; 
                    const gamePageIds = ['footballGame', 'color-matrix', 'minesTower', 'crash-game', 'mines-game', 'wingoGame']; 
                    const currentPageEl = Object.values(pages).find(p => p && !p.classList.contains('hidden')); 
                    const currentPageId = currentPageEl ? Object.keys(pages).find(key => pages[key] === currentPageEl) : null; 
                    if(currentPageId && !pagesWithoutNav.includes(currentPageId) && !gamePageIds.includes(currentPageId)){ 
                        globalChatBtn.classList.remove('hidden'); 
                    } 
                } 
                
                if (!document.getElementById('account-page').classList.contains('hidden')) { 
                    updateAccountUI(userData); 
                } 
            }); 
        }
        // --- UPDATE & BAN SYSTEM (END) ---

        // --- DASHBOARD & UI HELPERS (START) ---
        function populateDashboardGames() { const container = document.getElementById('dashboard-games-container'); container.innerHTML = ''; Object.keys(gamesData).forEach(categoryKey => { const category = gamesData[categoryKey]; const categorySection = document.createElement('div'); categorySection.className = 'category-section'; let categoryHTML = ` <div class="category-header"> <h2>${categoryKey.charAt(0).toUpperCase() + categoryKey.slice(1)}</h2> <a href="#" class="all-link" data-category="${categoryKey}">All ${category.length} <i class="fas fa-chevron-right"></i></a> </div> <div class="game-grid"> `; const gamesToShow = category.slice(0, 4); gamesToShow.forEach(game => { const comingSoonClass = game.comingSoon ? 'coming-soon' : ''; categoryHTML += ` <div class="game-item-wrapper"> <a href="#" class="game-image-link ${comingSoonClass}" data-game-name="${game.name}"> <img src="${game.imageUrl}" alt="${game.name}"> </a> <span class="game-item-name">${game.name}</span> </div> `; }); categoryHTML += `</div>`; categorySection.innerHTML = categoryHTML; container.appendChild(categorySection); }); }
        function showGameListPage(categoryKey) { const categoryData = gamesData[categoryKey]; if (!categoryData) return; document.getElementById('game-list-title').textContent = `${categoryKey.charAt(0).toUpperCase() + categoryKey.slice(1)} Games`; const grid = document.getElementById('game-list-grid'); grid.innerHTML = ''; categoryData.forEach(game => { const comingSoonClass = game.comingSoon ? 'coming-soon' : ''; const cardHTML = ` <div class="game-item-wrapper"> <a href="#" class="game-image-link ${comingSoonClass}" data-game-name="${game.name}"> <img src="${game.imageUrl}" alt="${game.name}"> </a> <span class="game-item-name">${game.name}</span> </div> `; grid.innerHTML += cardHTML; }); showPage('gameList'); }
        function maskName(name) { if (!name || name.length <= 4) return name || 'User***'; return name.substring(0, 3) + '***' + name.substring(name.length - 2); }
        function generateRandomWinner() { const name = sampleNames[Math.floor(Math.random() * sampleNames.length)]; const avatar = avatarUrls[Math.floor(Math.random() * avatarUrls.length)]; const icon = lotteryGameIcons[Math.floor(Math.random() * lotteryGameIcons.length)]; const amount = (Math.random() * 500 + 50).toFixed(2); return { name: maskName(name), avatar, icon, amount }; }
        function startWinningFeed() { const container = document.getElementById('winning-feed-container'); if (!container) return; clearInterval(winningFeedInterval); container.innerHTML = ''; for(let i=0; i < 10; i++) { const winner = generateRandomWinner(); const item = document.createElement('div'); item.className = 'winning-item'; item.innerHTML = ` <img src="${winner.avatar}" alt="Avatar" class="winner-avatar"> <div class="winner-details"> <div class="winner-info"> <img src="${winner.icon}" alt="Game Icon" class="winner-game-icon"> <span class="winner-name">${winner.name}</span> </div> <span class="winner-amount">Receive ${winner.amount}</span> </div> `; container.appendChild(item); } winningFeedInterval = setInterval(() => { if(document.hidden) return; const firstItem = container.querySelector('.winning-item'); if (firstItem) { firstItem.classList.add('remove'); setTimeout(() => { firstItem.remove(); const winner = generateRandomWinner(); const newItem = document.createElement('div'); newItem.className = 'winning-item'; newItem.innerHTML = ` <img src="${winner.avatar}" alt="Avatar" class="winner-avatar"> <div class="winner-details"> <div class="winner-info"> <img src="${winner.icon}" alt="Game Icon" class="winner-game-icon"> <span class="winner-name">${winner.name}</span> </div> <span class="winner-amount">Receive ${winner.amount}</span> </div> `; container.appendChild(newItem); }, 500); } }, 3000); }
        function generateRandomLeaderboardForDate() { const fallbackData = [ { rank: 1, username: "memqel", name: "Mem***QEL", earnings: Math.random() * 50000 + 200000 }, { rank: 2, username: "sam", name: "Sa***m", earnings: Math.random() * 40000 + 100000 }, { rank: 3, username: "memncl", name: "Mem***NCL", earnings: Math.random() * 30000 + 80000 }, { rank: 4, username: "memdc3", name: "Mem***DC3", earnings: Math.random() * 20000 + 60000 }, { rank: 5, username: "lovife", name: "Lov***ife", earnings: Math.random() * 10000 + 50000 }, { rank: 6, username: "memriw", name: "Mem***RIW", earnings: Math.random() * 10000 + 40000 }, { rank: 7, username: "memjjj", name: "Mem***JJJ", earnings: Math.random() * 10000 + 30000 }, ]; return fallbackData.map(user => ({ ...user, avatarUrl: avatarUrls[Math.floor(Math.random() * avatarUrls.length)] })); }
        async function loadAndDisplayLeaderboard() { const podiumContainer = document.getElementById('top-earners-podium'); const listContainer = document.getElementById('other-earners-list'); const chartHeader = document.querySelector('.earnings-chart-section .category-header h2'); if (chartHeader) chartHeader.textContent = "Yesterday's Earnings Chart"; if (!podiumContainer || !listContainer) return; podiumContainer.innerHTML = '<p style="text-align:center;color:var(--gray-text); padding: 20px;">Loading Leaderboard...</p>'; listContainer.innerHTML = ''; const today = new Date(); const yesterday = new Date(today); yesterday.setDate(today.getDate() - 1); const dateString = yesterday.toISOString().split('T')[0]; let leaderboardData = []; const leaderboardRef = db.ref(`leaderboards/${dateString}`); try { const snapshot = await leaderboardRef.once('value'); if (snapshot.exists()) { leaderboardData = snapshot.val(); } else { console.log(`Leaderboard for ${dateString} not found. Generating and saving a new one.`); const newBoard = generateRandomLeaderboardForDate(); await leaderboardRef.set(newBoard); leaderboardData = newBoard; } if (!Array.isArray(leaderboardData)) { leaderboardData = Object.values(leaderboardData); } } catch (error) { console.error("Error loading or generating leaderboard data:", error); podiumContainer.innerHTML = '<p style="text-align:center;color:var(--red-color); padding: 20px;">Could not load leaderboard.</p>'; listContainer.innerHTML = ''; return; } if (leaderboardData.length === 0) { podiumContainer.innerHTML = '<p style="text-align:center;color:var(--gray-text); padding: 40px 20px;">No ranking data available for yesterday.</p>'; listContainer.innerHTML = ''; return; } podiumContainer.innerHTML = ''; listContainer.innerHTML = ''; leaderboardData.forEach((earner) => { const currencySymbol = ''; let displayName = earner.name; let isCurrentUserClass = ''; if (currentUserData && currentUserData.username && earner.username.toLowerCase() === currentUserData.username.toLowerCase()) { displayName = "You"; isCurrentUserClass = "is-current-user"; } const wholeEarnings = Math.floor(earner.earnings); const avatar = earner.avatarUrl || avatarUrls[0]; if (earner.rank <= 3) { const podiumItem = document.createElement('div'); podiumItem.className = `podium-item rank-${earner.rank} ${isCurrentUserClass}`; podiumItem.innerHTML = ` <div class="podium-avatar-wrapper"> <img src="${rankCrowns[earner.rank]}" alt="Rank ${earner.rank}" class="podium-rank-icon"> <img src="${avatar}" alt="Avatar" class="podium-avatar"> </div> <div class="podium-details"> <div class="podium-rank-banner">NO${earner.rank}</div> <div class="podium-name">${displayName}</div> <div class="podium-earnings">${currencySymbol}${wholeEarnings.toLocaleString('en-IN')}</div> </div> `; podiumContainer.appendChild(podiumItem); } else { const listItem = document.createElement('div'); listItem.className = `earner-item ${isCurrentUserClass}`; listItem.innerHTML = ` <span class="earner-rank">${earner.rank}</span> <img src="${avatar}" alt="Avatar" class="earner-avatar"> <span class="earner-name">${displayName}</span> <span class="earner-amount-badge">${currencySymbol}${wholeEarnings.toLocaleString('en-IN')}</span> `; listContainer.appendChild(listItem); } }); const rank2 = podiumContainer.querySelector('.rank-2'); const rank1 = podiumContainer.querySelector('.rank-1'); const rank3 = podiumContainer.querySelector('.rank-3'); podiumContainer.innerHTML = ''; if(rank2) podiumContainer.appendChild(rank2); if(rank1) podiumContainer.appendChild(rank1); if(rank3) podiumContainer.appendChild(rank3); }
        async function loadAndSetupActivityPromos() { const container = document.getElementById('dynamic-activity-cards-container'); if (!container) return; container.innerHTML = ''; try { const snapshot = await db.ref('config/bannerImages').once('value'); if (snapshot.exists()) { const promos = snapshot.val(); const promoArray = Array.isArray(promos) ? promos : Object.values(promos); const activePromos = promoArray.filter(promo => promo && promo.isActive === true); if (activePromos.length === 0) { container.innerHTML = '<p style="text-align:center; color: var(--gray-text); padding: 20px 0;">No active promotions at the moment.</p>'; } else { activePromos.forEach(promo => { const card = document.createElement('a'); card.href = "#"; card.className = 'activity-promo-card'; card.dataset.link = promo.linkUrl || ''; card.innerHTML = `<img src="${promo.imageUrl}" alt="${promo.title}"><p class="activity-promo-title">${promo.title}</p>`; container.appendChild(card); }); } } else { container.innerHTML = '<p style="text-align:center; color: var(--gray-text); padding: 20px 0;">Check back later for new promotions!</p>'; } } catch (error) { console.error("Error fetching activity promotions:", error); container.innerHTML = '<p style="text-align:center; color: var(--red-color); padding: 20px 0;">Could not load promotions.</p>'; } }
        async function loadAndSetupSlider() { try { const snapshot = await db.ref('config/bannerImages').once('value'); if (snapshot.exists() && Array.isArray(snapshot.val())) { activeSliderData = snapshot.val().filter(slider => slider.isActive === true); } else {  activeSliderData = [ { id: '1', imageUrl: 'https://i.ibb.co/L5kChf1/promo-banner.png', title: 'Welcome Bonus', isActive: true, linkUrl: '#activity' }, { id: '2', imageUrl: 'https://i.ibb.co/qDWMsMh/invite-banner.png', title: 'Invite Friends', isActive: true, linkUrl: '#partner-rewards' }, { id: '3', imageUrl: 'https://i.ibb.co/Jqj84t3/mission-banner.png', title: 'Daily Missions', isActive: true, linkUrl: '#dailyTasks' }, { id: '4', imageUrl: 'https://i.ibb.co/n85X2sK/new-games-banner.png', title: 'New Games', isActive: true, linkUrl: '#dashboard' }, { id: '5', imageUrl: 'https://i.ibb.co/jLD3f6C/vip-banner.png', title: 'VIP Club', isActive: true, linkUrl: '#activity' }, { id: '6', imageUrl: 'https://i.ibb.co/R9m4Mbf/payment-banner.png', title: 'Secure Payments', isActive: true, linkUrl: '#wallet' } ];  } } catch (error) {  console.error("Error fetching slider images:", error);  activeSliderData = [ { id: '1', imageUrl: 'https://i.ibb.co/L5kChf1/promo-banner.png', title: 'Welcome Bonus', isActive: true, linkUrl: '#activity' }, { id: '2', imageUrl: 'https://i.ibb.co/qDWMsMh/invite-banner.png', title: 'Invite Friends', isActive: true, linkUrl: '#partner-rewards' }, { id: '3', imageUrl: 'https://i.ibb.co/Jqj84t3/mission-banner.png', title: 'Daily Missions', isActive: true, linkUrl: '#dailyTasks' }, { id: '4', imageUrl: 'https://i.ibb.co/n85X2sK/new-games-banner.png', title: 'New Games', isActive: true, linkUrl: '#dashboard' }, { id: '5', imageUrl: 'https://i.ibb.co/jLD3f6C/vip-banner.png', title: 'VIP Club', isActive: true, linkUrl: '#activity' }, { id: '6', imageUrl: 'https://i.ibb.co/R9m4Mbf/payment-banner.png', title: 'Secure Payments', isActive: true, linkUrl: '#wallet' } ]; } finally { setupSlider(); } }
        function setupSlider() { const sliderWrapper = document.querySelector('.slider-wrapper');  const sliderDotsContainer = document.querySelector('.slider-dots'); if(!sliderWrapper || !sliderDotsContainer) return; sliderWrapper.innerHTML = ''; sliderDotsContainer.innerHTML = ''; activeSliderData.forEach((slider, index) => { const linkAttr = slider.linkUrl ? `data-link="${slider.linkUrl}"` : ''; sliderWrapper.innerHTML += `<div class="slide" data-index="${index}"><img src="${slider.imageUrl}" alt="${slider.title}" ${linkAttr}></div>`; sliderDotsContainer.innerHTML += `<span class="dot" data-index="${index}"></span>`; }); if (activeSliderData.length > 0) { currentSlide = 0; updateSlider(); startSliderInterval(); } }
        function updateSlider() {  if (activeSliderData.length === 0) return; const allSlides = document.querySelectorAll('.slider-wrapper .slide'); const allDots = document.querySelectorAll('.slider-dots .dot'); allSlides.forEach(s => s.classList.remove('active')); allDots.forEach(d => d.classList.remove('active')); if (allSlides[currentSlide]) allSlides[currentSlide].classList.add('active'); if (allDots[currentSlide]) allDots[currentSlide].classList.add('active'); }
        function startSliderInterval() {  clearInterval(sliderInterval);  if (activeSliderData.length > 1) { sliderInterval = setInterval(() => {  currentSlide = (currentSlide + 1) % activeSliderData.length;  updateSlider();  }, 3000);  } }
        // --- DASHBOARD & UI HELPERS (END) ---
        
        // --- PAGE NAVIGATION & EVENT LISTENERS (START) ---
        function showGameLoaderAndTransition(pageId) {
            if (isPageTransitioning) return;
            isPageTransitioning = true;

            sessionStorage.setItem('lastActivePage', pageId);

            const loaderOverlay = document.getElementById('game-loader-overlay');
            const loaderImageContainer = document.getElementById('loader-game-image-container');
            const gameInfo = gamePageMappings[pageId];
            if (gameInfo) {
                loaderImageContainer.innerHTML = `<img src="${gameInfo.imageUrl}" alt="${gameInfo.name}">`;
            } else {
                loaderImageContainer.innerHTML = '';
            }
            loaderOverlay.classList.remove('hidden');
            loaderOverlay.classList.add('loading');
            const currentPageEl = Object.values(pages).find(p => p && !p.classList.contains('hidden'));
            if (currentPageEl) {
                currentPageEl.classList.add('hidden');
            }
            bottomNav.classList.add('hidden');
            globalChatBtn.classList.add('hidden');

            setTimeout(() => {
                const newPage = pages[pageId];
                if (newPage) {
                    newPage.scrollTop = 0;
                    const scrollContent = newPage.querySelector('.page-scroll-content');
                    if (scrollContent) scrollContent.scrollTop = 0;
                    
                    newPage.classList.remove('hidden');

                    if (pageId === 'footballGame') initializeFootballGamePage();
                    else if (pageId === 'color-matrix') initializeColorMatrixGame();
                    else if (pageId === 'minesTower') initializeMinesTowerGame();
                    else if (pageId === 'crash-game') initializeCrashGame();
                    else if (pageId === 'mines-game') initializeMinesGame();
                    else if (pageId === 'wingoGame') initializeWingoGame();
                }
                
                loaderOverlay.classList.add('hidden');
                loaderOverlay.classList.remove('loading');
                isPageTransitioning = false;
            }, 2500);
        }
        
        function showPage(pageId, isBackAction = false) {
            if (isPageTransitioning) { console.log("Page transition already in progress. Ignoring new request."); return; }
            setTimeout(() => { if (isPageTransitioning) { console.warn("Page transition flag reset by safety timer."); isPageTransitioning = false; } }, 1500);

            if (!pageId || !pages[pageId]) { pageId = 'login'; } // Default to login if unknown
            const gamePageIds = ['footballGame', 'color-matrix', 'minesTower', 'crash-game', 'mines-game', 'wingoGame']; 
            if (gamePageIds.includes(pageId)) { showGameLoaderAndTransition(pageId); return; } 
            isPageTransitioning = true; 
            const currentPageEl = Object.values(pages).find(p => p && !p.classList.contains('hidden')); 
            const currentPageId = currentPageEl ? Object.keys(pages).find(key => pages[key] === currentPageEl) : null; 
            const newPage = pages[pageId]; 
            if (currentPageEl === newPage) { isPageTransitioning = false; return; } 
            if (currentPageEl && !isBackAction) { lastPageId = currentPageId; } 
            chatPage.classList.add('hidden'); 
            if (currentChatListener) { currentChatListener.off(); currentChatListener = null; } 
            if (footballGameTimerInterval) { clearInterval(footballGameTimerInterval); footballGameTimerInterval = null; } 
            if (matrixGameInterval) { clearInterval(matrixGameInterval); matrixGameInterval = null; } 
            if (crashGameAnimationId) { cancelAnimationFrame(crashGameAnimationId); isCrashGameRunning = false; crashGameAnimationId = null; } 
            if (minesGameCountdownInterval) { clearInterval(minesGameCountdownInterval); minesGameCountdownInterval = null; } 
            if (G.timer) { clearInterval(G.timer); G.timer = null; } // Stop Wingo timer
            const pagesWithoutNav = ['login', 'register']; 
            const footballFooter = document.getElementById('football-game-footer'); 
            if(footballFooter) footballFooter.classList.toggle('hidden', pageId !== 'footballGame' || document.getElementById('football-betting-view').classList.contains('hidden')); 
            bottomNav.classList.toggle('hidden', pagesWithoutNav.includes(pageId)); 
            globalChatBtn.classList.toggle('hidden', pagesWithoutNav.includes(pageId) || gamePageIds.includes(pageId)); 
            if (!pagesWithoutNav.includes(pageId)) { if (!['deposit', 'payment', 'transactionHistory', 'gameHistory', 'announcementDetail', 'gameList', 'withdraw', 'withdrawHistory'].includes(pageId)) { sessionStorage.setItem('lastActivePage', pageId); } } 
            if (currentPageEl) { currentPageEl.classList.add('page-fade-out'); } 
            setTimeout(() => { if (currentPageEl) { currentPageEl.classList.add('hidden'); currentPageEl.classList.remove('page-fade-out'); } 
            if (newPage) { newPage.scrollTop = 0; if(newPage.querySelector('.page-scroll-content')) { newPage.querySelector('.page-scroll-content').scrollTop = 0; } 
            if(newPage.querySelector('.wallet-content-area')) { newPage.querySelector('.wallet-content-area').scrollTop = 0; } 
            
            newPage.classList.remove('hidden'); 
            
            if (pageId === 'partner-rewards' && currentUserData) updatePartnerRewardsUI(currentUserData); 
            if (pageId === 'transactionHistory') loadAndDisplayTransactionHistory(); if (pageId === 'gameHistory') loadAndDisplayGameHistory(); 
            if (pageId === 'dailyTasks' && currentUserData) updateMissionUI(); if (pageId === 'dashboard' && currentUserData) loadAndDisplayLeaderboard(); 
            if (pageId === 'wingoGame') initializeWingoGame();
            if (pageId === 'withdraw') showWithdrawPage();
            newPage.classList.add('page-fade-in'); setTimeout(() => { newPage.classList.remove('page-fade-in'); isPageTransitioning = false; }, 400); } 
            else { isPageTransitioning = false; } }, currentPageEl ? 350 : 0); 
        }

        function showChatPage() { if (!currentUserData) { showPopup("Please log in to use chat.", "error"); return; } isPageTransitioning = true; Object.values(pages).forEach(p => p.classList.add('hidden'));  bottomNav.classList.add('hidden'); globalChatBtn.classList.add('hidden'); chatPage.classList.remove('hidden'); chatPage.classList.add('page-fade-in'); listenForMessages(); setTimeout(() => { chatPage.classList.remove('page-fade-in'); isPageTransitioning = false; }, 400); }
        function setupEventListeners() { 
            document.querySelectorAll('#login-link').forEach(el => el.addEventListener('click', (e) => { e.preventDefault(); showPage('login', true); }));
            document.querySelectorAll('#register-link').forEach(el => el.addEventListener('click', (e) => { e.preventDefault(); showPage('register'); }));
            ['login-eye', 'register-eye', 'confirm-eye'].forEach(id => { const eyeIcon = document.getElementById(id); if (eyeIcon) { eyeIcon.addEventListener('click', () => { const passwordInput = eyeIcon.previousElementSibling; if (passwordInput.type === "password") { passwordInput.type = "text"; eyeIcon.classList.remove("fa-eye-slash"); eyeIcon.classList.add("fa-eye"); } else { passwordInput.type = "password"; eyeIcon.classList.remove("fa-eye"); eyeIcon.classList.add("fa-eye-slash"); } }); } }); 
        document.body.addEventListener('click', (e) => { 
            const gameLink = e.target.closest('.game-image-link'); 
            if(gameLink) { e.preventDefault(); const gameName = gameLink.dataset.gameName; 
                if(gameName === 'FootBall') showPage('footballGame'); 
                else if (gameName === 'Color Matrix') showPage('color-matrix'); 
                else if (gameName === 'Mines Tower') showPage('minesTower'); 
                else if (gameName === 'Crash') showPage('crash-game'); 
                else if (gameName === 'Mines') showPage('mines-game'); 
                else if (gameName === 'Wingo Mall') showPage('wingoGame'); 
            } 
            const crashBackBtn = e.target.closest('#crash-game-page .back-btn'); if(crashBackBtn) { e.preventDefault(); showPage(crashBackBtn.dataset.target, true); updateActiveNav('dashboard'); } 
        }); 
        document.querySelector('.slider-wrapper').addEventListener('click', (e) => { const slideImg = e.target.closest('.slide img'); if (slideImg) { e.preventDefault(); const link = slideImg.dataset.link; if (link && link.startsWith('#')) { const pageId = link.substring(1); showPage(pageId); updateActiveNav(pageId); } else if (link) { window.open(link, '_blank'); }  else { showPage('activity'); updateActiveNav('activity'); } } });  document.getElementById('dashboard-games-container').addEventListener('click', (e) => { const allLink = e.target.closest('.all-link'); if (allLink) { e.preventDefault(); const category = allLink.dataset.category; if (category) { showGameListPage(category); } } }); document.getElementById('game-list-back-btn').addEventListener('click', () => { showPage('dashboard', true); updateActiveNav('dashboard'); }); document.getElementById('dynamic-activity-cards-container').addEventListener('click', (e) => { e.preventDefault(); const card = e.target.closest('.activity-promo-card'); if (card) { const link = card.dataset.link; if (link && link.startsWith('#')) { const pageId = link.substring(1); showPage(pageId); updateActiveNav(pageId); } else if (link) { window.open(link, '_blank'); } } }); 
        document.getElementById('register-back').addEventListener('click', () => showPage('login', true)); document.getElementById('logout-btn').addEventListener('click', () => handleLogout("You have logged out.")); bottomNav.querySelectorAll('.nav-item').forEach(item => {  item.addEventListener('click', (e) => { e.preventDefault(); const pageId = item.dataset.page; showPage(pageId); updateActiveNav(pageId); });  }); document.getElementById('login-btn').addEventListener('click', handleLogin); document.getElementById('register-form').addEventListener('submit', (e) => { e.preventDefault(); handleRegistration(); }); document.querySelector('.refresh-icon').addEventListener('click', handleBalanceRefresh); document.getElementById('uid-copy-icon').addEventListener('click', handleCopyUid); document.getElementById('account-avatar').addEventListener('click', () => avatarModal.classList.remove('hidden')); avatarModal.addEventListener('click', (e) => { if (e.target === avatarModal) avatarModal.classList.add('hidden'); }); document.getElementById('go-to-daily-tasks').addEventListener('click', (e) => { e.preventDefault(); showPage('dailyTasks'); }); document.querySelector('#daily-tasks-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('activity'); }); globalChatBtn.addEventListener('click', (e) => {  e.preventDefault(); const currentPageEl = Object.values(pages).find(p => p && !p.classList.contains('hidden')); lastPageId = currentPageEl ? Object.keys(pages).find(key => pages[key] === currentPageEl) || 'dashboard' : 'dashboard'; showChatPage(); }); document.getElementById('chat-page-back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(lastPageId, true); updateActiveNav(lastPageId); }); document.getElementById('chat-form').addEventListener('submit', (e) => { e.preventDefault(); handleSendMessage(); });
        document.getElementById('chat-image-input').addEventListener('change', handleImageUpload);
        document.getElementById('invitation-link-copy-btn').addEventListener('click', handleCopyInviteLink);
        document.getElementById('commission-claim-btn').addEventListener('click', handleClaimCommission);
        document.querySelector('#partner-rewards-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('dashboard'); });
        document.querySelector('#deposit-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('wallet'); });
        document.getElementById('deposit-submit-btn').addEventListener('click', handleDepositSubmit);
        document.querySelector('#payment-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('deposit', true); updateActiveNav('wallet'); clearInterval(paymentTimerInterval); });
        document.getElementById('payment-page-submit-btn').addEventListener('click', handleProofSubmission);
        document.getElementById('payment-page').addEventListener('click', (e) => { if (e.target.closest('.copy-btn-page')) { const valueToCopy = e.target.closest('.info-value').querySelector('span').textContent; navigator.clipboard.writeText(valueToCopy).then(() => showPopup('Copied!', 'success'), () => showPopup('Failed to copy.', 'error')); } });
        document.querySelector('.quick-amount-buttons').addEventListener('click', (e) => { if (e.target.classList.contains('quick-amount-btn')) { document.getElementById('deposit-amount-input').value = e.target.dataset.amount; } });
        document.getElementById('payment-channels-grid').addEventListener('click', (e) => { const card = e.target.closest('.payment-channel-card'); if (card && !card.classList.contains('coming-soon')) { document.querySelectorAll('.payment-channel-card').forEach(c => c.classList.remove('selected')); card.classList.add('selected'); } });
        document.getElementById('transaction-history-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('transactionHistory'); });
        document.getElementById('game-history-btn').addEventListener('click', (e) => {  e.preventDefault();  showPage('gameHistory'); });
        document.querySelector('#transaction-history-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('account', true); updateActiveNav('account'); });
        document.querySelector('#game-history-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('account', true); updateActiveNav('account'); });
        document.getElementById('account-deposit-btn').addEventListener('click', () => { showPage('deposit'); updateActiveNav('wallet'); });
        document.getElementById('account-withdraw-btn').addEventListener('click', () => { showPage('withdraw'); updateActiveNav('wallet'); });
        document.getElementById('wallet-deposit-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('deposit'); updateActiveNav('wallet'); });
        document.getElementById('wallet-deposit-history-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('transactionHistory'); updateActiveNav('wallet'); });
        document.getElementById('wallet-withdrawal-history-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('transactionHistory'); updateActiveNav('wallet'); });
        document.getElementById('wallet-withdraw-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('withdraw'); updateActiveNav('wallet'); });
        document.querySelector('#wallet-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('dashboard'); });
        document.getElementById('commission-to-main-transfer-btn').addEventListener('click', handleCommissionTransfer);
        document.getElementById('main-wallet-circle').addEventListener('click', handleMainToTotalTransfer);
        document.getElementById('promo-code-btn-premium').addEventListener('click', (e) => { e.preventDefault(); promoModalOverlay.classList.remove('hidden'); }); // MODIFIED
        promoModalOverlay.addEventListener('click', (e) => { if(e.target === promoModalOverlay) promoModalOverlay.classList.add('hidden'); });
        document.querySelector('.promo-modal-close-btn').addEventListener('click', () => promoModalOverlay.classList.add('hidden'));
        document.getElementById('redeem-promo-code-btn').addEventListener('click', handleRedeemPromoCode);
        const announcementSection = document.querySelector('.announcement-section');
        if (announcementSection) {  announcementSection.addEventListener('click', (e) => { const announcementItem = e.target.closest('.announcement-item, .announcement-detail-btn'); if (announcementItem) { e.stopPropagation();  showPage('announcementDetail'); updateActiveNav('');  } }); }
        document.querySelector('#announcement-detail-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true);  updateActiveNav('dashboard'); });
        document.querySelector('#football-game-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('dashboard'); });
        document.getElementById('football-bet-amount-input').addEventListener('input', updateFootballDynamicPayouts);
        document.getElementById('football-match-list').addEventListener('click', handleFootballSelection);
        document.getElementById('buy-team-btn').addEventListener('click', handleBuyTeam);
        document.getElementById('football-history-btn').addEventListener('click', toggleFootballView);
        document.getElementById('tasks-list-container').addEventListener('click', (e) => { const claimButton = e.target.closest('.mission-button'); if (claimButton && !claimButton.disabled) { const missionId = claimButton.dataset.missionId; if (missionId) handleClaimMissionReward(missionId); } const rulesButton = e.target.closest('.mission-rules-btn'); if(rulesButton) { const missionId = rulesButton.dataset.missionId; const mission = missionDefinitions[missionId]; if(mission && mission.rule) { showPopup(`<div class='popup-message-premium-header'><i class='fas fa-info-circle'></i> ${mission.name} Rules</div><p style="text-align:center;">${mission.rule}</p>`, '', 6000); } } });
        document.querySelector('#color-matrix-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('dashboard'); });
        document.getElementById('matrix-rules-btn').addEventListener('click', () => { showPopup( `<div class='popup-message-premium-header'><i class='fas fa-info-circle'></i> How to Play Color Matrix</div> <p>1. Bet on one of the four colors within <strong>20 seconds</strong>.</p> <p>2. The color that appears most in the 5x5 grid wins.</p> <p>3. Payouts for <strong>Red, Green, Blue:</strong> Base 1.5x, plus 0.05x for each winning cell.</p> <p>4. Payout for <strong>Gold:</strong> A massive <strong>20x</strong> JACKPOT!</p>`, '', 10000); });
        document.querySelector('#mines-tower-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('dashboard'); });
        document.getElementById('tower-action-btn').addEventListener('click', handleMinesTowerActionBtn);
        document.getElementById('tower-bet-plus').addEventListener('click', () => adjustMinesTowerBet(1));
        document.getElementById('tower-bet-minus').addEventListener('click', () => adjustMinesTowerBet(-1));
        document.getElementById('tower-grid').addEventListener('click', handleMinesTowerTileClick);
        document.querySelector('#mines-game-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target, true); updateActiveNav('dashboard'); });
        document.getElementById('mines-action-btn').addEventListener('click', handleMinesActionBtn);
        document.getElementById('mines-bet-plus').addEventListener('click', () => adjustMinesBet(1));
        document.getElementById('mines-bet-minus').addEventListener('click', () => adjustMinesBet(-1));
        document.getElementById('mines-grid').addEventListener('click', handleMinesTileClick);
        document.querySelector('#wingo-game-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage(e.currentTarget.dataset.target || 'dashboard', true); updateActiveNav('dashboard'); });
        document.querySelector('#withdraw-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('wallet', true); updateActiveNav('wallet'); });
        document.querySelector('#withdraw-history-page .back-btn').addEventListener('click', (e) => { e.preventDefault(); showPage('withdraw', true); updateActiveNav('wallet'); });
    }
    // --- PAGE NAVIGATION & EVENT LISTENERS (END) ---
   
    // --- CRASH GAME FUNCTIONS (START) ---
    function initializeCrashGame() {
        if (!currentUserData) {
            showPopup("Please log in to play.", "error");
            showPage('dashboard', true);
            return;
        }

        const balanceEl = document.getElementById('crash-balance-amount');
        const multiplierDisplay = document.getElementById('crash-multiplier-display');
        const countdownDisplay = document.getElementById('crash-countdown');
        const historyBar = document.getElementById('crash-history-bar');
        const myBetsBody = document.getElementById('crash-my-bets-body');
        const timerEl = document.getElementById('crash-timer');
        const multiplierEl = document.getElementById('crash-multiplier-el');
        const crashIdEl = document.getElementById('crash-id-display');
        const rocket = document.getElementById('crash-rocket');
        const canvas = document.getElementById('crash-chart');
        const ctx = canvas.getContext('2d');
        const chartToggleBtn = document.getElementById('crash-chart-toggle');
        const animationContainer = document.getElementById('crash-animation-container');
        const controlPanels = [document.querySelector('.controls-panel[data-panel-id="1"]')];


        let myBetHistory = JSON.parse(localStorage.getItem(`crashMyBetHistory_${currentUserData.username}`)) || [];
        let roundHistory = JSON.parse(localStorage.getItem(`crashRoundHistory_${currentUserData.username}`)) || [];
        const currencySymbol = '';
        let playerBets = { 1: null };
        let gameState = {};
        let graphPoints = [];
        let isChartVisible = true;
        
        function toggleCrashChartVisibility() {
            isChartVisible = !isChartVisible;
            canvas.classList.toggle('hidden', !isChartVisible);
            animationContainer.classList.toggle('hidden', !isChartVisible);
            chartToggleBtn.classList.toggle('shown-state', isChartVisible);
            chartToggleBtn.classList.toggle('hidden-state', !isChartVisible);
            if (isChartVisible) {
                draw();
                if (gameState.state === 'running') {
                    updateRocketPosition();
                }
            }
        }

        if (chartToggleBtn && !crashGameInitialized) {
            chartToggleBtn.addEventListener('click', toggleCrashChartVisibility);
        }
        
        function setupCanvas() {
            if (!canvas) return;
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
        }

        function draw() {
            if (!ctx || !isChartVisible) return;
            const width = canvas.getBoundingClientRect().width;
            const height = canvas.getBoundingClientRect().height;
            ctx.clearRect(0, 0, width, height);
            if (gameState.state !== 'running' || graphPoints.length < 2) return;
            
            const originX = width * 0.05;
            const originY = height * 0.95;
            const lastPoint = graphPoints[graphPoints.length - 1];
            const maxX = Math.max(5, lastPoint.x * 1.1);
            const maxY = Math.max(2, lastPoint.y * 1.1);

            const points = graphPoints.map(p => ({
                x: originX + (p.x / maxX) * (width - originX * 2),
                y: originY - ((p.y - 1) / (maxY - 1)) * (originY * 0.9)
            }));

            ctx.beginPath();
            ctx.moveTo(points[0].x, points[0].y);
            points.forEach(p => ctx.lineTo(p.x, p.y));
            const gradient = ctx.createLinearGradient(0, height, 0, 0);
            gradient.addColorStop(0, 'rgba(239, 68, 68, 0.2)');
            gradient.addColorStop(1, 'rgba(239, 68, 68, 1.0)');
            ctx.fillStyle = gradient;
            const lastCanvasPoint = points[points.length - 1];
            ctx.lineTo(lastCanvasPoint.x, originY);
            ctx.lineTo(originX, originY);
            ctx.closePath();
            ctx.fill();

            ctx.beginPath();
            points.forEach((p, i) => { (i === 0) ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y); });
            ctx.strokeStyle = '#ef4444';
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        function updateRocketPosition() {
            if (gameState.state !== 'running' || graphPoints.length < 1 || !isChartVisible) return;

            const lastGraphPoint = graphPoints[graphPoints.length - 1];
            if (!lastGraphPoint) return;
            
            const width = canvas.getBoundingClientRect().width;
            const height = canvas.getBoundingClientRect().height;
            const originX = width * 0.05;
            const originY = height * 0.95;

            const maxX = Math.max(5, lastGraphPoint.x * 1.1);
            const maxY = Math.max(2, lastGraphPoint.y * 1.1);

            let rocketX = originX + (lastGraphPoint.x / maxX) * (width - originX * 2);
            let rocketY = originY - ((lastGraphPoint.y - 1) / (maxY - 1)) * (originY * 0.9);

            let angle = -45;
            if (graphPoints.length > 1) {
                const prevGraphPoint = graphPoints[graphPoints.length-2];
                const prevRocketX = originX + (prevGraphPoint.x / maxX) * (width - originX * 2);
                const prevRocketY = originY - ((prevGraphPoint.y - 1) / (maxY - 1)) * (originY * 0.9);
                angle = Math.atan2(rocketY - prevRocketY, rocketX - prevRocketX) * (180 / Math.PI);
            }
            
            rocket.style.transform = `translate(${rocketX - (rocket.width/2)}px, ${rocketY - (rocket.height/2)}px) rotate(${angle}deg)`;
        }

        function gameLoop() {
            if (!isCrashGameRunning) return;
            const now = Date.now();
            if (gameState.state === 'waiting') {
                const timePassed = (now - gameState.startTime) / 1000;
                const newCountdown = Math.max(0, 10 - timePassed);
                countdownDisplay.textContent = newCountdown.toFixed(2);
                if (newCountdown <= 0) startGame();
            } else if (gameState.state === 'running') {
                const timeElapsed = now - gameState.startTime;
                let newMultiplier = 1.00 + 0.06 * Math.pow(timeElapsed / 1000, 1.5);
                gameState.multiplier = newMultiplier;
                multiplierDisplay.textContent = newMultiplier.toFixed(2);
                graphPoints.push({ x: timeElapsed / 1000, y: newMultiplier });
                
                draw();
                updateRocketPosition();
                
                updateCashoutButtonsUI(newMultiplier);
                handleAutoCashout(newMultiplier);
                if (newMultiplier >= gameState.crashPoint) endGame();
            }
            crashGameAnimationId = requestAnimationFrame(gameLoop);
        }

        async function startGame() {
            gameState.state = 'running';
            gameState.startTime = Date.now();
            gameState.multiplier = 1.00;
            graphPoints = [{ x: 0, y: 1 }];

            rocket.classList.remove('crashed', 'hidden'); 
            
            updateUIVisibility('running');

            const width = canvas.getBoundingClientRect().width;
            const height = canvas.getBoundingClientRect().height;
            const originX = width * 0.05;
            const originY = height * 0.95;
            rocket.style.transform = `translate(${originX - (rocket.width/2)}px, ${originY - (rocket.height/2)}px) rotate(-45deg)`;


            const panel = controlPanels[0];
            const betBtn = panel.querySelector('.bet-btn');
            if (playerBets[1]) {
                betBtn.className = 'bet-btn cashing-out';
                betBtn.textContent = 'Cash Out';
                betBtn.disabled = false;
            } else {
                betBtn.className = 'bet-btn disabled';
                betBtn.textContent = 'Game Running';
                betBtn.disabled = true;
            }
        }

        async function endGame() {
            isCrashGameRunning = false;
            gameState.state = 'crashed';
            updateHistory(gameState.crashPoint);
            updateUIVisibility('crashed');

            const boomEl = document.createElement('div');
            boomEl.className = 'boom';
            boomEl.style.left = rocket.style.left;
            boomEl.style.top = rocket.style.top;
            boomEl.style.transform = rocket.style.transform;
            animationContainer.appendChild(boomEl);

            rocket.classList.add('hidden'); 
            
            setTimeout(() => { boomEl.remove(); }, 500);


            const bet = playerBets[1];
            if (bet && bet.status === 'placed') {
                const betBtn = controlPanels[0].querySelector('.bet-btn');
                bet.status = 'lost';
                bet.cashedAt = null;
                myBetHistory.push(bet);
                await logGameBet('Crash', bet.amount, gameState.roundId, { multiplier: gameState.crashPoint, panel: 1 }, 'lost', 0);
                betBtn.className = 'bet-btn disabled';
                betBtn.textContent = 'You Lost!';
                betBtn.disabled = true;
            }
            renderMyBetsHistory();
            setTimeout(startNewRoundCountdown, 3000);
        }

        async function startNewRoundCountdown() {
            if(isCrashGameRunning) cancelAnimationFrame(crashGameAnimationId);

            playerBets = { 1: null };
            const roundId = `UCR-${currentUserData.username.slice(0, 4)}-${Date.now().toString().slice(-5)}`;
            const crashPoint = Math.max(1.01, 1 / (1 - Math.random()));
            
            try {
                await db.ref(`crashRounds/userSpecific/${currentUserData.username}/liveRound`).set({ roundId, crashPoint, timestamp: firebase.database.ServerValue.TIMESTAMP });
            } catch (error) { console.error("Failed to update user-specific live round data:", error); }
            
            gameState = { state: 'waiting', startTime: Date.now(), roundId, crashPoint };
            rocket.classList.add('hidden');
            rocket.classList.remove('crashed');
            rocket.style.transform = '';
            
            graphPoints = [];
            draw(); 
            
            updateUIVisibility('waiting');
            const panel = controlPanels[0];
            const betBtn = panel.querySelector('.bet-btn');
            betBtn.className = 'bet-btn waiting';
            betBtn.textContent = 'Bet';
            betBtn.disabled = false;
            panel.querySelector('.autobet-toggle').checked = false;

            isCrashGameRunning = true;
            gameLoop();
        }
        
        async function placeBet(panelId) {
            if (gameState.state !== 'waiting') {
                showPopup('Betting is closed for this round.', 'error');
                return;
            }
            const panel = controlPanels[panelId - 1];
            const amount = parseFloat(panel.querySelector('.bet-amount-input').value);
            if (isNaN(amount) || amount < 30) {
                showPopup('Minimum bet is 30.', 'error');
                return;
            }
            if (currentUserData.balance < amount) {
                showPopup('Insufficient balance.', 'error');
                return;
            }

            const autoCashoutEl = panel.querySelector('.autowithdraw-toggle');
            const autoCashoutValueEl = panel.querySelector('.auto-withdraw-input');
            const autoCashout = autoCashoutEl.checked ? parseFloat(autoCashoutValueEl.value) : null;
            if (autoCashout && autoCashout < 1.01) {
                showPopup('Auto cashout must be at least 1.01x.', 'error');
                return;
            }
            
            playerBets[panelId] = { amount, autoCashout, status: 'placed', roundId: gameState.roundId, timestamp: Date.now() };
            
            const betBtn = panel.querySelector('.bet-btn');
            betBtn.className = 'bet-btn placed';
            betBtn.textContent = 'Bet Placed';
            betBtn.disabled = true;

            await db.ref(`users/${currentUserData.username}/balance`).set(firebase.database.ServerValue.increment(-amount));
        }

        async function cashOut(panelId) {
            const bet = playerBets[panelId];
            if (!bet || bet.status !== 'placed' || gameState.state !== 'running') return;

            const cashedAt = gameState.multiplier;
            const winnings = bet.amount * cashedAt;
            bet.status = 'cashed_out';
            bet.cashedAt = cashedAt;

            const betBtn = controlPanels[panelId - 1].querySelector('.bet-btn');
            betBtn.className = 'bet-btn cashed-out';
            betBtn.textContent = `Cashed Out @ ${cashedAt.toFixed(2)}x`;
            betBtn.disabled = true;

            myBetHistory.push(bet);
            await logGameBet('Crash', bet.amount, gameState.roundId, { multiplier: cashedAt, panel: panelId }, 'won', winnings);
            await db.ref(`users/${currentUserData.username}/balance`).set(firebase.database.ServerValue.increment(winnings));
            showGameResultPopup('crash', true, `You won ${currencySymbol}${winnings.toFixed(2)}!`);
        }

        const updateBalance = () => { if(currentUserData) { balanceEl.textContent = `${currencySymbol}${(currentUserData.balance || 0).toFixed(2)}`; } };

        function updateUIVisibility(state) {
            const timerEl = document.getElementById('crash-timer');
            const multiplierEl = document.getElementById('crash-multiplier-el');
            const finalResultEl = document.getElementById('crash-final-result-el');
            const finalMultiplierTextEl = document.getElementById('crash-final-multiplier');
            const finalTextEl = document.getElementById('crash-final-text');

            timerEl.style.display = 'none';
            multiplierEl.style.display = 'none';
            finalResultEl.style.display = 'none';

            if (state === 'waiting') {
                timerEl.style.display = 'block';
                crashIdEl.textContent = gameState.roundId ? gameState.roundId.slice(-8) : '...';
            
            } else if (state === 'running') {
                multiplierEl.style.display = 'block';
                document.getElementById('crash-multiplier-display').textContent = gameState.multiplier.toFixed(2);
            
            } else if (state === 'crashed') {
                finalResultEl.style.display = 'flex';
                const finalValue = gameState.crashPoint.toFixed(2);
                finalMultiplierTextEl.textContent = `${finalValue}x`;
                finalTextEl.textContent = `Crashed @ ${finalValue}x`;
            }
        }

        function updateCashoutButtonsUI(currentMultiplier) {
            const bet = playerBets[1];
            if (bet && bet.status === 'placed') {
                const btn = controlPanels[0].querySelector('.bet-btn');
                const potentialWinnings = bet.amount * currentMultiplier;
                btn.textContent = `Cash Out ${currencySymbol}${potentialWinnings.toFixed(2)}`;
            }
        }

        function handleAutoCashout(currentMultiplier) {
            const bet = playerBets[1];
            if (bet && bet.autoCashout && bet.status === 'placed' && currentMultiplier >= bet.autoCashout) {
                cashOut(1);
            }
        }

        function updateHistory(value) {
            value = parseFloat(value).toFixed(2);
            let colorClass = 'low';
            if (value >= 2.00) colorClass = 'medium';
            if (value >= 10.00) colorClass = 'high';

            roundHistory.unshift({ value, colorClass });
            if (roundHistory.length > 20) roundHistory.pop();
            localStorage.setItem(`crashRoundHistory_${currentUserData.username}`, JSON.stringify(roundHistory));

            const item = document.createElement('div');
            item.className = `history-item ${colorClass}`;
            item.textContent = `${value}x`;
            historyBar.insertBefore(item, historyBar.firstChild);
            if (historyBar.children.length > 20) {
                historyBar.removeChild(historyBar.lastChild);
            }
        }

        function renderMyBetsHistory() {
            myBetsBody.innerHTML = '';
            if (myBetHistory.length === 0) {
                myBetsBody.innerHTML = `<div class="placeholder-text">You haven't placed any bets yet.</div>`;
                return;
            }
            myBetHistory.slice().reverse().slice(0, 50).forEach(bet => {
                const date = new Date(bet.timestamp);
                const dateString = `${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
                const winnings = bet.status === 'cashed_out' ? bet.amount * bet.cashedAt : 0;
                const winClass = bet.status === 'cashed_out' ? 'win' : 'loss';
                const winText = bet.status === 'cashed_out' ? `${currencySymbol}${winnings.toFixed(2)}` : `${currencySymbol}0.00`;
                const multText = bet.status === 'cashed_out' ? `${bet.cashedAt.toFixed(2)}x` : '-';
                const row = `
                    <div class="bet-history-row">
                        <span class="bet-history-date">${dateString}</span>
                        <span class="bet-history-bet">${currencySymbol}${bet.amount.toFixed(2)}</span>
                        <span class="bet-history-mult">${multText}</span>
                        <span class="bet-history-win ${winClass}">${winText}</span>
                    </div>`;
                myBetsBody.innerHTML += row;
            });
        }
        
        if (!crashGameInitialized) {
            controlPanels.forEach((panel, index) => {
                const panelId = index + 1;
                panel.querySelector('.bet-btn').addEventListener('click', () => {
                    const bet = playerBets[panelId];
                    if (!bet || bet.status === 'placed') {
                        if(gameState.state === 'running' && bet && bet.status === 'placed') cashOut(panelId);
                        else placeBet(panelId);
                    }
                });
                panel.querySelector('.bet-amount-main-control .bet-adjust-btn[data-action="minus"]').addEventListener('click', () => {
                    const input = panel.querySelector('.bet-amount-input');
                    let val = parseFloat(input.value) || 30;
                    input.value = Math.max(30, val - 10);
                });
                panel.querySelector('.bet-amount-main-control .bet-adjust-btn[data-action="plus"]').addEventListener('click', () => {
                    const input = panel.querySelector('.bet-amount-input');
                    let val = parseFloat(input.value) || 30;
                    input.value = val + 10;
                });
                panel.querySelector('.bet-amount-quick-adjust .quick-bet-adjust-btn[data-action="half"]').addEventListener('click', () => {
                    const input = panel.querySelector('.bet-amount-input');
                    let val = parseFloat(input.value) || 30;
                    input.value = Math.max(30, Math.floor(val / 2));
                });
                panel.querySelector('.bet-amount-quick-adjust .quick-bet-adjust-btn[data-action="double"]').addEventListener('click', () => {
                    const input = panel.querySelector('.bet-amount-input');
                    let val = parseFloat(input.value) || 30;
                    input.value = val * 2;
                });
            });
            crashGameInitialized = true;
        }
        
        if (crashGameAnimationId) cancelAnimationFrame(crashGameAnimationId);
        isCrashGameRunning = true;
        setupCanvas();
        startNewRoundCountdown();
        updateBalance();
        
        historyBar.innerHTML = '';
        if (roundHistory.length > 0) {
            roundHistory.forEach(h => {
                const item = document.createElement('div');
                item.className = `history-item ${h.colorClass}`;
                item.textContent = `${parseFloat(h.value).toFixed(2)}x`;
                historyBar.appendChild(item);
            });
        }
        renderMyBetsHistory();
    }
    // --- CRASH GAME FUNCTIONS (END) ---
    
    // --- FOOTBALL GAME FUNCTIONS (REWRITTEN V2) ---
    async function initializeFootballGamePage() {
        if (footballGameTimerInterval) clearInterval(footballGameTimerInterval);
        document.getElementById('football-match-list').innerHTML = `<p style="text-align:center; color: var(--gray-text);">Loading matches...</p>`;
        document.getElementById('football-timer-status').textContent = 'Initializing...';
        document.getElementById('football-timer-countdown').textContent = '--:--:--';
        document.getElementById('football-betting-view').classList.remove('hidden');
        document.getElementById('football-history-view').classList.add('hidden');
        document.getElementById('football-game-footer').classList.remove('hidden');
        
        footballSelections = {};
        await loadAndInitializeFootballGameData();
        
        footballGameTimerInterval = setInterval(updateFootballGameClockAndState, 1000);
        updateFootballGameClockAndState();
        updateFootballDynamicPayouts();
    }

    function getBstTime() {
        const now = new Date();
        const localOffset = now.getTimezoneOffset() * 60000;
        const utc = now.getTime() + localOffset;
        const bstOffset = 6 * 3600 * 1000;
        return new Date(utc + bstOffset);
    }
    
        async function loadAndInitializeFootballGameData() {
        try {
            const roundSnapshot = await db.ref('football/currentRound').once('value');
            const nowBst = getBstTime();
            const bstHours = nowBst.getHours();
            const roundNumber = Math.floor(bstHours / 6) + 1; // 4 rounds per day
            
            const currentRoundDate = `${nowBst.getFullYear()}-${String(nowBst.getMonth()+1).padStart(2,'0')}-${String(nowBst.getDate()).padStart(2,'0')}`;
            const expectedRoundId = `${currentRoundDate}-R${roundNumber}`;

            if (!roundSnapshot.exists() || roundSnapshot.val().roundId !== expectedRoundId) {
                if(roundSnapshot.exists()) {
                   await finalizeAndArchiveRound(roundSnapshot.val());
                }
                await createNewFootballRound(expectedRoundId);
            } else {
                currentFootballRoundData = roundSnapshot.val();
            }
            
            totalFootballMatches = currentFootballRoundData.matchList.length;
            currentUserFootballBet = null; 
            if (currentUserData && currentFootballRoundData) {
                const userBetSnapshot = await db.ref(`users/${currentUserData.username}/footballBets/${currentFootballRoundData.roundId}`).once('value');
                if (userBetSnapshot.exists()) {
                    currentUserFootballBet = userBetSnapshot.val();
                }
            }
            
            displayMatchesFromFirebase();
            updateFootballBettingUI();
        } catch (error) {
            console.error("Failed to load football game data:", error);
            showPopup("Error loading game. Please try again.", "error");
        }
    }
        
        function updateFootballGameClockAndState() {
        if (!currentFootballRoundData) return;
        const nowBst = getBstTime();
        
        const bstHours = nowBst.getHours();
        const bstMinutes = nowBst.getMinutes();
        const currentRoundNumber = Math.floor(bstHours / 6) + 1;
        const currentRoundDate = `${nowBst.getFullYear()}-${String(nowBst.getMonth()+1).padStart(2,'0')}-${String(nowBst.getDate()).padStart(2,'0')}`;
        const expectedRoundId = `${currentRoundDate}-R${currentRoundNumber}`;
        
        if (currentFootballRoundData.roundId !== expectedRoundId) {
            initializeFootballGamePage();
            return;
        }

        const currentHourInCycle = bstHours % 6;
        let targetDate = new Date(nowBst);
        let previousGameState = footballGameState;
        const timerStatusEl = document.getElementById('football-timer-status');

           if (currentHourInCycle < 4) { 
            footballGameState = 'BETTING';
            timerStatusEl.textContent = 'Betting Ends In:';
            timerStatusEl.className = 'timer-status betting-open';
            targetDate.setHours(Math.floor(bstHours / 6) * 6 + 4, 0, 0, 0);
        } 
        else if (currentHourInCycle < 5 || (currentHourInCycle === 5 && bstMinutes < 50)) {
            footballGameState = 'PROCESSING_RESULTS';
            timerStatusEl.textContent = 'Processing Results...';
            timerStatusEl.className = 'timer-status';
            targetDate.setHours(Math.floor(bstHours / 6) * 6 + 5, 50, 0, 0);
        } 
        else { 
            footballGameState = 'ROUND_OVER';
            timerStatusEl.textContent = 'Next Round Starts In:';
            timerStatusEl.className = 'timer-status';
            targetDate.setHours(Math.floor(bstHours / 6) * 6 + 6, 0, 0, 0);
        }
        
        const diff = targetDate.getTime() - nowBst.getTime();
        const countdownEl = document.getElementById('football-timer-countdown');
        if (diff > 0) {
            const hours = Math.floor(diff / 3600000);
            const minutes = Math.floor((diff % 3600000) / 60000);
            const seconds = Math.floor((diff % 60000) / 1000);
            countdownEl.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2,'0')}`;
        } else {
            countdownEl.textContent = '00:00:00';
        }

        if (footballGameState !== previousGameState) {
            updateFootballBettingUI();
        }
    }
    
    function updateFootballDynamicPayouts() {
        const betAmountInput = document.getElementById('football-bet-amount-input');
        const amount = parseFloat(betAmountInput.value) || 0;
        const currencySymbol = '';

        document.querySelector('#football-dynamic-payout-table [data-tier="low"]').textContent = `${currencySymbol}${(amount * footballPayoutMultipliers.low).toLocaleString()}`;
        document.querySelector('#football-dynamic-payout-table [data-tier="mid"]').textContent = `${currencySymbol}${(amount * footballPayoutMultipliers.mid).toLocaleString()}`;
        document.querySelector('#football-dynamic-payout-table [data-tier="high"]').textContent = `${currencySymbol}${(amount * footballPayoutMultipliers.high).toLocaleString()}`;
    }
    
    async function createNewFootballRound(roundId) {
        let teamsToPair = [...footballTeamNames].sort(() => 0.5 - Math.random());
        const matchList = [];
        while (teamsToPair.length >= 2 && matchList.length < 18) { // Capped at 18 matches
            matchList.push([teamsToPair.pop(), teamsToPair.pop()]); 
        }

        const matchScores = {};
        const winningOutcomes = {};
        matchList.forEach((match, index) => {
            const score1 = Math.floor(Math.random() * 5);
            const score2 = Math.floor(Math.random() * 5);
            const matchKey = `match_${index}`;
            matchScores[matchKey] = `${score1}-${score2}`;
            if(score1 > score2) winningOutcomes[matchKey] = 'teamA';
            else if (score2 > score1) winningOutcomes[matchKey] = 'teamB';
            else winningOutcomes[matchKey] = 'draw';
        });

        const newRoundData = {
            roundId: roundId,
            matchList: matchList,
            matchScores: matchScores,
            winningOutcomes: winningOutcomes,
            createdAt: firebase.database.ServerValue.TIMESTAMP
        };
        await db.ref('football/currentRound').set(newRoundData);
        currentFootballRoundData = newRoundData;
    }
        
    async function finalizeAndArchiveRound(oldRoundData) {
        if (!oldRoundData || !oldRoundData.roundId) return;
        await db.ref(`football/history/${oldRoundData.roundId}`).set(oldRoundData);
        console.log(`Archived round: ${oldRoundData.roundId}`);
    }
    
    function displayMatchesFromFirebase() {
        if (!currentFootballRoundData || !currentFootballRoundData.matchList) return;
        const matchListContainer = document.getElementById('football-match-list');
        matchListContainer.innerHTML = '';
        
        const defaultLogo = "https://i.ibb.co/68c1pws/avatar-placeholder.png";

        currentFootballRoundData.matchList.forEach((match, index) => {
            const matchKey = `match_${index}`;
            const [team1, team2] = match;
            const logo1 = footballTeamLogos[team1] || defaultLogo;
            const logo2 = footballTeamLogos[team2] || defaultLogo;
            
            const shouldShowScore = footballGameState === 'PROCESSING_RESULTS' || footballGameState === 'ROUND_OVER';
            const scoreText = shouldShowScore 
                ? (currentFootballRoundData.matchScores[matchKey] || 'VS').replace('-', ' - ') 
                : 'VS';
            
            const matchItem = document.createElement('div');
            matchItem.className = 'match-item-1x2';
            matchItem.dataset.matchId = matchKey;
            matchItem.innerHTML = `
                <div class="match-teams-info">
                    <div class="match-team-display">
                        <img src="${logo1}" alt="${team1} logo">
                        <span>${team1}</span>
                    </div>
                    <div class="match-score-display">${scoreText}</div>
                    <div class="match-team-display">
                        <img src="${logo2}" alt="${team2} logo">
                        <span>${team2}</span>
                    </div>
                </div>
                <div class="match-betting-options">
                    <div class="bet-option" data-match-id="${matchKey}" data-outcome="teamA">Win</div>
                    <div class="bet-option" data-match-id="${matchKey}" data-outcome="draw">Draw</div>
                    <div class="bet-option" data-match-id="${matchKey}" data-outcome="teamB">Win</div>
                </div>
            `;
            matchListContainer.appendChild(matchItem);
        });
    }
    
        function updateFootballBettingUI() {
        const bettingView = document.getElementById('football-betting-view');
        const promptEl = document.getElementById('football-selection-prompt');

        const hasBet = !!currentUserFootballBet;
        const isLocked = hasBet || footballGameState !== 'BETTING';

        bettingView.classList.toggle('bet-placed', hasBet);
        bettingView.classList.toggle('round-closed', !hasBet && footballGameState !== 'BETTING');
        document.getElementById('football-bet-amount-input').disabled = isLocked;
        
        document.querySelectorAll('.bet-option').forEach(el => el.classList.remove('selected'));

        if (hasBet) {
            footballSelections = currentUserFootballBet.selections || {};
            for (const matchId in footballSelections) {
                const outcome = footballSelections[matchId];
                const optionEl = document.querySelector(`.bet-option[data-match-id="${matchId}"][data-outcome="${outcome}"]`);
                if(optionEl) optionEl.classList.add('selected');
            }
             document.getElementById('football-bet-amount-input').value = currentUserFootballBet.betAmount;
             updateFootballDynamicPayouts();

            if (footballGameState !== 'BETTING') {
                promptEl.innerHTML = `This round is closed. Final results are shown below.`;
                displayFinalResults(true);
            } else {
                promptEl.textContent = 'You have placed a bet for this round. Good luck!';
            }
        } else { // No bet placed
            footballSelections = {};
            if (footballGameState === 'BETTING') {
                promptEl.textContent = `Select an outcome for all ${totalFootballMatches} matches.`;
            } else {
                promptEl.textContent = 'This round is closed for betting. Final results are shown below.';
                displayFinalResults(false);
            }
        }
        updateTeamSelectionUI();
    }

    function handleFootballSelection(e) {
        const optionEl = e.target.closest('.bet-option');
        if (!optionEl || footballGameState !== 'BETTING' || currentUserFootballBet) return;
        
        const matchId = optionEl.dataset.matchId;
        const outcome = optionEl.dataset.outcome;
        
        optionEl.parentElement.querySelectorAll('.bet-option').forEach(el => el.classList.remove('selected'));
        
        optionEl.classList.add('selected');
        footballSelections[matchId] = outcome;

        updateTeamSelectionUI();
    }

        function updateTeamSelectionUI() {
        const selectedCount = Object.keys(footballSelections).length;
        const counterDiv = document.querySelector('.selection-counter');
        const buyBtn = document.getElementById('buy-team-btn');
        const hasBet = !!currentUserFootballBet;

        if (hasBet || footballGameState !== 'BETTING') {
            counterDiv.innerHTML = `<span style="color: var(--primary-green); font-weight: 700;">Your bet is locked for this round!</span>`;
            buyBtn.textContent = 'Bet Placed';
            buyBtn.disabled = true;
            return;
        }

        counterDiv.innerHTML = `Selected: <span id="selected-teams-count">${selectedCount}</span>/<span id="total-matches-count">${totalFootballMatches}</span>`;

        if (selectedCount === totalFootballMatches) {
            buyBtn.disabled = false;
            buyBtn.textContent = `Place Bet`;
        } else {
            buyBtn.disabled = true;
            buyBtn.textContent = `Select ${totalFootballMatches - selectedCount} More`;
        }
    }
    
        async function handleBuyTeam() {
        if (!currentUserData) { showPopup('You must be logged in.', 'error'); return; }
        if (footballGameState !== 'BETTING') { showPopup('Betting is currently closed.', 'error'); return; }

        const betPrice = parseFloat(document.getElementById('football-bet-amount-input').value);
        if(isNaN(betPrice) || betPrice < 30) { showPopup('Minimum bet is 30.', 'error'); return; }
        if (currentUserData.balance < betPrice) { showPopup('Insufficient balance.', 'error'); return; }
        if(Object.keys(footballSelections).length !== totalFootballMatches) { showPopup('Please make a selection for every match.', 'error'); return; }
        
        const newBalance = currentUserData.balance - betPrice;
        const betDataForUserHistory = { selections: footballSelections, betAmount: betPrice, timestamp: firebase.database.ServerValue.TIMESTAMP };
        
        const betDataForAdminPanel = { betAmount: betPrice, selections: footballSelections };

        try {
            await logGameBet('Football Fantasy', betPrice, currentFootballRoundData.roundId, { selections: footballSelections });
            
            const updates = {};
            updates[`users/${currentUserData.username}/footballBets/${currentFootballRoundData.roundId}`] = betDataForUserHistory;
            updates[`football/currentRound/bets/${currentUserData.username}`] = betDataForAdminPanel;
            updates[`users/${currentUserData.username}/balance`] = newBalance;
            
            await db.ref().update(updates);
            await updateUserMissionProgress('bet', betPrice);
            
            currentUserData.balance = newBalance;
            updateAccountUI(currentUserData);
            
            showPopup(`Bet of ${betPrice} placed successfully!`, 'success');
            
            await loadAndInitializeFootballGameData();

        } catch (err) { showPopup('Failed to place bet. Try again.', 'error'); console.error(err); }
    }
    
    function toggleFootballView() {
        const bettingView = document.getElementById('football-betting-view');
        const historyView = document.getElementById('football-history-view');
        const isHistoryVisible = !historyView.classList.contains('hidden');

        bettingView.classList.toggle('hidden', !isHistoryVisible);
        historyView.classList.toggle('hidden', isHistoryVisible);
        document.getElementById('football-game-footer').classList.toggle('hidden', !isHistoryVisible);

        if (isHistoryVisible) {
            displayMatchesFromFirebase(); 
            updateFootballBettingUI(); 
        } else {
            displayFootballHistory(); 
        }
    }

    
            function displayFinalResults(isUserBet) {
        const shouldShowResults = footballGameState === 'PROCESSING_RESULTS' || footballGameState === 'ROUND_OVER';
        if (!currentFootballRoundData || !currentFootballRoundData.winningOutcomes || !shouldShowResults) {
            return;
        }

        const winningOutcomes = currentFootballRoundData.winningOutcomes;
        const matchScores = currentFootballRoundData.matchScores || {};

        document.querySelectorAll('.match-item-1x2').forEach(itemEl => {
            const matchId = itemEl.dataset.matchId;
            const winner = winningOutcomes[matchId];
            if (!winner) return;

            itemEl.classList.add('finalized');
            
            const scoreDisplay = itemEl.querySelector('.match-score-display');
            if(matchScores[matchId]) {
                scoreDisplay.textContent = matchScores[matchId].replace('-', ' - ');
            }

            const winningOption = itemEl.querySelector(`.bet-option[data-outcome="${winner}"]`);
            if(winningOption) winningOption.classList.add('winner');

            if (isUserBet && currentUserFootballBet) {
                const userPick = currentUserFootballBet.selections[matchId];
                if (userPick) {
                    const correct = userPick === winner;
                    itemEl.classList.add(correct ? 'correct-pick' : 'incorrect-pick');
                }
            }
        });
    }

    async function displayFootballHistory() {
        const contentContainer = document.getElementById('football-history-content');
        contentContainer.innerHTML = `<p style="text-align:center; color: var(--gray-text);">Loading history...</p>`;
        if(!currentUserData) { contentContainer.innerHTML = `<p style="text-align:center; color: var(--gray-text);">Please log in.</p>`; return; }

        try {
            await checkAndUpdateFootballHistory();
            const historySnapshot = await db.ref(`users/${currentUserData.username}/gameHistory`).orderByChild('gameName').equalTo('Football Fantasy').limitToLast(10).once('value');

            if(!historySnapshot.exists()) {
                contentContainer.innerHTML = `<p style="text-align:center; color: var(--gray-text);">No Football bets found.</p>`;
                return;
            }
            
            let historyHTML = `<h3 class="history-section-title">My Recent Football Bets</h3>`;
            const bets = [];
            historySnapshot.forEach(snap => { bets.push(snap.val()); });
            bets.reverse();

            for(const bet of bets) {
                const roundSnapshot = await db.ref(`football/history/${bet.roundId}`).once('value');
                if(!roundSnapshot.exists()) continue;
                
                const roundData = roundSnapshot.val();
                const statusClass = (bet.status || 'pending').toLowerCase();
                const winningsText = bet.status === 'won' ? `<strong>Winnings:</strong> <span class="winnings-amount">${(bet.winnings || 0).toLocaleString()}</span>` : ``;
                const correctPicks = bet.details.correctPicks || 0;
                
                let matchesHTML = '';
                roundData.matchList.forEach((match, index) => {
                    const matchId = `match_${index}`;
                    const userPick = bet.details.selections[matchId];
                    const actualWinner = roundData.winningOutcomes[matchId];
                    const score = roundData.matchScores[matchId] || 'N/A';
                    
                    let pickText = 'N/A';
                    if (userPick === 'teamA') pickText = match[0];
                    else if (userPick === 'teamB') pickText = match[1];
                    else if (userPick === 'draw') pickText = 'Draw';

                    const pickStatusClass = (userPick === actualWinner) ? 'win' : 'loss';
                    
                    matchesHTML += `
                        <div class="history-match-item">
                            <span class="teams">${match[0]} vs ${match[1]}</span>
                            <div class="result-info">
                                <span class="user-pick ${pickStatusClass}">${pickText}</span>
                                <span class="final-result">${score}</span>
                            </div>
                        </div>
                    `;
                });

                                    historyHTML += `
                    <div class="history-bet-card-premium">
                       <div class="history-bet-header">
                           <span class="round-id">Round: ${bet.roundId}</span>
                           <span class="bet-status ${statusClass}">${bet.status}</span>
                       </div>
                       <div class="history-bet-summary">
                            <span><strong>Bet:</strong> ${bet.betAmount.toLocaleString()}</span>
                            <span><strong>Correct Picks:</strong> ${correctPicks}/${roundData.matchList.length}</span>
                            ${winningsText}
                       </div>
                       <div class="history-match-list">
                            ${matchesHTML}
                       </div>
                    </div>
                `;
            }

            contentContainer.innerHTML = historyHTML;

         } catch(error) {
             console.error("Error fetching football history:", error);
             contentContainer.innerHTML = `<p style="text-align:center; color: var(--red-color);">Could not load history.</p>`;
         }
    }
    // --- FOOTBALL GAME FUNCTIONS (END) ---

    // --- COLOR MATRIX GAME LOGIC (START) ===
    let matrixGameInterval;
    let selectedColor = null;
    const ROUND_DURATION = 30;
    const BETTING_TIME = 20;

    function initializeColorMatrixGame() {
        const matrixGrid = document.getElementById('matrix-grid');
        const matrixPlaceBetBtn = document.getElementById('matrix-place-bet-btn');
        const matrixBetAmountInput = document.getElementById('matrix-bet-amount');

        matrixGrid.innerHTML = '';
        for (let i = 0; i < 25; i++) {
            const cell = document.createElement('div');
            cell.className = 'matrix-cell';
            cell.id = `matrix-cell-${i}`;
            matrixGrid.appendChild(cell);
        }
        
        document.querySelector('#color-matrix-page .bet-color-options').addEventListener('click', (e) => {
            const btn = e.target.closest('.bet-color-btn');
            if (btn) {
                document.querySelectorAll('#color-matrix-page .bet-color-btn').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedColor = btn.dataset.color;
                matrixPlaceBetBtn.textContent = `Bet on ${selectedColor.charAt(0).toUpperCase() + selectedColor.slice(1)}`;
                matrixPlaceBetBtn.disabled = false;
            }
        });

        document.querySelector('#color-matrix-page .quick-bet-buttons').addEventListener('click', (e) => {
            if(e.target.classList.contains('quick-bet-btn')) {
                matrixBetAmountInput.value = e.target.textContent.replace('', '');
            }
        });

        matrixPlaceBetBtn.addEventListener('click', handleMatrixBetPlacement);

        if (matrixGameInterval) clearInterval(matrixGameInterval);
        matrixGameInterval = setInterval(colorMatrixGameLoop, 1000);
        colorMatrixGameLoop();
        loadMatrixHistory();
    }

    async function colorMatrixGameLoop() {
        const matrixTimerBar = document.getElementById('matrix-timer-bar');
        const matrixTimerText = document.getElementById('matrix-timer-countdown-text');
        const matrixRoundIdEl = document.getElementById('matrix-round-id');
        const matrixBettingControls = document.querySelector('#color-matrix-page .matrix-betting-controls');

        if(!matrixTimerBar) { 
            clearInterval(matrixGameInterval);
            return;
        }

        const now = new Date();
        const seconds = now.getSeconds();
        
        const timeIntoRound = seconds % ROUND_DURATION;
        const roundId = `${now.toISOString().slice(0,10)}T${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(Math.floor(seconds/30)*30).padStart(2,'0')}`;
        matrixRoundIdEl.textContent = `Round: #${roundId.slice(-8)}`;

        if (timeIntoRound < BETTING_TIME) {
            const timeLeft = BETTING_TIME - timeIntoRound;
            matrixTimerText.textContent = `Betting ends in: ${timeLeft}s`;
            matrixTimerBar.style.width = `${(timeLeft / BETTING_TIME) * 100}%`;
            matrixTimerBar.style.transition = 'width 1s linear';
            
            if (matrixBettingControls.style.pointerEvents === 'none') {
                matrixBettingControls.style.opacity = '1';
                matrixBettingControls.style.pointerEvents = 'auto';
            }
            
        } else if (timeIntoRound === BETTING_TIME) {
            matrixTimerText.textContent = `Calculating Result...`;
            matrixBettingControls.style.opacity = '0.5';
            matrixBettingControls.style.pointerEvents = 'none';
            generateAndDisplayResult(roundId);
        } else {
            matrixTimerText.textContent = `Next round starts soon...`;
            if(timeIntoRound === BETTING_TIME + 1) {
                matrixTimerBar.style.transition = 'none';
                matrixTimerBar.style.width = '0%';
            }
        }
        
        if (timeIntoRound === (ROUND_DURATION - 1)) {
            resetMatrixGrid();
            loadMatrixHistory();
        }
    }

    function resetMatrixGrid() {
        const matrixPlaceBetBtn = document.getElementById('matrix-place-bet-btn');
        document.querySelectorAll('.matrix-cell').forEach(cell => {
            cell.className = 'matrix-cell';
        });
        selectedColor = null;
        document.querySelectorAll('#color-matrix-page .bet-color-btn').forEach(b => b.classList.remove('selected'));
        matrixPlaceBetBtn.textContent = `Select a Color`;
        matrixPlaceBetBtn.disabled = true;
        document.getElementById('matrix-result-popup-container').innerHTML = '';
    }

    async function generateAndDisplayResult(roundId) {
        const colors = ['red', 'green', 'blue', 'gold'];
        const colorDistribution = { red: 0, green: 0, blue: 0, gold: 0 };
        const gridResult = [];

        for (let i = 0; i < 25; i++) {
            const random = Math.random();
            let chosenColor;
            if (random < 0.04) {
                chosenColor = 'gold';
            } else {
                chosenColor = colors[Math.floor(Math.random() * 3)];
            }
            gridResult.push(chosenColor);
            colorDistribution[chosenColor]++;
        }

        let winningColor = 'red';
        let maxCount = 0;
        for (const color in colorDistribution) {
            if (colorDistribution[color] > maxCount) {
                maxCount = colorDistribution[color];
                winningColor = color;
            }
        }
        
        gridResult.forEach((color, i) => {
            const cell = document.getElementById(`matrix-cell-${i}`);
            setTimeout(() => {
                cell.classList.add(color, 'reveal');
            }, i * 40);
        });

        setTimeout(() => {
            for(let i=0; i < 25; i++) {
                if (gridResult[i] === winningColor) {
                    document.getElementById(`matrix-cell-${i}`).classList.add('winner-pop');
                }
            }
        }, 1200);

        const resultData = { winningColor, maxCount, distribution: colorDistribution, timestamp: firebase.database.ServerValue.TIMESTAMP };
        await db.ref(`colorMatrix/history/${roundId}`).set(resultData);
        await checkUserBetResult(roundId, winningColor, maxCount);
    }

    async function handleMatrixBetPlacement() {
        if (!currentUserData) { showPopup("Please log in to bet.", "error"); return; }
        if (!selectedColor) { showPopup("Please select a color.", "error"); return; }
        
        const matrixBetAmountInput = document.getElementById('matrix-bet-amount');
        const matrixBettingControls = document.querySelector('#color-matrix-page .matrix-betting-controls');
        const amount = parseInt(matrixBetAmountInput.value);

        if (isNaN(amount) || amount <= 0) { showPopup("Invalid bet amount.", "error"); return; }
        if (currentUserData.balance < amount) { showPopup("Insufficient balance.", "error"); return; }

        const now = new Date();
        const seconds = now.getSeconds();
        const roundId = `${now.toISOString().slice(0,10)}T${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(Math.floor(seconds/30)*30).padStart(2,'0')}`;
        
        try {
            const betKey = await logGameBet('Color Matrix', amount, roundId, { color: selectedColor });
            if(betKey) {
                pendingMatrixBets[roundId] = betKey;
            }

            const newBalance = currentUserData.balance - amount;
            await db.ref(`users/${currentUserData.username}/balance`).set(newBalance);
            await updateUserMissionProgress('bet', amount);

            currentUserData.balance = newBalance;
            updateAccountUI(currentUserData);
            showPopup(`Bet of ${amount} on ${selectedColor} placed!`, 'success');
            matrixBettingControls.style.opacity = '0.5';
            matrixBettingControls.style.pointerEvents = 'none';

        } catch(err) {
            showPopup("Failed to place bet. Please try again.", "error");
            console.error(err);
        }
    }

    async function checkUserBetResult(roundId, winningColor, maxCount) {
        if(!currentUserData) return;
        
        const betKey = pendingMatrixBets[roundId];
        if (!betKey) return; 
        
        const betRef = db.ref(`users/${currentUserData.username}/gameHistory/${betKey}`);
        const betSnapshot = await betRef.once('value');
        
        if (betSnapshot.exists()) {
            const betData = betSnapshot.val();
            if(betData.status !== 'pending') return;
            
            let updates = {};

            if (betData.details.color === winningColor) {
                let payoutMultiplier = (winningColor === 'gold') ? 20 : (1.5 + (maxCount * 0.05));
                const winnings = betData.betAmount * payoutMultiplier;

                updates[`users/${currentUserData.username}/balance`] = firebase.database.ServerValue.increment(winnings);
                updates[`users/${currentUserData.username}/gameHistory/${betKey}/status`] = 'won';
                updates[`users/${currentUserData.username}/gameHistory/${betKey}/winnings`] = winnings;
                
                showGameResultPopup('matrix', true, `You won ${winnings.toFixed(2)}!`);

            } else {
                updates[`users/${currentUserData.username}/gameHistory/${betKey}/status`] = 'lost';
                showGameResultPopup('matrix', false, `Sorry, you lost.`, `The winning color was ${winningColor}.`);
            }

            if (Object.keys(updates).length > 0) {
                await db.ref().update(updates);
                delete pendingMatrixBets[roundId];
            }
        }
    }

    async function loadMatrixHistory() {
        const matrixHistoryList = document.getElementById('matrix-history-list');
        if(!matrixHistoryList) return;
        matrixHistoryList.innerHTML = '';
        const historyRef = db.ref('colorMatrix/history').orderByChild('timestamp').limitToLast(10);
        const snapshot = await historyRef.once('value');
        if (snapshot.exists()) {
            const historyData = [];
            snapshot.forEach(child => { historyData.push(child.val()); });
            
            historyData.reverse().forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item ${item.winningColor}`;
                historyItem.textContent = item.maxCount;
                matrixHistoryList.appendChild(historyItem);
            });
        }
    }
    // --- COLOR MATRIX GAME LOGIC (END) ===
    
    // --- MINES TOWER GAME LOGIC (START) ---
    function initializeMinesTowerGame() {
        resetMinesTower();
    }

    function buildMinesTowerGrid() {
        const gridEl = document.getElementById('tower-grid');
        gridEl.innerHTML = '';
        for (let i = 0; i < TOWER_LEVELS; i++) {
            const levelEl = document.createElement('div');
            levelEl.className = 'tower-level';
            levelEl.dataset.level = i;
            
            let tilesHTML = `<div class="tower-level-multiplier">${TOWER_MULTIPLIERS[i+1]}x</div>`;
            for (let j = 0; j < TILES_PER_LEVEL; j++) {
                tilesHTML += `<div class="tower-tile" data-level="${i}" data-tile="${j}"></div>`;
            }
            levelEl.innerHTML = tilesHTML;
            gridEl.appendChild(levelEl);
        }
    }

    function resetMinesTower() {
        minesTowerState = {
            phase: 'BETTING', betAmount: 30, currentLevel: 0, currentMultiplier: 1.00, winnings: 0, towerLogic: [], towerId: null
        };
        buildMinesTowerGrid();
        
        const actionBtn = document.getElementById('tower-action-btn');
        actionBtn.textContent = 'PLAY';
        actionBtn.disabled = false;
        actionBtn.classList.remove('cashout');
        
        document.getElementById('tower-bet-plus').disabled = false;
        document.getElementById('tower-bet-minus').disabled = false;

        updateMinesTowerInfoUI();
    }
    
    function adjustMinesTowerBet(direction) {
        if (minesTowerState.phase !== 'BETTING') return;
        let currentIndex = MINES_BET_STEPS.indexOf(minesTowerState.betAmount);
        if(currentIndex === -1) currentIndex = 0;
        
        let newIndex = currentIndex + direction;
        if(newIndex >= 0 && newIndex < MINES_BET_STEPS.length) {
            minesTowerState.betAmount = MINES_BET_STEPS[newIndex];
            document.getElementById('tower-bet-amount-display').textContent = minesTowerState.betAmount;
        }
    }

    function updateMinesTowerInfoUI() {
        document.getElementById('tower-next-payout').textContent = `${TOWER_MULTIPLIERS[minesTowerState.currentLevel + 1] || 'MAX'}x`;
        document.getElementById('tower-current-winnings').textContent = `${minesTowerState.winnings.toFixed(2)}`;
        document.getElementById('tower-bet-amount-display').textContent = minesTowerState.betAmount;
        document.getElementById('tower-id-display').textContent = minesTowerState.towerId ? `#${minesTowerState.towerId}` : '#...';
        
        document.querySelectorAll('.tower-level').forEach(level => {
            level.classList.remove('active');
            if (parseInt(level.dataset.level) === minesTowerState.currentLevel && minesTowerState.phase === 'CLIMBING') {
                level.classList.add('active');
            }
        });

        document.querySelectorAll('.tower-tile').forEach(tile => {
            const isClickable = parseInt(tile.dataset.level) === minesTowerState.currentLevel && minesTowerState.phase === 'CLIMBING';
            tile.classList.toggle('clickable', isClickable);
        });
    }
    
    async function handleMinesTowerActionBtn() {
        if (!currentUserData) { showPopup("Please log in to play.", 'error'); return; }
        const actionBtn = document.getElementById('tower-action-btn');

        if (minesTowerState.phase === 'BETTING') {
            const betAmount = minesTowerState.betAmount;
            if (isNaN(betAmount) || betAmount <= 0) { showPopup("Invalid bet amount", "error"); return; }
            if (currentUserData.balance < betAmount) { showPopup("Insufficient balance", "error"); return; }
            
            try {
                const newBalance = currentUserData.balance - betAmount;
                await db.ref(`users/${currentUserData.username}/balance`).set(newBalance);
                await updateUserMissionProgress('bet', betAmount);

                currentUserData.balance = newBalance;
                updateAccountUI(currentUserData);
                
                minesTowerState.phase = 'CLIMBING';
                minesTowerState.towerId = 'MT' + Date.now().toString().slice(-6);
                
                minesTowerState.towerLogic = [];
                for(let i=0; i < TOWER_LEVELS; i++) {
                    const level = [1, 1, 1];
                    const trapIndex = Math.floor(Math.random() * TILES_PER_LEVEL);
                    level[trapIndex] = 0;
                    minesTowerState.towerLogic.push(level);
                }
                
                document.getElementById('tower-bet-plus').disabled = true;
                document.getElementById('tower-bet-minus').disabled = true;

                actionBtn.textContent = `CASHOUT 0.00`;
                actionBtn.disabled = true;
                actionBtn.classList.add('cashout');
                
                updateMinesTowerInfoUI();
                
            } catch(e) {
                showPopup("Error starting game. Please try again.", "error");
            }

        } else if (minesTowerState.phase === 'CLIMBING') {
            await endMinesTowerGame(true, false);
        }
    }
    
    async function handleMinesTowerTileClick(e) {
        const tile = e.target.closest('.tower-tile.clickable');
        if (!tile) return;
        
        const level = parseInt(tile.dataset.level);
        const tileIndex = parseInt(tile.dataset.tile);

        const isGem = minesTowerState.towerLogic[level][tileIndex] === 1;

        const levelTiles = document.querySelectorAll(`.tower-tile[data-level="${level}"]`);
        levelTiles.forEach((t, index) => {
            const type = minesTowerState.towerLogic[level][index] === 1 ? 'gem' : 'trap';
            t.innerHTML = `<i class="fas fa-${type === 'gem' ? 'gem' : 'bomb'}"></i>`;
            t.classList.add('revealed', type);
        });

        if (isGem) {
            minesTowerState.currentLevel++;
            minesTowerState.currentMultiplier = TOWER_MULTIPLIERS[minesTowerState.currentLevel];
            minesTowerState.winnings = minesTowerState.betAmount * minesTowerState.currentMultiplier;
            
            const actionBtn = document.getElementById('tower-action-btn');
            actionBtn.textContent = `CASHOUT ${minesTowerState.winnings.toFixed(2)}`;
            actionBtn.disabled = false;

            if (minesTowerState.currentLevel >= TOWER_LEVELS) {
                await endMinesTowerGame(true, false);
            } else {
                updateMinesTowerInfoUI();
            }
        } else {
            await endMinesTowerGame(false, true);
        }
    }

    async function endMinesTowerGame(isWin, isTrap) {
        const actionBtn = document.getElementById('tower-action-btn');
        actionBtn.disabled = true;
        let winnings = 0;
        if (isWin) {
            winnings = minesTowerState.winnings;
            const updates = {};
            updates[`users/${currentUserData.username}/balance`] = firebase.database.ServerValue.increment(winnings);
            await db.ref().update(updates);
            showPopup(`You cashed out ${winnings.toFixed(2)}!`, 'success', 4000);
        } else if (isTrap) {
            showPopup(`You hit a bomb! Game over.`, 'error', 4000);
        }
        
        const status = isWin ? 'won' : 'lost';
        await logGameBet('Mines Tower', minesTowerState.betAmount, minesTowerState.towerId, { finalLevel: minesTowerState.currentLevel, finalMultiplier: minesTowerState.currentMultiplier }, status, winnings);
        
        setTimeout(resetMinesTower, 3000);
    }
    // --- MINES TOWER GAME LOGIC (END) ---
    
    // --- NEW MINES GAME LOGIC (START) ---
    function initializeMinesGame() {
        buildMinesGrid();
        resetMinesGame(true);
    }

    function buildMinesGrid() {
        const gridEl = document.getElementById('mines-grid');
        gridEl.innerHTML = '';
        for (let i = 0; i < MINES_GRID_SIZE * MINES_GRID_SIZE; i++) {
            const tile = document.createElement('div');
            tile.className = 'mines-tile';
            tile.dataset.index = i;
            gridEl.appendChild(tile);
        }
    }
    
    function resetMinesGame(isInitial = false) {
        if (minesGameCountdownInterval) clearInterval(minesGameCountdownInterval);

        minesGameState = {
            phase: 'BETTING',
            betAmount: 30,
            minesLocations: [],
            revealedTiles: [],
            currentMultiplier: 1.0,
            gemsFound: 0,
            roundId: null
        };
        
        document.querySelectorAll('#mines-grid .mines-tile').forEach(tile => {
            tile.className = 'mines-tile';
            tile.innerHTML = '';
        });

        if (!isInitial) {
            startMinesCountdown();
        } else {
            document.getElementById('mines-status-display').textContent = 'Place your bet';
            updateMinesUI();
        }
    }

    function startMinesCountdown() {
        let countdown = 5; 
        const statusDisplay = document.getElementById('mines-status-display');
        
        const updateCountdown = () => {
            if (countdown > 0) {
                statusDisplay.textContent = `New round in ${countdown}s...`;
                countdown--;
            } else {
                clearInterval(minesGameCountdownInterval);
                minesGameState.phase = 'BETTING';
                statusDisplay.textContent = 'Place your bet';
                updateMinesUI();
            }
        };

        updateCountdown(); 
        minesGameCountdownInterval = setInterval(updateCountdown, 1000);
    }

    function updateMinesUI() {
        const { phase, betAmount, currentMultiplier, gemsFound, roundId } = minesGameState;
        const currencySymbol = '';
        const winnings = phase === 'PLAYING' ? betAmount * currentMultiplier : 0;
        const nextMultiplier = gemsFound === 0 ? 1.2 : parseFloat((currentMultiplier * 1.2).toFixed(2));

        document.getElementById('mines-round-id').textContent = roundId ? `#${roundId}` : '#...';
        document.getElementById('mines-current-multiplier').textContent = `${currentMultiplier.toFixed(2)}x`;
        document.getElementById('mines-next-payout').textContent = `${nextMultiplier.toFixed(2)}x`;
        document.getElementById('mines-current-winnings').textContent = `${currencySymbol}${winnings.toFixed(2)}`;
        
        document.getElementById('mines-bet-amount-display').textContent = betAmount;
        document.getElementById('mines-bet-balance-display').textContent = `${currencySymbol}${(currentUserData?.balance || 0).toFixed(2)}`;

        const actionBtn = document.getElementById('mines-action-btn');
        actionBtn.classList.remove('cashout');
        if (phase === 'BETTING') {
            actionBtn.textContent = 'PLAY';
            actionBtn.disabled = false;
        } else if (phase === 'PLAYING') {
            actionBtn.textContent = `CASHOUT ${currencySymbol}${winnings.toFixed(2)}`;
            actionBtn.disabled = gemsFound === 0;
            if(gemsFound > 0) actionBtn.classList.add('cashout');
        } else { // 'ENDED' phase
            actionBtn.textContent = 'GAME OVER';
            actionBtn.disabled = true;
        }

        const betAdjustDisabled = (phase !== 'BETTING');
        document.getElementById('mines-bet-plus').disabled = betAdjustDisabled;
        document.getElementById('mines-bet-minus').disabled = betAdjustDisabled;

        document.querySelectorAll('#mines-grid .mines-tile').forEach(tile => {
            const isRevealed = tile.classList.contains('revealed');
            const isClickable = (phase === 'PLAYING' && !isRevealed);
            tile.classList.toggle('disabled', !isClickable);
        });
    }

        async function handleMinesActionBtn() {
        const { phase, betAmount } = minesGameState;

        if (phase === 'BETTING') {
            if (!currentUserData) { showPopup("Please log in to play.", 'error'); return; }
            if (currentUserData.balance < betAmount) { showPopup("Insufficient balance", "error"); return; }
            
            const roundId = `MINES-${currentUserData.username.slice(0,3)}-${Date.now().toString().slice(-6)}`;
            const mineIndices = new Set();
            while (mineIndices.size < MINES_IN_GRID) {
                mineIndices.add(Math.floor(Math.random() * 25));
            }
            const mineLocations = Array.from(mineIndices);

            const updates = {};
            updates[`minesRounds/userSpecific/${currentUserData.username}/liveRound`] = { roundId, mineLocations, timestamp: firebase.database.ServerValue.TIMESTAMP };
            updates[`users/${currentUserData.username}/balance`] = firebase.database.ServerValue.increment(-betAmount);

            try {
                await db.ref().update(updates);
                await updateUserMissionProgress('bet', betAmount);
                
                minesGameState.phase = 'PLAYING';
                minesGameState.roundId = roundId;
                minesGameState.minesLocations = mineLocations;
                minesGameState.revealedTiles = [];
                minesGameState.gemsFound = 0;
                minesGameState.currentMultiplier = 1.0;

                document.getElementById('mines-status-display').textContent = 'Find the gems!';
                updateMinesUI();
            } catch (e) {
                showPopup("Error starting game. Please try again.", "error");
                console.error("Mines game start error:", e);
                await db.ref(`users/${currentUserData.username}/balance`).set(firebase.database.ServerValue.increment(betAmount));
            }

        } else if (phase === 'PLAYING') {
            const winnings = minesGameState.betAmount * minesGameState.currentMultiplier;
            await db.ref(`users/${currentUserData.username}/balance`).set(firebase.database.ServerValue.increment(winnings));
            
            await logGameBet('Mines', betAmount, minesGameState.roundId, { 
                finalMultiplier: minesGameState.currentMultiplier, 
                gemsFound: minesGameState.gemsFound,
                mineLocations: minesGameState.minesLocations
            }, 'won', winnings);
            
            showPopup(`You cashed out ${winnings.toFixed(2)}!`, 'success');
            endMinesGame(true, false);
        }
    }
    
    function adjustMinesBet(direction) {
        if (minesGameState.phase !== 'BETTING') return;
        let currentIndex = MINES_BET_STEPS.indexOf(minesGameState.betAmount);
        if (currentIndex === -1) currentIndex = 0;
        
        let newIndex = currentIndex + direction;
        if (newIndex >= 0 && newIndex < MINES_BET_STEPS.length) {
            minesGameState.betAmount = MINES_BET_STEPS[newIndex];
            updateMinesUI();
        }
    }

        async function handleMinesTileClick(e) {
        const tile = e.target.closest('.mines-tile');
        if (!tile || minesGameState.phase !== 'PLAYING' || tile.classList.contains('revealed')) return;

        const index = parseInt(tile.dataset.index);
        const isMine = minesGameState.minesLocations.includes(index);

        tile.classList.add('revealed');
        minesGameState.revealedTiles.push(index);

        if (isMine) {
            tile.innerHTML = `<i class="fas fa-bomb"></i>`;
            tile.classList.add('mine');
            
            await logGameBet('Mines', minesGameState.betAmount, minesGameState.roundId, { 
                gemsFound: minesGameState.gemsFound,
                mineLocations: minesGameState.minesLocations
            }, 'lost', 0);
            endMinesGame(true, true);
        } else {
            tile.innerHTML = `<i class="fas fa-gem"></i>`;
            tile.classList.add('gem');
            
            minesGameState.gemsFound++;
            
            if (minesGameState.gemsFound === 1) {
                minesGameState.currentMultiplier = 1.2;
            } else {
                minesGameState.currentMultiplier = parseFloat((minesGameState.currentMultiplier * 1.2).toFixed(2));
            }
            
            updateMinesUI();
        }
    }
    
    function endMinesGame(revealMines, isLoss) {
        minesGameState.phase = 'ENDED';
        
        if (isLoss) {
            document.getElementById('mines-status-display').textContent = 'You hit a mine!';
        } else {
            document.getElementById('mines-status-display').textContent = 'Cashed Out!';
        }

        if (revealMines) {
            document.querySelectorAll('#mines-grid .mines-tile').forEach(tile => {
                const index = parseInt(tile.dataset.index);
                if (!tile.classList.contains('revealed')) {
                    if (minesGameState.minesLocations.includes(index)) {
                        tile.innerHTML = `<i class="fas fa-bomb"></i>`;
                        tile.classList.add('mine');
                    } else {
                        tile.innerHTML = `<i class="fas fa-gem"></i>`;
                        tile.classList.add('gem');
                    }
                    tile.classList.add('revealed', 'disabled');
                }
            });
        }
        
        updateMinesUI();

        setTimeout(() => {
            resetMinesGame(false);
        }, 3000); 
    }
    // --- NEW MINES GAME LOGIC (END) ---

    // --- HISTORY & BET LOGGING (START) ---
    async function logGameBet(gameName, betAmount, roundId, details = {}, status = 'pending', winnings = 0) {
        if (!currentUserData) return null;
        const username = currentUserData.username;
        const historyRef = db.ref(`users/${username}/gameHistory`);
        const newBet = { gameName, betAmount, roundId, details, status, winnings, timestamp: firebase.database.ServerValue.TIMESTAMP };
        const newBetRef = await historyRef.push(newBet);
        return newBetRef.key;
    }

        async function loadAndDisplayGameHistory() {
        const container = document.getElementById('game-history-list');
        const username = currentUserData ? currentUserData.username : JSON.parse(localStorage.getItem('loggedInUser'));
        
        if (!username) {
            container.innerHTML = '<p style="text-align: center; color: var(--gray-text);">Please log in to see history.</p>';
            return;
        }
        container.innerHTML = '<p style="text-align: center; color: var(--gray-text);">Loading game history...</p>';

        try {
            await checkAndUpdateFootballHistory();

            const snapshot = await db.ref(`users/${username}/gameHistory`).orderByChild('timestamp').limitToLast(50).once('value');
            if (snapshot.exists()) {
                const allTransactions = [];
                snapshot.forEach(childSnapshot => {
                    allTransactions.push(childSnapshot.val());
                });
                
                container.innerHTML = '';
                allTransactions.reverse().forEach(bet => { 
                    const date = new Date(bet.timestamp);
                    const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
                    const statusClass = (bet.status || 'pending').toLowerCase();
                    const currencySymbol = '';

                    let winningsHTML = '';
                    if (bet.status === 'won') {
                        winningsHTML = `<div class="winnings won">+${currencySymbol}${(bet.winnings || 0).toFixed(2)}</div>`;
                    } else if (bet.status === 'lost') {
                         winningsHTML = `<div class="winnings lost">-${currencySymbol}${(bet.betAmount || 0).toFixed(2)}</div>`;
                    }

                    let extraDetailsHTML = '';
                    if (bet.gameName === 'Mines' && bet.details && bet.details.mineLocations) {
                        const mineLocationsText = bet.details.mineLocations.map(index => {
                            const row = Math.floor(index / 5) + 1;
                            const col = (index % 5) + 1;
                            return `${row}-${col}`;
                        }).join(', ');

                        extraDetailsHTML = `<div class="game-date" style="font-size: 0.75rem; color: #ffc107;">Mines: ${mineLocationsText}</div>`;
                    }

                    const cardHTML = `
                        <div class="history-item-card game-history-card">
                            <div class="game-info">
                                <div class="game-name">${bet.gameName}</div>
                                <div class="game-date">${formattedDate}</div>
                                <div class="bet-amount">Bet: ${currencySymbol}${(bet.betAmount || 0).toFixed(2)}</div>
                                ${extraDetailsHTML}
                            </div>
                            <div class="bet-info">
                                <div class="history-status ${statusClass}">${bet.status}</div>
                                ${winningsHTML}
                            </div>
                        </div>
                    `;
                    container.innerHTML += cardHTML;
                });
            } else {
                container.innerHTML = '<p style="text-align: center; color: var(--gray-text);">No game history found.</p>';
            }
        } catch (error) {
            console.error("Error loading game history:", error);
            container.innerHTML = '<p style="text-align: center; color: var(--red-color);">Could not load history.</p>';
        }
    }
    
    async function checkAndUpdateFootballHistory() {
        if (!currentUserData) return;
        const username = currentUserData.username;
        const historyRef = db.ref(`users/${username}/gameHistory`);
        const snapshot = await historyRef.orderByChild('status').equalTo('pending').once('value');

        if (!snapshot.exists()) return;

        const updates = {};
        let totalWinnings = 0;
        
        for (const betKey in snapshot.val()) {
            const bet = snapshot.val()[betKey];
            if (bet.gameName !== 'Football Fantasy' || !bet.roundId || !bet.details || !bet.details.selections) continue;

            const roundHistorySnapshot = await db.ref(`football/history/${bet.roundId}`).once('value');
            if (roundHistorySnapshot.exists()) {
                const roundData = roundHistorySnapshot.val();
                const winningOutcomes = roundData.winningOutcomes;
                const userPicks = bet.details.selections;
                
                let correctPicks = 0;
                for (const matchId in userPicks) {
                    if (userPicks[matchId] === winningOutcomes[matchId]) {
                        correctPicks++;
                    }
                }

                let winnings = 0;
                let status = 'lost';
                
                if (correctPicks >= 13) winnings = bet.betAmount * footballPayoutMultipliers.high;
                else if (correctPicks >= 10) winnings = bet.betAmount * footballPayoutMultipliers.mid;
                else if (correctPicks >= 7) winnings = bet.betAmount * footballPayoutMultipliers.low;

                if (winnings > 0) {
                    status = 'won';
                    totalWinnings += winnings;
                }
                
                updates[`users/${username}/gameHistory/${betKey}/status`] = status;
                updates[`users/${username}/gameHistory/${betKey}/winnings`] = winnings;
                updates[`users/${username}/gameHistory/${betKey}/details/correctPicks`] = correctPicks;
            }
        }
        if (totalWinnings > 0) {
            updates[`users/${username}/balance`] = firebase.database.ServerValue.increment(totalWinnings);
        }
        if (Object.keys(updates).length > 0) {
            await db.ref().update(updates);
            console.log("Updated pending football history.", updates);
        }
    }
    // --- HISTORY & BET LOGGING (END) ---

    // --- DEPOSIT & TRANSACTION LOGIC (REWORKED) ---
    function handleDepositSubmit() {
        const amountInput = document.getElementById('deposit-amount-input');
        let amount = parseFloat(amountInput.value);
        const selectedChannelEl = document.querySelector('.payment-channel-card.selected');

        if (isNaN(amount) || amount < 400) {
            showPopup('Minimum deposit is 400.', 'error');
            return;
        }
        if (!selectedChannelEl) {
            showPopup('Please select a payment channel.', 'error');
            return;
        }
        const channel = selectedChannelEl.dataset.channel;
        showPaymentPage(channel, amount);
    }
    
    async function createPendingTransaction(method, details) {
        const username = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!username) return;

        const transaction = {
            amount: currentDepositState.amount,
            channel: currentDepositState.channel,
            status: 'pending',
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            invoiceId: currentDepositState.invoiceId,
            method: method, 
            details: details,
            type: 'deposit'
        };

        try {
            const trxRef = db.ref('users/' + username + '/transactions');
            await trxRef.push(transaction);
            await updateUserMissionProgress('deposit', currentDepositState.amount);
            showPopup('Deposit submitted for review!', 'success');
            showPage('deposit', true); // Go back to deposit page after submission
        } catch (error) {
            showPopup('Failed to submit transaction.', 'error');
        }
    }
    
    async function handleProofSubmission() {
        const trxIdInput = document.getElementById('payment-page-trxid-input');
        const trxId = trxIdInput.value.trim();
        if (!trxId) {
            showPopup('Please enter a valid Transaction ID.', 'error');
            return;
        }
        clearInterval(paymentTimerInterval); // Stop timer on submission
        await createPendingTransaction('TRXID', trxId);
    }
    
    function showPaymentPage(channel, amount) {
        currentDepositState.amount = amount;
        currentDepositState.channel = channel;
        currentDepositState.invoiceId = 'GDH' + Math.random().toString(36).substr(2, 8).toUpperCase();
        
        const nagadNumber = '01752067094'; 

        document.getElementById('payment-page-invoice-id').textContent = currentDepositState.invoiceId;
        document.getElementById('payment-page-amount').textContent = `${amount.toFixed(2)}`;
        document.getElementById('payment-page-number').textContent = nagadNumber;
        document.getElementById('payment-page-number-label').textContent = `${channel} Number:`;

        showPage('payment');
        startPaymentTimer(300); // 5 minutes = 300 seconds
    }
    
    function startPaymentTimer(duration) {
        clearInterval(paymentTimerInterval);
        const timerDisplay = document.getElementById('payment-page-timer-display');
        let timer = duration;
        paymentTimerInterval = setInterval(() => {
            const minutes = Math.floor(timer / 60);
            const seconds = timer % 60;
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            if (--timer < 0) {
                clearInterval(paymentTimerInterval);
                showPage('deposit', true); // Go back to deposit page
                showPopup("Payment time expired.", "error");
            }
        }, 1000);
    }
    
    async function loadAndDisplayTransactionHistory() {
        const container = document.getElementById('transaction-history-list');
        const username = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!username) {
            container.innerHTML = '<p style="text-align: center; color: var(--gray-text);">Please log in to see history.</p>';
            return;
        }
        try {
            const snapshot = await db.ref(`users/${username}/transactions`).orderByChild('timestamp').limitToLast(50).once('value');
            if (snapshot.exists()) {
                const allTransactions = [];
                snapshot.forEach(childSnapshot => { allTransactions.push(childSnapshot.val()); });
                container.innerHTML = '';
                allTransactions.reverse().forEach(trx => {
                    const date = new Date(trx.timestamp);
                    const formattedDate = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;
                    const statusClass = (trx.status || 'pending').toLowerCase();
                    const typeClass = (trx.type || 'deposit').toLowerCase();
                    const amountSign = typeClass === 'deposit' ? '+' : '-';
                    const currencySymbol = '';
                    const cardHTML = `
                        <div class="history-item-card">
                            <div class="history-item-info">
                                <div class="amount ${typeClass}">${amountSign}${currencySymbol}${trx.amount.toFixed(2)}</div>
                                <div class="channel">${trx.channel} <span class="type">(${trx.type})</span></div>
                                <div class="date">${formattedDate}</div>
                                <div class="invoice">ID: ${trx.invoiceId || 'N/A'}</div>
                            </div>
                            <div class="history-status ${statusClass}">${trx.status}</div>
                        </div>
                    `;
                    container.innerHTML += cardHTML;
                });
            } else {
                container.innerHTML = '<p style="text-align: center; color: var(--gray-text);">No recent transactions.</p>';
            }
        } catch (error) {
            console.error("Error loading history:", error);
            container.innerHTML = '<p style="text-align: center; color: var(--red-color);">Could not load history.</p>';
        }
    }
    // --- DEPOSIT & TRANSACTION LOGIC (END) ---
    
    // --- CHAT & COMMUNICATION (START) ---
    async function handleSendMessage() { const messageInput = document.getElementById('chat-message-input'); const messageText = messageInput.value.trim(); if (!messageText || !currentUserData) return; const chatRef = db.ref(`supportChats/${currentUserData.username}`); const newMessage = { text: messageText, sender: 'user', timestamp: firebase.database.ServerValue.TIMESTAMP, read: false }; try { await chatRef.push(newMessage); messageInput.value = ''; } catch (error) { console.error("Error sending message:", error); showPopup("Could not send message.", "error"); } }
    function listenForMessages() { if (!currentUserData) return; const chatMessagesEl = document.getElementById('chat-messages'); chatMessagesEl.innerHTML = '';  if (currentChatListener) { currentChatListener.off(); } const chatRef = db.ref(`supportChats/${currentUserData.username}`); currentChatListener = chatRef.orderByChild('timestamp'); currentChatListener.on('child_added', (snapshot) => { const message = snapshot.val(); if (!message) return; if (message.sender !== 'user') { const messageContainer = document.createElement('div'); messageContainer.className = 'message-container received'; const adminIcon = document.createElement('img'); adminIcon.className = 'admin-icon'; adminIcon.src = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR19aN1sxDXj07B0k_NuZl4AwUoH0jNLspmpqCkIlo9FexvzGOwuclHg6Bz&s=10'; const bubble = document.createElement('div'); bubble.className = 'message-bubble received'; bubble.textContent = message.text; messageContainer.appendChild(adminIcon); messageContainer.appendChild(bubble); chatMessagesEl.appendChild(messageContainer); } else { const bubble = document.createElement('div'); bubble.className = 'message-bubble sent'; bubble.textContent = message.text; chatMessagesEl.appendChild(bubble); } chatMessagesEl.scrollTop = chatMessagesEl.scrollHeight; }); }
    async function handleImageUpload(event) { const file = event.target.files[0]; if (!file || !currentUserData) return; const botToken = "7363646313:AAHu4JTtEMQAQhPxSw7dzJPCTK0luKtRygY"; const chatId = "7504616242"; const telegramApiUrl = `https://api.telegram.org/bot${botToken}/sendPhoto`; showPopup("Uploading image...", "success"); const username = currentUserData.username || 'Unknown User'; const userId = currentUserData.userId || 'N/A'; const caption = `New image from user: ${username} (UID: ${userId})`; const formData = new FormData(); formData.append('chat_id', chatId); formData.append('photo', file); formData.append('caption', caption); try { const response = await fetch(telegramApiUrl, { method: 'POST', body: formData }); const result = await response.json(); if (result.ok) { showPopup("Image sent successfully!", "success"); } else { showPopup(`Failed to send image: ${result.description || 'Unknown error'}`, "error"); } } catch (error) { showPopup("An error occurred while uploading the image.", "error"); } finally { event.target.value = ''; } }
    // --- CHAT & COMMUNICATION (END) ---

    // --- PARTNER & REWARDS (START) ---
    function handleCopyInviteLink() { const linkInput = document.getElementById('invitation-link-input'); if (linkInput.value === 'Please log in') { showPopup('Please log in to get your link.', 'error'); return; } navigator.clipboard.writeText(linkInput.value).then(() => showPopup('Invitation link copied!', 'success'), () => showPopup('Failed to copy link.', 'error')); }
    async function handleClaimCommission() { const claimBtn = document.getElementById('commission-claim-btn'); if (claimBtn.classList.contains('disabled')) return; const username = JSON.parse(localStorage.getItem('loggedInUser')); if (!username || !currentUserData) return; const commissionToClaim = currentUserData.referrals.commissionBalance || 0; const newTotalBalance = (currentUserData.balance || 0) + commissionToClaim; try { const userRef = db.ref('users/' + username); await userRef.update({ 'balance': newTotalBalance, 'referrals/commissionBalance': 0 }); showPopup(`Successfully claimed ${commissionToClaim.toFixed(2)}!`, 'success'); handleBalanceRefresh(); } catch (error) { showPopup('Failed to claim commission. Please try again.', 'error'); } }
    // --- PARTNER & REWARDS (END) ---
    
    // --- AUTH & USER DATA (START) ---
    function updateActiveNav(pageId) { bottomNav.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active')); let itemToActivate = bottomNav.querySelector(`[data-page="${pageId}"]`); if (itemToActivate) { itemToActivate.classList.add('active'); } }
    
    async function checkSession() {
        const container = document.querySelector('.container');
        const username = JSON.parse(localStorage.getItem('loggedInUser'));
        const localSessionId = localStorage.getItem('activeSessionId');
        
        let shouldShowLogin = true;

        if (username && localSessionId) {
            const isLoggedIn = await fetchAndUpdateUserData(username, false, localSessionId);
            if (isLoggedIn) {
                setupUserStatusListener(username);
                shouldShowLogin = false;
            }
        }
        
        setTimeout(() => {
            splashScreen.classList.add('hidden');
            container.classList.add('ready');

            if (shouldShowLogin) {
                showPage('login');
            } else {
                const lastPage = sessionStorage.getItem('lastActivePage') || 'dashboard';
                updateActiveNav(lastPage);
                showPage(lastPage, false);
            }
        }, 2500); 
    }

    function populateAvatarModal() { const grid = document.getElementById('avatar-selection-grid'); grid.innerHTML = ''; avatarUrls.forEach(url => { const img = document.createElement('img'); img.src = url; img.dataset.url = url; img.addEventListener('click', handleAvatarSelection); grid.appendChild(img); }); }
    async function handleAvatarSelection(event) { const newAvatarUrl = event.target.dataset.url; const username = JSON.parse(localStorage.getItem('loggedInUser')); if (!username) return; const userRef = db.ref('users/' + username); try { await userRef.update({ avatarUrl: newAvatarUrl }); document.getElementById('account-avatar').src = newAvatarUrl; avatarModal.classList.add('hidden'); showPopup('Profile picture updated!', 'success'); } catch (error) { showPopup('Failed to update picture.', 'error'); } }
    async function handleBalanceRefresh() { const icon = document.querySelector('.refresh-icon'); const username = JSON.parse(localStorage.getItem('loggedInUser')); if (!username) return; icon.classList.add('spinning'); try { await fetchAndUpdateUserData(username); if(currentUserData) { showPopup('Balance updated!', 'success'); if (!pages.wingoGame.classList.contains('hidden')) { G.user.balance = currentUserData.balance; if(typeof renderBalance === 'function') { renderBalance(); } } } } catch(e) { showPopup('Could not refresh balance.', 'error'); } finally { setTimeout(() => icon.classList.remove('spinning'), 500); } }
    function handleCopyUid() { const uid = document.getElementById('account-uid').textContent; navigator.clipboard.writeText(uid).then(() => showPopup('UID copied!', 'success'), () => showPopup('Failed to copy.', 'error')); }
    function handleLogout(message = "You have logged out.") {  
        showPopup(message, 'success');
        localStorage.removeItem('loggedInUser'); 
        localStorage.removeItem('activeSessionId');
        sessionStorage.removeItem('lastActivePage'); 
        currentUserData = null;  
        if (userStatusListener) { userStatusListener.off(); userStatusListener = null; } 
        showPage('login');  
        bottomNav.classList.add('hidden'); 
        globalChatBtn.classList.add('hidden');  
    }
    function showPopup(message, type = 'error', duration = 3000) { const c = document.getElementById('popup-container'); const p = document.createElement('div'); p.className = `popup-message ${type}`; p.innerHTML = message;  c.appendChild(p); setTimeout(() => { p.style.transition = 'opacity 0.5s ease'; p.style.opacity = '0'; setTimeout(() => p.remove(), 500); }, duration); }
    function showGameResultPopup(game, isWin, message, details = '', duration = 5000) { let container; if (game === 'matrix') { container = document.getElementById('matrix-result-popup-container'); } else if (game === 'crash') { container = document.getElementById('crash-result-popup-container'); } if(!container) return; container.innerHTML = ''; const popup = document.createElement('div'); popup.className = isWin ? 'game-result-popup win' : 'game-result-popup loss'; const iconClass = isWin ? 'fa-solid fa-trophy' : 'fa-solid fa-face-frown'; popup.innerHTML = ` <i class="${iconClass} result-icon"></i> <div class="result-text">${message}</div> ${details ? `<div class="result-details">${details}</div>` : ''} `; container.appendChild(popup); setTimeout(() => { popup.style.transition = 'opacity 0.5s ease'; popup.style.opacity = '0'; setTimeout(() => popup.remove(), 500); }, duration); }
    async function handleRedeemPromoCode() { const codeInput = document.getElementById('promo-code-input'); const code = codeInput.value.trim().toUpperCase(); if (!code) { showPopup("Please enter a code.", "error"); return; } if (!currentUserData) { showPopup("Please log in to redeem.", "error"); return; } const codeRef = db.ref(`promoCodes/${code}`); const codeSnapshot = await codeRef.once('value'); if (!codeSnapshot.exists() || !codeSnapshot.val().active) { showPopup("Invalid or expired code.", "error"); return; } const promoData = codeSnapshot.val(); const userRedeemedRef = db.ref(`promoCodes/${code}/redeemedBy/${currentUserData.username}`); const userRedeemedSnapshot = await userRedeemedRef.once('value'); if (userRedeemedSnapshot.exists()) { showPopup("You have already used this code.", "error"); return; } try { const updates = {}; updates[`users/${currentUserData.username}/balance`] = firebase.database.ServerValue.increment(promoData.reward); updates[`promoCodes/${code}/redeemedBy/${currentUserData.username}`] = true; await db.ref().update(updates); showPopup(`Success! ${promoData.reward} has been added to your account.`, "success"); promoModalOverlay.classList.add('hidden'); handleBalanceRefresh(); } catch (error) { showPopup("Failed to redeem code. Please try again.", "error"); } }
    
    async function handleRegistration() {  
        const username = document.getElementById('register-username').value.trim().toLowerCase();  
        const password = document.getElementById('register-password').value;  
        const phone = document.getElementById('register-phone').value.trim();
        const inviteCode = document.getElementById('register-invite-code').value.trim(); 
        const newUserId = 'ID' + Math.floor(10000000 + Math.random() * 90000000); 
        const newUserIdRaw = newUserId.replace('ID',''); 
        try { 
            if (password.length < 6 || username.length < 6 || username.length > 12) throw new Error('Username must be 6-12 chars & Password min 6 chars.');
            if (phone.length !== 11 || !/^\d{11}$/.test(phone)) throw new Error('Please enter a valid 11-digit phone number.');
            if (password !== document.getElementById('register-confirm-password').value) throw new Error('Passwords do not match.'); 
            
            const userRef = db.ref('users/' + username); 
            const userSnapshot = await userRef.once('value'); 
            if (userSnapshot.exists()) throw new Error('This username is already taken.'); 
            
            let referrerUsername = null; 
            if(inviteCode) { 
                const referrerIdSnapshot = await db.ref('userIds/' + inviteCode).once('value'); 
                if(referrerIdSnapshot.exists()) { 
                    referrerUsername = referrerIdSnapshot.val().username; 
                } else { 
                    showPopup("Invalid referral code. Continuing without one.", "error", 4000); 
                } 
            } 
            
            const newUser = { 
                username, 
                password, 
                balance: 10, 
                phone: '+880' + phone, 
                invitedBy: referrerUsername || null, 
                userId: newUserId, 
                firstDepositMade: false, 
                avatarUrl: avatarUrls[Math.floor(Math.random() * avatarUrls.length)], 
                createdAt: new Date().toISOString(), 
                lastLogin: null, 
                isBanned: false, 
                banReason: '', 
                sessionId: null,
                referrals: { invitedUsers: {}, commissionBalance: 0, directBonus: 0 }, 
                wallets: { main: 0 },
                missionProgress: {  
                    daily: { lastReset: '1970-01-01', bet: 0, deposit: 0, dailyLogin_claimed: false },  
                    weekly: { lastReset: '1970-01', bet: 0, deposit: 0, invites: 0 }  
                } 
            }; 
            
            let updates = {}; 
            updates['users/' + username] = newUser; 
            updates['userIds/' + newUserIdRaw] = { username: username }; 
            if (referrerUsername) { 
                updates[`users/${referrerUsername}/referrals/invitedUsers/${username}`] = { joinedAt: firebase.database.ServerValue.TIMESTAMP, isEffective: false }; 
            } 
            await db.ref().update(updates); 
            
            showPopup('Account created successfully!', 'success'); 
            document.getElementById('register-form').reset(); 
            setTimeout(() => showPage('login'), 1500); 
        } catch (error) {  
            showPopup(error.message);  
        }  
    }

    async function handleLogin() {  
        const username = document.getElementById('login-username').value.trim().toLowerCase();  
        const password = document.getElementById('login-password').value;  
        try {  
            if (!username || !password) throw new Error('Please enter username and password.');  
            const userRef = db.ref('users/' + username);  
            const snapshot = await userRef.once('value');  
            if (!snapshot.exists() || snapshot.val().password !== password) throw new Error('Invalid username or password.');  
            
            showPopup('Login successful!', 'success');  
            
            const newSessionId = `SESSION_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
            localStorage.setItem('loggedInUser', JSON.stringify(username));  
            localStorage.setItem('activeSessionId', newSessionId);

            await fetchAndUpdateUserData(username, true, newSessionId);  
            
            setTimeout(() => { 
                showPage('dashboard'); 
                updateActiveNav('dashboard'); 
                setupUserStatusListener(username); 
            }, 500);  
        } catch (error) { 
            showPopup(error.message); 
        }  
    }

    function getWeekNumber(d) { d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate())); d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7)); var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1)); var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7); return d.getUTCFullYear() + '-' + weekNo; }
    
    async function fetchAndUpdateUserData(username, isLoginAction = false, newSessionId = null) { 
        try { 
            const userRef = db.ref('users/' + username); 
            const snapshot = await userRef.once('value'); 
            if (!snapshot.exists()) { 
                console.error("User data not found in DB for:", username); 
                return false; 
            } 
            
            let userData = snapshot.val(); 
            let updates = {}; 
            
            if (!isLoginAction && newSessionId) {
                if (userData.sessionId !== newSessionId) {
                    handleLogout("Logged out. Session is invalid.");
                    return false;
                }
            }

            if (!userData.missionProgress) { userData.missionProgress = {}; } 
            if (!userData.missionProgress.daily) { userData.missionProgress.daily = { lastReset: '1970-01-01', bet: 0, deposit: 0, dailyLogin_claimed: false }; } 
            if (!userData.missionProgress.weekly) { userData.missionProgress.weekly = { lastReset: '1970-01', bet: 0, deposit: 0, invites: 0 }; } 
            
            const todayStr = new Date().toISOString().split('T')[0]; 
            const currentWeekStr = getWeekNumber(new Date()); 
            
            if (userData.missionProgress.daily.lastReset !== todayStr) { 
                updates['missionProgress/daily'] = { lastReset: todayStr, bet: 0, deposit: 0, dailyLogin_claimed: false }; 
            } 
            if (userData.missionProgress.weekly.lastReset !== currentWeekStr) { 
                updates['missionProgress/weekly'] = { lastReset: currentWeekStr, bet: 0, deposit: 0, invites: 0 }; 
            } 
            if (isLoginAction) { 
                updates.lastLogin = new Date().toISOString(); 
                updates.sessionId = newSessionId; 
            } 
            
            if (Object.keys(updates).length > 0) { 
                await userRef.update(updates); 
                const finalSnapshot = await userRef.once('value'); 
                currentUserData = finalSnapshot.val(); 
            } else { 
                currentUserData = userData; 
            } 
            
            updateAccountUI(currentUserData); 
            if (document.getElementById('dashboard-page') && !document.getElementById('dashboard-page').classList.contains('hidden')) { 
                loadAndDisplayLeaderboard(); 
            } 
            return true; 
        } catch (error) { 
            console.error("Error fetching/updating user data: ", error); 
            return false; 
        } 
    }
    // --- AUTH & USER DATA (END) ---

    // --- MISSION LOGIC (START) ---
    function populateMissionCards() { const container = document.getElementById('tasks-list-container'); container.innerHTML = ''; for (const id in missionDefinitions) { const mission = missionDefinitions[id]; const card = document.createElement('div'); card.className = 'mission-card'; card.id = `mission-card-${id}`; card.innerHTML = ` <div class="mission-top-row"> <div class="mission-title-group"> <i class="fas ${mission.icon} mission-icon"></i> <span>${mission.name}<span class="mission-type-badge ${mission.type}">${mission.type}</span></span> </div> <button class="mission-rules-btn" data-mission-id="${id}"><i class="fas fa-question-circle"></i></button> <span class="mission-status">Unfinished</span> </div> <div class="mission-middle-row"> <span>Progress</span> <div class="progress-bar-container"><div class="progress-bar"></div></div> <span class="progress-value">0/${mission.goal}</span> </div> <div class="mission-bottom-row"> <div> <span class="mission-award-label">Award amount</span><br> <span class="award-value">${mission.reward.toFixed(2)}</span> </div> <button class="mission-button disabled" data-mission-id="${id}">To Complete</button> </div>`; container.appendChild(card); } }
    async function updateMissionUI() { if (!currentUserData || !currentUserData.missionProgress) return; const progress = currentUserData.missionProgress; for (const id in missionDefinitions) { const mission = missionDefinitions[id]; const card = document.getElementById(`mission-card-${id}`); if (!card) continue; const progressBar = card.querySelector('.progress-bar'); const progressValue = card.querySelector('.progress-value'); const statusEl = card.querySelector('.mission-status'); const buttonEl = card.querySelector('.mission-button'); let currentVal = 0; let isClaimed = false; const todayStr = new Date().toISOString().split('T')[0]; if (mission.type === 'daily') { isClaimed = progress.daily[`${id}_claimed`]; if (id === 'dailyLogin') { currentVal = progress.daily.lastReset === todayStr ? 1 : 0; } else if (id.includes('Bet')) { currentVal = progress.daily.bet || 0; } else if (id === 'dailyDeposit') { currentVal = progress.daily.deposit || 0; } } else { isClaimed = progress.weekly[`${id}_claimed`]; if (id.includes('Bet')) currentVal = progress.weekly.bet || 0; if (id.includes('Deposit')) currentVal = progress.weekly.deposit || 0; if (id.includes('Invites')) currentVal = progress.weekly.invites || 0; } const percentage = Math.min((currentVal / mission.goal) * 100, 100); if (progressBar) progressBar.style.width = `${percentage}%`; if (progressValue) progressValue.textContent = `${Math.floor(Math.min(currentVal, mission.goal))}/${mission.goal}`; if (isClaimed) { statusEl.textContent = 'Received'; buttonEl.textContent = 'Received'; buttonEl.disabled = true; buttonEl.classList.add('disabled'); buttonEl.classList.remove('claimable'); } else if (percentage >= 100) { statusEl.textContent = 'Completed'; buttonEl.textContent = 'Claim'; buttonEl.disabled = false; buttonEl.classList.remove('disabled'); buttonEl.classList.add('claimable'); } else { statusEl.textContent = 'Unfinished'; buttonEl.textContent = 'To Complete'; buttonEl.disabled = true; buttonEl.classList.add('disabled'); buttonEl.classList.remove('claimable'); } } }
    async function updateUserMissionProgress(type, value) { if (!currentUserData) return; const userRef = db.ref(`users/${currentUserData.username}/missionProgress`); const updates = {}; if(type === 'deposit') { updates['daily/deposit'] = firebase.database.ServerValue.increment(value); updates['weekly/deposit'] = firebase.database.ServerValue.increment(value); } else if (type === 'bet') { updates['daily/bet'] = firebase.database.ServerValue.increment(value); updates['weekly/bet'] = firebase.database.ServerValue.increment(value); } else if (type === 'invite') { updates['weekly/invites'] = firebase.database.ServerValue.increment(1); } await userRef.update(updates); await fetchAndUpdateUserData(currentUserData.username); }
    async function handleFirstDepositBonus(depositingUser, depositAmount) { if (depositingUser.firstDepositMade || !depositingUser.invitedBy) return; const referrerUsername = depositingUser.invitedBy; const updates = {}; updates[`users/${depositingUser.username}/firstDepositMade`] = true; updates[`users/${referrerUsername}/referrals/invitedUsers/${depositingUser.username}/isEffective`] = true; let bonus = 0; if (depositAmount >= 300 && depositAmount < 1000) bonus = 5; else if (depositAmount >= 1000 && depositAmount < 5000) bonus = 20; else if (depositAmount >= 5000 && depositAmount < 10000) bonus = 30; else if (depositAmount >= 10000) bonus = 150; if (bonus > 0) { updates[`users/${referrerUsername}/referrals/directBonus`] = firebase.database.ServerValue.increment(bonus); } updates[`users/${referrerUsername}/missionProgress/weekly/invites`] = firebase.database.ServerValue.increment(1); await db.ref().update(updates); console.log(`Referral bonus processed for ${referrerUsername}`); }
    async function handleClaimMissionReward(missionId) {
        if (!currentUserData || !missionId) return;

        const buttonEl = document.querySelector(`.mission-button[data-mission-id="${missionId}"]`);
        if (buttonEl) buttonEl.disabled = true;

        const mission = missionDefinitions[missionId];
        const userRef = db.ref(`users/${currentUserData.username}`);
        const claimedPath = `missionProgress/${mission.type}/${missionId}_claimed`;

        try {
            const snapshot = await userRef.child(claimedPath).once('value');
            if (snapshot.exists() && snapshot.val() === true) {
                showPopup("Reward already claimed.", "error");
                return;
            }

            const updates = {};
            updates[`referrals/commissionBalance`] = firebase.database.ServerValue.increment(mission.reward);
            updates[claimedPath] = true;
            await userRef.update(updates);

            showPopup(`Congratulations! ${mission.reward.toFixed(2)} added to 3rd Party Wallet.`, "success");
            await fetchAndUpdateUserData(currentUserData.username);

        } catch (error) {
            showPopup("Failed to claim reward. Please try again.", "error");
            console.error("Claiming error:", error);
            if (buttonEl) buttonEl.disabled = false;
        }
    }
    async function handleCommissionTransfer() {
        const username = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!username || !currentUserData) return;
        const btn = document.getElementById('commission-to-main-transfer-btn');
        btn.disabled = true;

        const commissionBalance = currentUserData.referrals.commissionBalance || 0;
        const COMMISSION_THRESHOLD = 50;

        if (commissionBalance < COMMISSION_THRESHOLD) {
            showPopup(`Minimum ${COMMISSION_THRESHOLD} in 3rd party wallet required to transfer.`, "error");
            btn.disabled = false;
            return;
        }
        const newMainWalletBalance = (currentUserData.wallets.main || 0) + commissionBalance;
        try {
            const userRef = db.ref('users/' + username);
            await userRef.update({
                'referrals/commissionBalance': 0,
                'wallets/main': newMainWalletBalance
            });
            showPopup(`${commissionBalance.toFixed(2)} transferred to Main Wallet!`, 'success');
            await handleBalanceRefresh();
        } catch (error) {
            showPopup('Failed to transfer commission. Please try again.', 'error');
            console.error("Commission transfer error:", error);
        } finally {
            setTimeout(() => { btn.disabled = false; }, 2000);
        }
    }
    async function handleMainToTotalTransfer() {
        const username = JSON.parse(localStorage.getItem('loggedInUser'));
        if (!username || !currentUserData) return;
        const btn = document.getElementById('main-wallet-circle');
        btn.style.pointerEvents = 'none';

        const mainWalletBalance = currentUserData.wallets.main || 0;
        const MAIN_WALLET_THRESHOLD = 500;

        if (mainWalletBalance < MAIN_WALLET_THRESHOLD) {
            showPopup(`Minimum ${MAIN_WALLET_THRESHOLD} in Main wallet required to collect.`, "error");
            btn.style.pointerEvents = 'auto';
            return;
        }
        const newTotalBalance = (currentUserData.balance || 0) + mainWalletBalance;
        try {
            const userRef = db.ref('users/' + username);
            await userRef.update({
                'wallets/main': 0,
                'balance': newTotalBalance
            });
            showPopup(`${mainWalletBalance.toFixed(2)} added to your total balance!`, 'success');
            await handleBalanceRefresh();
        } catch (error) {
            showPopup('Failed to collect from Main Wallet. Please try again.', 'error');
            console.error("Main wallet transfer error:", error);
        } finally {
            setTimeout(() => { btn.style.pointerEvents = 'auto'; }, 2000);
        }
    }
    // --- MISSION LOGIC (END) ---

    // --- WINGO GAME & WITHDRAWAL LOGIC (START) ---
    function initializeWingoGame() {
        if (!currentUserData) {
            showPopup("Please log in to play Wingo.", "error");
            showPage('dashboard', true);
            return;
        }
        G.user.uid = currentUserData.username;
        G.user.balance = currentUserData.balance;

        initializeApp();
    }

    const G = {
        user: { uid: null, balance: 0 },
        mode: { duration: 30, name: '30Sec', drawTime: 5 },
        id: '', timer: null, secondsRemaining: 0, phase: 'BETTING',
        resultHandledForPeriod: '', 
        history: [], myHistory: [], 
        gameHistoryPage: 1, myHistoryPage: 1, chartPage: 1,
        bet: { type: null, value: null, amount: 10 }
    };

    const D = {
        balance: document.getElementById('balance'),
        modalBalance: document.getElementById('modal-balance'),
        modeTitle: document.getElementById('game-mode-title'),
        timer: document.getElementById('time-remaining'),
        gameId: document.getElementById('current-game-id'),
        recent: document.getElementById('recent-results-display'),
        betLockdownOverlay: document.getElementById('bet-lockdown-overlay'),
        lockdownDigit1: document.getElementById('lockdown-digit-1'),
        lockdownDigit2: document.getElementById('lockdown-digit-2'),
        refreshBalanceBtn: document.getElementById('refresh-balance-btn'),
        refreshPageBtn: document.getElementById('wingo-refresh-page-btn'),
        gameHistoryContent: document.getElementById('game-history-content'),
        myHistoryContent: document.getElementById('my-history-content'),
        chartContent: document.getElementById('chart-content'),
        chartListContainer: document.getElementById('chart-list-container'),
        chartList: document.getElementById('chart-list'),
        chartSvgOverlay: document.getElementById('chart-svg-overlay'),
        chartPaginationContainer: document.getElementById('chart-pagination-container'),
        betModal: document.querySelector('#wingo-app-container #bet-modal'),
        modalContent: document.querySelector('#wingo-app-container #bet-modal .modal-content'),
        betModalGameMode: document.getElementById('bet-modal-game-mode'),
        modalSelection: document.getElementById('modal-selection-display'),
        betInput: document.getElementById('bet-amount-input'),
        confirmBtn: document.getElementById('confirm-bet'),
    };
    
    function getNumProps(num) { const props = { num, size: num >= 5 ? 'Big' : 'Small', color: '', css: '' }; if (num === 0) { props.color = 'Red, Violet'; } else if (num === 5) { props.color = 'Green, Violet'; } else if (num % 2 === 0) { props.color = 'Red'; } else { props.color = 'Green'; } return props; }
    function switchGameMode(duration, name, element) { if (G.timer) clearInterval(G.timer); G.mode = { duration, name, drawTime: 5 }; document.querySelectorAll('#wingo-app-container .mode-btn').forEach(btn => btn.classList.remove('active')); element.classList.add('active'); D.modeTitle.textContent = `WinGo ${name}`; runGameLoop(); }
    function runGameLoop() { if (G.timer) clearInterval(G.timer); syncAndStartTimer(); G.timer = setInterval(syncAndStartTimer, 1000); }
    function syncAndStartTimer() { const now = new Date(); const secondsPassedToday = now.getHours() * 3600 + now.getMinutes() * 60 + now.getSeconds(); const secondsIntoCurrentPeriod = secondsPassedToday % G.mode.duration; G.secondsRemaining = G.mode.duration - secondsIntoCurrentPeriod; const dateStr = new Date().toISOString().slice(0, 10).replace(/-/g, ""); const currentPeriodNum = Math.floor(secondsPassedToday / G.mode.duration) + 1; const newId = `${dateStr}${String(currentPeriodNum).padStart(5, '0')}`; if (G.id !== newId) { G.id = newId; D.gameId.textContent = G.id; } if (G.secondsRemaining <= G.mode.drawTime) { const lockdownSeconds = 3; if(G.secondsRemaining <= lockdownSeconds){ G.phase = 'LOCKED'; const mainTimerSecs = String(G.secondsRemaining).padStart(2, '0'); D.timer.innerHTML = `<span>0</span><span>0</span>:<span>${mainTimerSecs[0]}</span><span>${mainTimerSecs[1]}</span>`; D.betLockdownOverlay.style.display = 'flex'; D.lockdownDigit1.textContent = mainTimerSecs[0]; D.lockdownDigit2.textContent = mainTimerSecs[1]; } else { G.phase = 'CALCULATING'; if (G.resultHandledForPeriod !== G.id) { handleResult(G.id); G.resultHandledForPeriod = G.id; } D.betLockdownOverlay.style.display = 'none'; D.timer.innerHTML = `<span style="font-size: 1.5rem; letter-spacing: -2px;">...</span>`; } } else { G.phase = 'BETTING'; D.betLockdownOverlay.style.display = 'none'; const bettingSeconds = G.secondsRemaining - G.mode.drawTime; const mins = String(Math.floor(bettingSeconds / 60)).padStart(2, '0'); const secs = String(bettingSeconds % 60).padStart(2, '0'); D.timer.innerHTML = `<span>${mins[0]}</span><span>${mins[1]}</span>:<span>${secs[0]}</span><span>${secs[1]}</span>`; } }
    async function handleResult(periodId) { const props = getNumProps(Math.floor(Math.random() * 10)); const resultData = { gameId: periodId, gameMode: G.mode.name, ...props, timestamp: new Date().toISOString() }; await db.ref('gameHistory').push().set(resultData); await checkMyBetsForResult(resultData); }
    async function checkMyBetsForResult(resultData) { if(!G.user.uid) return; const myPendingBets = await db.ref(`myHistory/${G.user.uid}`).orderByChild('gameId').equalTo(resultData.gameId).once('value'); if (!myPendingBets.exists()) return; myPendingBets.forEach(betSnapshot => { const bet = { key: betSnapshot.key, ...betSnapshot.val() }; if (bet.result === 'Pending') { let isWin = false; let winAmount = 0; let payoutMultiplier = 1.96; if (bet.type === 'number' && bet.value == resultData.num) { isWin = true; payoutMultiplier = 8.82; } else if (bet.type === 'size' && bet.value === resultData.size) { isWin = true; } else if (bet.type === 'color') { if (bet.value === 'Violet' && resultData.color.includes('Violet')) { isWin = true; payoutMultiplier = 4.41; } else if (bet.value !== 'Violet' && resultData.color.includes(bet.value)) { isWin = true; if (resultData.color.includes('Violet')) { payoutMultiplier = 1.47; } } } let finalResultText = `-${bet.amount.toFixed(2)}`; if (isWin) { winAmount = bet.amount * payoutMultiplier; G.user.balance += winAmount; finalResultText = `+${winAmount.toFixed(2)}`; } db.ref(`myHistory/${G.user.uid}/${bet.key}`).update({ result: finalResultText }); } }); renderBalance(); }
    function renderBalance() { const currencySymbol = ''; const balanceText = `${currencySymbol}${G.user.balance.toLocaleString('en-IN', {minimumFractionDigits: 2})}`; D.balance.textContent = balanceText; if(D.modalBalance) D.modalBalance.textContent = balanceText; }
    function renderRecentResults() { D.recent.innerHTML = ''; const recentHistory = G.history.slice(0, 5); recentHistory.forEach(result => { if (result && typeof result.num !== 'undefined') { const props = getNumProps(result.num); let cssClass = ''; if (props.color.includes('Violet')) { cssClass = props.color.includes('Red') ? 'res-violet-red' : 'res-violet-green'; } else { cssClass = props.color.includes('Red') ? 'res-red' : 'res-green'; } D.recent.innerHTML += `<div class="result-circle ${cssClass}">${result.num}</div>`; } }); }
    
    function renderGameHistory() {
        const placeholderHTML = `<div style="text-align: center; padding: 40px; color: var(--gray-text);"><i class="fas fa-tools" style="font-size: 2rem; margin-bottom: 15px;"></i><p>History will be updated soon.</p></div>`;
        D.gameHistoryContent.innerHTML = placeholderHTML;
    }

    function calculateAndRenderIncomeSummary() { const currencySymbol = ''; let income3 = 0, income7 = 0, income30 = 0; const now = new Date(); G.myHistory.forEach(bet => { if (bet.result === 'Pending') return; const income = parseFloat(bet.result); const betDate = new Date(bet.timestamp); const daysAgo = (now - betDate) / (1000 * 3600 * 24); if (daysAgo <= 3) income3 += income; if (daysAgo <= 7) income7 += income; if (daysAgo <= 30) income30 += income; }); const updateIncomeElement = (elementId, amount) => { const el = document.getElementById(elementId); el.textContent = `${amount >= 0 ? '+' : ''}${currencySymbol}${Math.abs(amount).toFixed(2)}`; el.className = 'stat-amount'; if (amount > 0) el.classList.add('positive-income'); if (amount < 0) el.classList.add('negative-income'); }; updateIncomeElement('income-3d', income3); updateIncomeElement('income-7d', income7); updateIncomeElement('income-30d', income30); }
    function renderMyHistory() { calculateAndRenderIncomeSummary(); const listContainer = document.querySelector('#my-history-content .my-history-list'); listContainer.innerHTML = ''; let listHTML = ''; G.myHistory.forEach(bet => { const isWin = bet.result.startsWith('+'); let betIconHTML = ''; if(bet.type === 'color' || bet.type === 'size') { let bgColor = ''; if(bet.value === 'Green') bgColor = 'var(--wingo-primary-green)'; else if(bet.value === 'Red') bgColor = 'var(--red-color)'; else if(bet.value === 'Violet') bgColor = 'var(--wingo-violet-color)'; else if(bet.value === 'Big') bgColor = 'var(--wingo-orange-color)'; else if(bet.value === 'Small') bgColor = 'var(--wingo-blue-color)'; betIconHTML = `<div class="bet-type-icon" style="background:${bgColor};">${bet.value.substring(0,1)}</div>`; } else { betIconHTML = `<div class="bet-type-icon" style="background:var(--gray-text);">${bet.value}</div>`; } listHTML += `<div class="my-history-item">${betIconHTML}<div class="bet-details"><p class="period">${bet.gameId}</p><p class="date">${new Date(bet.timestamp).toLocaleString()}</p></div><div class="bet-status ${bet.result === 'Pending' ? '' : (isWin ? 'succeed' : 'failed')}">${bet.result === 'Pending' ? '<span class="status-text" style="color:var(--gray-text); border-color:var(--gray-text);">Pending</span>' : `<span class="status-text">${isWin ? 'Succeed' : 'Failed'}</span><span class="amount">${isWin ? '' : `<img src="https://i.ibb.co/6r1v2Vf/dragon-fire.png" class="fail-icon">`}${bet.result.startsWith('-') ? '' : '+'}${parseFloat(bet.result).toFixed(2)}</span>`}</div></div>`; }); listContainer.innerHTML = listHTML; }
    
    function renderChart() { 
        const itemsPerPage = 10; 
        const startIndex = (G.chartPage - 1) * itemsPerPage; 
        const endIndex = startIndex + itemsPerPage; 
        const pageData = G.history.slice(startIndex, endIndex); 
        let listHTML = ''; 
        pageData.forEach(result => { 
            const props = getNumProps(result.num); 
            let numbersHTML = ''; 
            for (let i = 0; i < 10; i++) { 
                if (i === result.num) { 
                    let colorClass = ''; 
                    if (props.color.includes('Violet')) { 
                        colorClass = props.color.includes('Red') ? 'violet-red' : 'violet-green'; 
                    } else { 
                        colorClass = props.color.includes('Red') ? 'red' : 'green'; 
                    } 
                    numbersHTML += `<div class="chart-num-circle highlight ${colorClass}" id="chart-num-circle-${result.gameId}">${i}</div>`; 
                } else { 
                    numbersHTML += `<div class="chart-num-circle">${i}</div>`; 
                } 
            } 
            listHTML += `<div class="chart-item">
                            <div class="chart-period">${result.gameId.slice(-4)}</div>
                            <div class="chart-size-indicator">
                                <div class="chart-size-icon ${props.size.toLowerCase()}">${props.size.charAt(0)}</div>
                            </div>
                            <div class="chart-numbers">${numbersHTML}</div>
                         </div>`; 
        }); 
        D.chartList.innerHTML = listHTML; 
        setTimeout(drawChartLines, 50); 
        const totalPages = Math.ceil(G.history.length / 10) || 1; 
        D.chartPaginationContainer.innerHTML = `<div class="pagination"><button class="page-btn" onclick="prevPage('chart')" ${G.chartPage === 1 ? 'disabled' : ''}><i class="fas fa-chevron-left"></i></button><span>${G.chartPage} / ${totalPages}</span><button class="page-btn" onclick="nextPage('chart')" ${G.chartPage >= totalPages ? 'disabled' : ''}><i class="fas fa-chevron-right"></i></button></div>`; 
    }

    function drawChartLines() { D.chartSvgOverlay.innerHTML = ''; const highlightedCircles = D.chartList.querySelectorAll('.chart-num-circle.highlight'); if (highlightedCircles.length < 2) return; const points = []; const containerRect = D.chartListContainer.getBoundingClientRect(); highlightedCircles.forEach(circle => { const circleRect = circle.getBoundingClientRect(); points.push({ x: circleRect.left - containerRect.left + (circleRect.width / 2), y: circleRect.top - containerRect.top + (circleRect.height / 2) }); }); let svgLinesHTML = ''; for (let i = 1; i < points.length; i++) { const p1 = points[i - 1]; const p2 = points[i]; svgLinesHTML += `<line x1="${p1.x}" y1="${p1.y}" x2="${p2.x}" y2="${p2.y}" style="stroke:var(--red-color);stroke-width:1.5" />`; } D.chartSvgOverlay.innerHTML = svgLinesHTML; D.chartSvgOverlay.setAttribute('width', containerRect.width); D.chartSvgOverlay.setAttribute('height', containerRect.height); }
    function nextPage(type) { const totalPages = Math.ceil(G.history.length / 10) || 1; if (type === 'game' && G.gameHistoryPage < totalPages) { G.gameHistoryPage++; renderGameHistory(); } if (type === 'chart' && G.chartPage < totalPages) { G.chartPage++; renderChart(); } }
    function prevPage(type) { if(type === 'game' && G.gameHistoryPage > 1) { G.gameHistoryPage--; renderGameHistory(); } if(type === 'chart' && G.chartPage > 1) { G.chartPage--; renderChart(); } }
    function showTab(tabName, element) { document.querySelectorAll('#wingo-app-container .history-tab').forEach(tab => tab.classList.remove('active')); element.classList.add('active'); D.gameHistoryContent.style.display = 'none'; D.myHistoryContent.style.display = 'none'; D.chartContent.style.display = 'none'; if (tabName === 'chart') { D.chartContent.style.display = 'block'; renderChart(); } else { document.getElementById(`${tabName}-content`).style.display = 'block'; } }
    function openBetModal(type, value) { if (G.phase !== 'BETTING') { showPopup('Betting is locked for this round.', "error"); return; } G.bet = { type, value, amount: 10 }; const currencySymbol = ''; let modalColor = ''; if(type === 'color') { modalColor = value === 'Green' ? 'var(--wingo-primary-green)' : (value === 'Red' ? 'var(--red-color)' : 'var(--wingo-violet-color)'); } else if (type === 'size') { modalColor = value === 'Big' ? 'var(--wingo-orange-color)' : 'var(--wingo-blue-color)'; } else { const props = getNumProps(parseInt(value)); modalColor = props.color.includes('Red') ? 'var(--red-color)' : 'var(--wingo-primary-green)';} D.modalContent.style.setProperty('--modal-color', modalColor); D.betModalGameMode.textContent = `WinGo ${G.mode.name}`; D.modalSelection.textContent = `Select ${value}`; D.modalBalance.textContent = `${currencySymbol}${G.user.balance.toLocaleString('en-IN', {minimumFractionDigits: 2})}`; D.betModal.style.display = 'flex'; updateBetAmountUI(10); }
    function closeBetModal() { D.betModal.style.display = 'none'; }
    function updateBetAmountUI(newAmount) { let amount = parseInt(newAmount, 10) || 10; G.bet.amount = Math.max(10, amount); D.betInput.value = G.bet.amount; D.confirmBtn.textContent = `Confirm`; }
    async function placeBet() { const amount = parseInt(D.betInput.value, 10); if (amount < 10) { showPopup('Minimum bet is 10.', "error"); updateBetAmountUI(10); return; } if (amount > G.user.balance) { showPopup("Insufficient balance!", "error"); return; } G.user.balance -= amount; renderBalance(); const betData = { uid: G.user.uid, gameId: G.id, ...G.bet, amount, result: 'Pending', timestamp: new Date().toISOString() }; await db.ref(`myHistory/${G.user.uid}`).push().set(betData); closeBetModal(); }
    function openHowToPlayModal() { const modal = document.querySelector('#wingo-app-container #how-to-play-modal'); const title = document.getElementById('rules-modal-title'); const content = document.getElementById('rules-modal-content'); const duration = G.mode.duration; const bettingTime = duration - G.mode.drawTime; title.textContent = `WinGo ${G.mode.name}`; content.innerHTML = `<p style="text-align: center;"><strong>${duration} seconds 1 issue, ${bettingTime} seconds to order, ${G.mode.drawTime} seconds waiting for the draw. It opens all day.</strong></p><p style="text-align: center;">If you spend 100, after deducting 2 service fee, your contract amount is 98:</p><ul class="rules-list"><li>Select <strong>green</strong>: if the result shows 1,3,7,9 you will get (98*2) = 196. If the result shows 5, you will get (98*1.5) = 147.</li><li>Select <strong>red</strong>: if the result shows 2,4,6,8 you will get (98*2) = 196. If the result shows 0, you will get (98*1.5) = 147.</li><li>Select <strong>violet</strong>: if the result shows 0 or 5, you will get (98*4.5) = 441.</li><li>Select <strong>number</strong>: if the result is the same as the number you selected, you will get (98*9) = 882.</li><li>Select <strong>big</strong>: if the result shows 5,6,7,8,9 you will get (98*2) = 196.</li><li>Select <strong>small</strong>: if the result shows 0,1,2,3,4 you will get (98*2) = 196.</li></ul>`; modal.style.display = 'flex'; }
    function closeHowToPlayModal() { document.querySelector('#wingo-app-container #how-to-play-modal').style.display = 'none'; }
    function initializeApp() { renderBalance(); switchGameMode(30, '30Sec', document.querySelector('#wingo-app-container .mode-btn.active')); showTab('game-history', document.querySelector('#wingo-app-container .history-tab.active')); D.refreshBalanceBtn.onclick = () => { D.refreshBalanceBtn.classList.add('spin'); renderBalance(); setTimeout(() => { D.refreshBalanceBtn.classList.remove('spin'); }, 700); }; D.refreshPageBtn.onclick = () => { D.refreshPageBtn.classList.add('spin'); setTimeout(() => { showPage('wingoGame'); }, 500); }; document.querySelector('#wingo-app-container #decrease-qty').onclick = () => updateBetAmountUI(G.bet.amount - 10); document.querySelector('#wingo-app-container #increase-qty').onclick = () => updateBetAmountUI(G.bet.amount + 10); D.betInput.oninput = (e) => updateBetAmountUI(e.target.value); document.querySelectorAll('#wingo-app-container .preset-btn').forEach(btn => btn.onclick = () => updateBetAmountUI(btn.dataset.amount)); D.confirmBtn.onclick = placeBet; db.ref('gameHistory').orderByChild('timestamp').limitToLast(200).on('value', snapshot => { if (!snapshot.exists()) return; G.history = []; snapshot.forEach(child => { G.history.unshift(child.val()); }); renderRecentResults(); renderGameHistory(); if (document.querySelector('#wingo-app-container #chart-content').style.display === 'block') { renderChart(); } }); if(G.user.uid) { db.ref(`myHistory/${G.user.uid}`).orderByChild('timestamp').limitToLast(100).on('value', snapshot => { G.myHistory = []; if (snapshot.exists()){ snapshot.forEach(child => { G.myHistory.unshift({ key: child.key, ...child.val() }); }); } renderMyHistory(); }); } }
    
    const METHOD_CONFIG = { 'Bkash': { min: 1000, fee: 0.03, unit: '', name: 'Bkash Number' }, 'Nagad': { min: 1000, fee: 0.03, unit: '', name: 'Nagad Number' } };
    const W_State = { method: 'Bkash', accounts: {}, history: [] };
    
    function showWithdrawPage() {
        if (!currentUserData) { showPage('wallet', true); return; }
        const balance = currentUserData.balance || 0;
        const currencySymbol = '';
        const balanceText = `${currencySymbol}${balance.toLocaleString('en-IN', {minimumFractionDigits: 2})}`;
        document.getElementById('withdraw-balance-display').textContent = balanceText;
        document.getElementById('withdrawable-balance').textContent = balanceText;
        switchWithdrawMethod('Bkash'); 
    }

    function hideWithdrawPage() { showPage('wallet', true); }
    function switchWithdrawMethod(methodName) { W_State.method = methodName; document.querySelectorAll('#withdraw-page .method-tab').forEach(tab => { tab.classList.remove('active'); if (tab.textContent.includes(methodName)) tab.classList.add('active'); }); const config = METHOD_CONFIG[methodName]; const D_w = { currencyUnit: document.getElementById('withdraw-currency-unit'), amountInput: document.getElementById('withdraw-amount-input'), feeRate: document.getElementById('fee-rate-display'), rulesContainer: document.getElementById('withdraw-rules-container') }; D_w.currencyUnit.textContent = config.unit; D_w.amountInput.placeholder = `Min ${config.min}`; D_w.feeRate.textContent = `${config.fee * 100}%`; D_w.rulesContainer.innerHTML = `<div class="rule-item"><i class="fas fa-check-circle icon"></i>Need to bet <span class="value">0.00</span></div><div class="rule-item"><i class="fas fa-check-circle icon"></i>Withdraw time <span class="value">00:00-23:59</span></div><div class="rule-item"><i class="fas fa-check-circle icon"></i>Amount range <span class="value">${config.unit}${config.min} - ${config.unit}50,000</span></div>`; updateSelectedAccountDisplay(); updateWithdrawCalculation(); }
    
    function updateSelectedAccountDisplay() {
        const savedAccount = W_State.accounts[W_State.method];
        const config = METHOD_CONFIG[W_State.method];
        const displayEl = document.getElementById('selected-account-display');
        if (savedAccount) {
            displayEl.innerHTML = `<div><p class="account-name">${config.name}</p><p class="account-details">${savedAccount}</p></div><i class="fas fa-chevron-right"></i>`;
        } else {
            displayEl.innerHTML = `<div class="add-account-btn"><i class="fas fa-plus-circle"></i><span>Add ${config.name}</span></div>`;
        }
    }

    function updateWithdrawCalculation() { const amount = parseFloat(document.getElementById('withdraw-amount-input').value) || 0; const config = METHOD_CONFIG[W_State.method]; const fee = amount * config.fee; const received = amount - fee; document.getElementById('fee-amount').textContent = `${config.unit}${fee.toFixed(2)}`; document.getElementById('received-amount').textContent = `${config.unit}${received.toFixed(2)}`; }
    function openAddAccountModal() { document.getElementById('add-account-modal').classList.remove('hidden'); const config = METHOD_CONFIG[W_State.method]; document.getElementById('account-modal-title').textContent = `Set ${config.name}`; const inputEl = document.getElementById('account-modal-input'); inputEl.placeholder = `Enter your ${config.name}`; inputEl.value = W_State.accounts[W_State.method] || ''; }
    function closeAddAccountModal() { document.getElementById('add-account-modal').classList.add('hidden'); }
    async function saveAccountDetails() { const newAccount = document.getElementById('account-modal-input').value.trim(); if (!newAccount) { showPopup("Account details cannot be empty.", "error"); return; } W_State.accounts[W_State.method] = newAccount; await db.ref(`userAccounts/${currentUserData.username}`).set(W_State.accounts); showPopup("Account saved successfully!", "success"); closeAddAccountModal(); updateSelectedAccountDisplay(); }
    async function handleWithdrawRequest() { const amount = parseFloat(document.getElementById('withdraw-amount-input').value); const config = METHOD_CONFIG[W_State.method]; const savedAccount = W_State.accounts[W_State.method]; if (!savedAccount) { showPopup(`Please add your ${config.name} first.`, "error"); return; } if (!amount || amount <= 0) { showPopup("Please enter a valid amount.", "error"); return; } if (amount < config.min) { showPopup(`Minimum withdrawal for ${W_State.method} is ${config.unit}${config.min}.`, "error"); return; } if (amount > currentUserData.balance) { showPopup("Insufficient balance.", "error"); return; } const newBalance = currentUserData.balance - amount; const requestData = { uid: currentUserData.username, method: W_State.method, amount: amount, account: savedAccount, status: 'Pending', timestamp: new Date().toISOString() }; await db.ref(`withdrawRequests/${currentUserData.username}`).push().set(requestData); await db.ref(`users/${currentUserData.username}/balance`).set(newBalance); showPopup("Withdrawal request submitted successfully!", "success"); renderBalance(); hideWithdrawPage(); }
    function showWithdrawHistoryPage() { showPage('withdrawHistory'); renderWithdrawalHistory(); }
    function hideWithdrawHistoryPage() { showPage('withdraw', true); }
    function renderWithdrawalHistory() { const listContainer = document.getElementById('withdraw-history-list'); listContainer.innerHTML = ''; if (W_State.history.length === 0) { listContainer.innerHTML = `<div class="no-history-found" style="text-align: center; padding: 50px; color: var(--gray-text);"><i class="fas fa-file-invoice-dollar" style="font-size: 3rem; margin-bottom: 15px;"></i><p>No withdrawal records found.</p></div>`; return; } const sortedHistory = [...W_State.history].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)); sortedHistory.forEach(item => { const config = METHOD_CONFIG[item.method] || { unit: '?' }; const statusClass = item.status.toLowerCase(); const date = new Date(item.timestamp).toLocaleString(); const itemHTML = `<div class="history-item-w"><div class="details"><p class="amount">${config.unit}${item.amount.toLocaleString()}</p><p class="date">${date}</p></div><div class="status-badge ${statusClass}">${item.status}</div></div>`; listContainer.innerHTML += itemHTML; }); }
    
    function initializeWithdrawalSystem() {
        document.querySelector('#wingo-app-container .wallet-btn.withdraw-btn')?.addEventListener('click', () => showPage('withdraw'));
        document.querySelector('#wingo-app-container .wallet-btn.deposit-btn')?.addEventListener('click', () => showPage('deposit'));
        document.querySelector('#withdraw-page .history-link')?.addEventListener('click', (e) => { e.preventDefault(); showWithdrawHistoryPage(); });
        document.getElementById('all-btn')?.addEventListener('click', () => { 
            if(currentUserData){
                document.getElementById('withdraw-amount-input').value = currentUserData.balance; 
                updateWithdrawCalculation(); 
            }
        });
        
        if(currentUserData?.username) { 
            db.ref(`userAccounts/${currentUserData.username}`).on('value', snapshot => { 
                W_State.accounts = snapshot.exists() ? snapshot.val() : {}; 
                if(!pages.withdraw.classList.contains('hidden')) { 
                    updateSelectedAccountDisplay();
                } 
            }); 
            db.ref(`withdrawRequests/${currentUserData.username}`).on('value', snapshot => { 
                W_State.history = []; 
                if (snapshot.exists()) { snapshot.forEach(child => { W_State.history.push(child.val()); }); } 
                if (!pages.withdrawHistory.classList.contains('hidden')) { 
                    renderWithdrawalHistory(); 
                } 
            }); 
        }
    }
    // --- WINGO GAME & WITHDRAWAL LOGIC (END) ---

    // --- UI UPDATE FUNCTIONS (START) ---
    function updateAccountUI(userData) { 
        currentUserData = userData;  
        const currencySymbol = ''; 
        document.getElementById('account-avatar').src = userData.avatarUrl || 'https://i.ibb.co/68c1pws/avatar-placeholder.png'; 
        document.getElementById('account-username').textContent = userData.username; 
        document.getElementById('account-uid').textContent = userData.userId.replace('ID',''); 
        document.getElementById('account-balance').textContent = `${currencySymbol}${(userData.balance || 0).toFixed(2)}`;
        
        // NEW: Update Premium Header
        document.getElementById('premium-header-balance').textContent = `${currencySymbol}${(userData.balance || 0).toFixed(2)}`;

        const loginTime = new Date(userData.lastLogin || Date.now()); 
        document.getElementById('last-login').textContent = `${loginTime.getFullYear()}-${String(loginTime.getMonth()+1).padStart(2,'0')}-${String(loginTime.getDate()).padStart(2,'0')} ${String(loginTime.getHours()).padStart(2,'0')}:${String(loginTime.getMinutes()).padStart(2,'0')}`; 
        const depositCurrencySymbol = document.getElementById('deposit-currency-symbol'); 
        if (depositCurrencySymbol) { depositCurrencySymbol.textContent = currencySymbol; } 
        const matrixBalanceDisplay = document.getElementById('matrix-bet-balance-display'); 
        if (matrixBalanceDisplay) { matrixBalanceDisplay.textContent = `${currencySymbol}${(userData.balance || 0).toFixed(2)}`; } 
        const towerBalanceDisplay = document.getElementById('tower-bet-balance-display'); 
        if (towerBalanceDisplay) { towerBalanceDisplay.textContent = `${currencySymbol}${(userData.balance || 0).toFixed(2)}`; } 
        const crashBalanceDisplay = document.getElementById('crash-balance-amount'); 
        if (crashBalanceDisplay) { crashBalanceDisplay.textContent = `${currencySymbol}${(userData.balance || 0).toFixed(2)}`; } 
        const minesBalanceDisplay = document.getElementById('mines-bet-balance-display'); 
        if (minesBalanceDisplay) { minesBalanceDisplay.textContent = `${currencySymbol}${(userData.balance || 0).toFixed(2)}`; } 
        updatePartnerRewardsUI(userData); 
        updateWalletUI(userData, currencySymbol);  
        updateMissionUI(); 
    }
    function updateWalletUI(userData, currencySymbol) { const totalBalance = userData.balance || 0; const mainWalletBalance = userData.wallets.main || 0; const commissionBalance = userData.referrals.commissionBalance || 0; const MAIN_WALLET_GOAL = 500; const COMMISSION_GOAL = 50; document.getElementById('wallet-total-balance').textContent = `${currencySymbol}${totalBalance.toFixed(2)}`; let mainPercent = Math.min((mainWalletBalance / MAIN_WALLET_GOAL) * 100, 100); const mainWalletCircle = document.getElementById('main-wallet-circle'); mainWalletCircle.style.background = `conic-gradient(var(--primary-green) ${mainPercent}%, #f0f2f5 0)`; document.getElementById('main-wallet-percentage').textContent = `${Math.floor(mainPercent)}%`; document.getElementById('main-wallet-amount').textContent = `${currencySymbol}${mainWalletBalance.toFixed(2)}`; mainWalletCircle.classList.toggle('animated', mainWalletBalance >= MAIN_WALLET_GOAL); let commissionPercent = Math.min((commissionBalance / COMMISSION_GOAL) * 100, 100); document.getElementById('third-party-wallet-circle').style.background = `conic-gradient(var(--orange-color) ${commissionPercent}%, #f0f2f5 0)`; document.getElementById('third-party-wallet-percentage').textContent = `${Math.floor(commissionPercent)}%`; document.getElementById('third-party-wallet-amount').textContent = `${currencySymbol}${commissionBalance.toFixed(2)}`; }
    function updatePartnerRewardsUI(userData) { const ACTIVATION_GOAL = 5; const CLAIM_THRESHOLD = 300; const currencySymbol = ''; const referrals = userData.referrals || { invitedUsers: {}, commissionBalance: 0, directBonus: 0 }; const invitedUsers = referrals.invitedUsers || {}; const invitationCount = Object.keys(invitedUsers).length; const effectiveInvitationCount = Object.values(invitedUsers).filter(u => u.isEffective).length; document.getElementById('partner-invitation-count').textContent = invitationCount; document.getElementById('partner-effective-invitation-count').textContent = effectiveInvitationCount; document.getElementById('partner-total-bonus').textContent = `${currencySymbol}${(referrals.directBonus || 0).toFixed(2)}`; document.getElementById('partner-commission-bonus').textContent = `${currencySymbol}${(referrals.commissionBalance || 0).toFixed(2)}`; document.getElementById('invitation-link-input').value = `https://1x-mall.netlify.app/#/register?invite_code=${userData.userId.replace('ID','')}`; const statusBar = document.getElementById('commission-status-card'); const claimCard = document.getElementById('commission-claim-card'); const progressBarInner = document.getElementById('commission-progress-bar-inner'); const progressText = document.getElementById('commission-progress-text'); if(effectiveInvitationCount >= ACTIVATION_GOAL) { statusBar.classList.remove('inactive'); statusBar.classList.add('active'); claimCard.classList.remove('hidden'); const commissionBalance = referrals.commissionBalance || 0; document.getElementById('claimable-commission-amount').textContent = `${currencySymbol}${commissionBalance.toFixed(2)}`; const claimBtn = document.getElementById('commission-claim-btn'); if (commissionBalance >= CLAIM_THRESHOLD) { claimBtn.classList.remove('disabled'); claimBtn.textContent = 'Claim Now'; }  else { claimBtn.classList.add('disabled'); claimBtn.textContent = `Claim at ${currencySymbol}${CLAIM_THRESHOLD}`; } } else { statusBar.classList.remove('active'); statusBar.classList.add('inactive'); claimCard.classList.add('hidden'); const progressPercentage = (effectiveInvitationCount / ACTIVATION_GOAL) * 100; progressBarInner.style.width = `${progressPercentage}%`; progressText.textContent = `${effectiveInvitationCount}/${ACTIVATION_GOAL} Effective Invitations`; } }
    // --- UI UPDATE FUNCTIONS (END) ---
</script>
<!-- === JAVASCRIPT LOGIC (END) === -->
</body>
</html>
